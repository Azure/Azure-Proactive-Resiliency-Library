[
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/",
	"title": "Home",
	"tags": null,
	"description": "Welcome to the home of the Azure Proactive Resiliency Library (APRL)",
	"content": "Welcome to the home of the Azure Proactive Resiliency Library (APRL).\nThis library is built with the intention of being a staging area for guidance and recommendations that can be used by customers, partners and the field in Well-Architected Framework reliability engagements/assessments; with the intent of the guidance and recommendations being promoted, once tested and validated with customers and partners, into the official Well-Architected Framework documentation.\nThe library also contains supporting Azure Resource Graph (ARG) queries, and sometimes Azure PowerShell or Azure CLI scripts, that can help customers, partners and the field identify resources that may or may not be compliant with the guidance and recommendations. The intent for these queries, in the long-term, is to make them part of the Azure Advisor service.\nGet Started To get started head over to the Azure Services section and then navigate via the appropriate category to find guidance, recommendations alongside supporting Azure Resource Graph queries, Azure PowerShell or Azure CLI scripts to help you discover compliant/non-compliant resources in your environment.\nYou can also use the basic search functionality provided by this site to locate the Azure service you are looking for guidance, recommendations and supporting queries and scripts for. Definitions of Terms Used in APRL In APRL you will see a number of terms used, like Preview \u0026amp; Verified. The below table provides the definition for each of these terms for clarity.\nTerm Definition Preview Guidance Guidance that Microsoft FTEs have created based on customer engagements and is in the process of reviewing with the relevant Azure Product Group Engineering Service owners to ensure the content is valid and accurate Verified Guidance Guidance has been signed off by Azure Product Group Engineering Service owners following their review Contributing Please see the contribution guide here.\nPlease note that this site is built upon GithHub Pages using Hugo which is using the Ace Documentation theme "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/",
	"title": "Azure Services",
	"tags": null,
	"description": "The landing page for all Azure Services covered as part of APRL",
	"content": "This page lists all of the Azure Services for which the APRL has guidance, recommendations and queries for. All of the services are grouped by the same categorization as the Azure Portal uses.\nCategories List AI and ML Batch Compute Containers Databases General Hybrid Integration Internet of Things Management Migration Monitoring Networking Security Specialized Workloads Storage Web "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/1-define/",
	"title": "1 - Define",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 1 - Define",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;1 - Define (Requirements)\u0026rdquo; and associated resources and their settings.\nIn this initial stage, the objectives and requirements for system reliability are established. This often involves specifying availability and recovery targets, latency tolerances, criticality classifications, and disaster recovery objectives.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WADF-1 - Ensure the Availability Targets are well defined and communicated across teams working on the Workload Availability High Verified No WADF-2 - Ensure the Recovery Targets are well defined and communicated across teams working on the Workload Disaster Recovery High Verified No Definitions of states can be found here Recommendations Details WADF-1 - Ensure the Availability Targets are well defined and communicated across teams working on the Workload Category: Availability\nImpact: High\nRecommendation/Guidance\nEnsure the Availability Targets (SLA, SLO, SLI) are well defined, tested, monitored and communicated across teams working on the Workload.\nA Service Level Agreement (SLA) is an availability target that represents a commitment around performance and availability of the application. Understanding the SLA of individual components within the system is essential to define reliability targets. Knowing the SLA of dependencies will also provide a justification for additional spend when making the dependencies highly available and with proper support contracts. Availability targets for any dependencies leveraged by the application should be understood and ideally align with application targets should also be considered.\nUnderstanding your availability expectations is vital to reviewing overall operations for the application.\nFor example, if you are striving to achieve an application Service Level Objective (SLO) of 99.999%, the level of inherent operational action required by the application is going to be far greater than if an SLO of 99.9% was the goal.\nResources\nUse business metrics to design resilient Azure applications Target functional and nonfunctional requirements WADF-2 - Ensure the Recovery Targets are well defined and communicated across teams working on the Workload Category: Disaster Recovery\nImpact: High\nRecommendation/Guidance\nEnsure the Recovery Targets are well defined and communicated across teams working on the Workload. Two important metrics to consider are the recovery time objective and recovery point objective, as they pertain to disaster recovery.\nRecovery time objective (RTO) is the maximum acceptable time that an application can be unavailable after an incident. If your RTO is 90 minutes, you must be able to restore the application to a running state within 90 minutes from the start of a disaster. If you have a very low RTO, you might keep a second regional deployment continually running an active/passive configuration on standby, to protect against a regional outage. In some cases, you might deploy an active/active configuration to achieve even lower RTO. Recovery point objective (RPO) is the maximum duration of data loss that is acceptable during a disaster. For example, if you store data in a single database, with no replication to other databases, and perform hourly backups, you could lose up to an hour of data. RTO and RPO are non-functional requirements of a system and should be dictated by business requirements. To derive these values, it\u0026rsquo;s a good idea to conduct a risk assessment, and clearly understanding the cost of downtime or data loss. Monitoring and measuring application availability is vital to qualifying overall application health and progress towards defined targets. Make sure you measure and monitor key targets such as:\nMean Time Between Failures (MTBF) ‚Äî The average time between failures of a particular component. Mean Time to Recover (MTTR) ‚Äî The average time it takes to restore a component after a failure. Resources\nTarget functional and nonfunctional requirements "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/2-design/",
	"title": "2 - Design",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 2 - Design",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;2 - Design (Workload Design)\u0026rdquo; and associated resources and their settings.\nIn this Stage, the architecture and design decisions are made to meet the requirements defined earlier. Best practices for resilient and scalable systems are implemented, often including redundancy, failover strategies, and load balancing. In this phase failure mode and point analysis are coordinated in order to identify and mitigate possible failures, and single points of failures.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WADS-1 - Consider deploying your application across multiple zones Availability High Verified No WADS-2 - Consider deploying your application across multiple regions Disaster Recovery High Verified No WADS-3 - Ensure that all fault-points and fault-modes are understood and operationalized Availability High Verified No WADS-4 - Use PaaS Azure services instead of IaaS System Efficiency Medium Verified No WADS-5 - Design the application to scale out System Efficiency High Verified No WADS-6 - Create a landing zone for the workload following the Microsoft Cloud Adoption Framework Governance Low Verified No WADS-7 - Design a BCDR strategy that will help to meet the business requirements Disaster Recovery High Verified No WADS-8 - Provide security assurance through identity management Access \u0026amp; Security Medium Verified No WADS-9 - Ensure you address security-related risks helps to minimize application downtime and data loss caused by unexpected security exposures Access \u0026amp; Security High Verified No Definitions of states can be found here Recommendations Details WADS-1 - Consider deploying your application across multiple zones Category: Availability\nImpact: High\nRecommendation/Guidance\nDesign your application architecture to use availability zones within a region. Availability zones can be used to optimize application availability within a region by providing datacenter-level fault tolerance. However, the application architecture must not share dependencies between zones to use them effectively.\nConsider if component proximity is required for application performance reasons. If all or part of the application is highly sensitive to latency, components might need to be co-located which can limit the applicability of multi-region and multi-zone strategies.\nResources\nUse Availability Zones WADS-2 - Consider deploying your application across multiple regions Category: Disaster Recovery\nImpact: High\nRecommendation/Guidance\nIf your application is deployed to a single region, and the region becomes unavailable, your application will also be unavailable. This might be unacceptable under the terms of your application\u0026rsquo;s SLA.\nIf so, consider deploying your application and its services across multiple regions. A multiregional deployment can use an active-active or active-passive configuration.\nAn active-active configuration distributes requests across multiple active regions. An active-passive configuration keeps warm instances in the secondary region, but doesn\u0026rsquo;t send traffic there unless the primary region fails.\nResources\nDesign reliable Azure applications Cross-region replication in Azure: Business continuity and disaster recovery WADS-3 - Ensure that all fault-points and fault-modes are understood and operationalized Category: Availability\nImpact: High\nRecommendation/Guidance\nEnsure that all fault-points and fault-modes are understood and operationalized.\nFailure mode analysis (FMA) is a process for building resiliency into a system, by identifying possible failure points in the system. The FMA should be part of the architecture and design phases, so that you can build failure recovery into the system from the beginning.\nIdentify all fault-points and fault-modes. Fault-points describe the elements within an application architecture which can fail, while fault-modes capture the various ways by which a fault-point may fail. To ensure an application is resilient to end-to-end failures, it is essential that all fault-points and fault-modes are understood and operationalized .\nResources\nFailure mode analysis for Azure applications WADS-4 - Use PaaS Azure services instead of IaaS Category: System Efficiency\nImpact: Medium\nRecommendation/Guidance\nPaaS provides a framework for developing and running apps. As with IaaS, the PaaS provider hosts and maintains the platform\u0026rsquo;s servers, networks, storage, and other computing resources. But PaaS also includes tools, services, and systems that support the web application lifecycle. Developers use the platform to build apps without having to manage backups, security solutions, upgrades, and other administrative tasks.\nResources\nUse platform as a service (PaaS) options WADS-5 - Design the application to scale out Category: System Efficiency\nImpact: High\nRecommendation/Guidance\nAzure provides elastic scalability and you should design to scale out. However, applications must leverage a scale-unit approach to navigate service and subscription limits to ensure that individual components and the application as a whole can scale horizontally. Don\u0026rsquo;t forget about scale in, which is important to reduce cost. For example, scale in and out for App Service is done via rules. Often customers write scale out rules and never write scale in rules, which leaves the App Service more expensive.\nResources\nDesign to scale out WADS-6 - Create a landing zone for the workload following the Microsoft Cloud Adoption Framework Category: Governance\nImpact: Low\nRecommendation/Guidance\nFrom a workload perspective, a landing zone refers to a prepared platform into which the application gets deployed. A landing zone implementation can have compute, data sources, access controls, and networking components already provisioned. With the required plumbing ready in place; the workload needs to plug into it.\nWhen considering the overall security, a landing zone offers centralized security capabilities that adds a threat mitigation layer for the workload. Implementations can vary but here are some common strategies that enhance the security posture.\nIsolation through segmentation. You can isolate assets at several layers from Azure enrollment down to a subscription that has the resources for the workload. Consistent adoption of organizational policies, enforce creation and deletion of services and their configuration through Azure Policy. Configurations that align with principles of Zero Trust . For instance an implementation might have network connectivity to on-premises data centers. Resources\nAzure landing zone integration WADS-7 - Design a BCDR strategy that will help to meet the business requirements Category: Disaster Recovery\nImpact: High\nRecommendation/Guidance\nDisaster recovery is the process of restoring application functionality after a catastrophic loss. In cloud environments, we acknowledge up front that failures happen. Instead of trying to prevent failures altogether, the goal is to minimize the effects of a single failing component.\nTesting is one way to minimize these effects. You should automate testing of your applications where possible, but you also need to be prepared for when they fail. When a failure happens, having backup and recovery strategies becomes important. Your tolerance for reduced functionality during a disaster is a business decision that varies from one application to the next.\nIt might be acceptable for some applications to be temporarily unavailable, or partially available with reduced functionality or delayed processing. For other applications, any reduced functionality is unacceptable.\nKey points:\nCreate and test a disaster recovery plan regularly using key failure scenarios. Design a disaster recovery strategy to run most applications with reduced functionality. Design a backup strategy that\u0026rsquo;s tailored for the business requirements and circumstances of the application. Automate failover and failback steps and processes. Test and validate the failover and failback approach successfully at least once. Resources\nBackup and disaster recovery for Azure applications WADS-8 - Provide security assurance through identity management Category: Access \u0026amp; Security\nImpact: Medium\nRecommendation/Guidance\nProvide security assurance through identity management: the process of authenticating and authorizing security principals. Use identity management services to authenticate and grant permission to users, partners, customers, applications, services, and other entities. Identity management is typically a centralized function not controlled by the workload team as a part of the workload\u0026rsquo;s architecture.\nDefine clear lines of responsibility and separation of duties for each function. Restrict access based on a need-to-know basis and least privilege security principles. Assign permissions to users, groups, and applications at a certain scope through Azure RBAC. Use built-in roles when possible. Prevent deletion or modification of a resource, resource group, or subscription through management locks. Use managed identities to access resources in Azure. Resources\nAzure identity and access management considerations WADS-9 - Ensure you address security-related risks helps to minimize application downtime and data loss caused by unexpected security exposures Category: Access \u0026amp; Security\nImpact: High\nRecommendation/Guidance\nSecurity is one of the most important aspects of any architecture. It provides the following assurances against deliberate attacks and abuse of your valuable data and systems: Confidentiality ,Integrity, and Availability. The security of complex systems depends on understanding the business context, social context, and technical context. As you design your system, cover these areas:\nEnsure that the identity provider (AAD/ADFS/AD/Other) is highly available and aligns with application availability and recovery targets. All external application endpoints are secured. Communication to Azure PaaS services secured using Virtual Network Service Endpoints or Private Link. Keys and secrets are backed-up to geo-redundant storage, and are still available in a failover case. Ensure that the process for key rotation is automated and tested. Emergency access break glass accounts have been tested and secured for recovering from Identity provider failure scenarios. Resources\nSecurity design principles "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/",
	"title": "Well Architected Framework",
	"tags": null,
	"description": "Well-Architected Framework",
	"content": "This page lists all of the Well-Architected Framework Reliability Stages for which the APRL has guidance and recommendations for.\nReliability Stages The below list of Reliability Stages is automatically populated based on the child folders and files in this directory within the source code in the repo. 1 - Define 2 - Design 3 - Test 4 - Deploy 5 - Monitor 6 - Respond "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/3-test/",
	"title": "3 - Test",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 3 - Test",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;3 - Test (Workload Testing)\u0026rdquo; and associated resources and their settings.\nBefore deploying the system, comprehensive tests are conducted to validate the design and implementation. This stage is crucial for identifying any weaknesses that could compromise reliability.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WATS-1 - Test your applications for availability and resiliency Application Resilience High Verified No WATS-2 - Consider building logic into your workload to handle errors Application Resilience High Verified No WATS-3 - Perform disaster recovery tests regularly Disaster Recovery Medium Verified No WATS-4 - Use chaos engineering to test Azure applications Application Resilience Medium Verified No WATS-5 - Test application fault resiliency Application Resilience High Verified No Definitions of states can be found here Recommendations Details WATS-1 - Test your applications for availability and resiliency Category: Application Resilience\nImpact: High\nRecommendation/Guidance\nApplications should be tested to ensure availability and resiliency. Availability describes the amount of time that an application runs in a healthy state without significant downtime. Resiliency describes how quickly an application recovers from failure.\nBeing able to measure availability and resiliency can answer questions like: How much downtime is acceptable? How much does potential downtime cost your business? What are your availability requirements? How much do you invest in making your application highly available? What is the risk versus the cost? Testing plays a critical role in making sure your applications can meet these requirements.\nKey points:\nTest regularly to validate existing thresholds, targets, and assumptions. Automate testing as much as possible. Perform testing on both key Test environments and the production environment. Verify how the end-to-end workload performs under intermittent failure conditions. Test the application against critical functional and nonfunctional requirements for performance. Conduct load testing with expected peak volumes to Test scalability and performance under load. Perform chaos testing by injecting faults. Resources\nTesting applications for availability and resiliency WATS-2 - Consider building logic into your workload to handle errors Category: Application Resilience\nImpact: High\nRecommendation/Guidance\nIn a distributed system, ensuring that your application can recover from errors is critical. You can test your applications to prevent errors and failure, but you need to prepare for a wide range of issues. Testing doesn\u0026rsquo;t always catch everything, so you should understand how to handle errors and prevent potential failure.\nMany things in a distributed system, such as underlying cloud infrastructure and third-party runtime dependencies, are outside your span of control and your means to test. You can be sure something will fail eventually, so you need to be prepared.\nKey points:\nImplement retry logic to handle transient application failures and transient failures with internal or external dependencies. Uncover issues or failures in your application\u0026rsquo;s retry logic. Configure request timeouts to manage intercomponent calls. Configure and test health probes for your load balancers and traffic managers. Segregate read operations from update operations across application data stores. Resources\nError handling for resilient applications in Azure WATS-3 - Perform disaster recovery tests regularly Category: Disaster Recovery\nImpact: Medium\nRecommendation/Guidance\nDisaster recovery is the process of restoring application functionality after a catastrophic loss. In cloud environments, we acknowledge up front that failures happen. Instead of trying to prevent failures altogether, the goal is to minimize the effects of a single failing component. Testing is one way to minimize these effects. You should automate testing of your applications where possible, but you also need to be prepared for when they fail. When a failure happens, having backup and recovery strategies becomes important.\nYour tolerance for reduced functionality during a disaster is a business decision that varies from one application to the next. It might be acceptable for some applications to be temporarily unavailable, or partially available with reduced functionality or delayed processing. For other applications, any reduced functionality is unacceptable.\nKey points\nCreate and test a disaster recovery plan regularly using key failure scenarios. Design a disaster recovery strategy to run most applications with reduced functionality. Design a backup strategy that\u0026rsquo;s tailored for the business requirements and circumstances of the application. Automate failover and failback steps and processes. Test and validate the failover and failback approach successfully at least once. Resources\nBackup and disaster recovery for Azure applications WATS-4 - Use chaos engineering to test Azure applications Category: Application Resilience\nImpact: Medium\nRecommendation/Guidance\nIdeally, you should apply chaos principles continuously. There\u0026rsquo;s constant change in the environments in which software and hardware run, so monitoring the changes is key. By constantly applying stress or faults on components, you can help expose issues early, before small problems are compounded by many other factors.\nApply chaos engineering principles when you:\nDeploy new code. Add dependencies. Observe changes in usage patterns. Mitigate problems. Resources\nUse chaos engineering to test Azure applications WATS-5 - Test application fault resiliency Category: Application Resilience\nImpact: High\nGuidance\nHigh availability is a fundamental part of the SQL Database platform that works transparently for your database application. However, we recognize that you may want to test how the automatic failover operations initiated during planned or unplanned events would impact an application before you deploy it to production. You can manually trigger a failover by calling a special API to restart a database, or an elastic pool.\nIn the case of a zone-redundant serverless or provisioned General Purpose database or elastic pool, the API call would result in redirecting client connections to the new primary in an Availability Zone different from the Availability Zone of the old primary. So in addition to testing how failover impacts existing database sessions, you can also verify if it changes the end-to-end performance due to changes in network latency. Because the restart operation is intrusive and a large number of them could stress the platform, only one failover call is allowed every 15 minutes for each database or elastic pool.\nResources\nTest application fault resiliency "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/contributing/",
	"title": "Contributing",
	"tags": null,
	"description": "Contribution Guide for the Azure Proactive Resiliency Library (APRL)",
	"content": " Contributions Notice Currently we can only accept contributions from Microsoft FTEs. In the future we will look to change this. Looking to contribute to the Azure Proactive Resiliency Library (APRL), well you have made it to the right place/page üëç\nFollow the below instructions, especially the pre-requisites, to get started contributing to the library.\nWriting a recommendation APRL recommendations are intended to enable and accelerate the delivery of Well Architected Reliability Assessments. The purpose of APRL is not to replace existing Azure public documentation and guidance on best practices.\nEach recommendation should be actionable for the customer. The customer should be able to place the recommendation in their backlog and the engineer that picks it up should have complete clarity on the change that needs to be made and the specific resources that the change should be made to.\nEach recommendation should include a descriptive title, a short guidance section that contains additional detail on the recommendation, links to public documentation that provide additional information related to the recommendation, and a query to identify resources that are not compliant with the recommendation. The title and guidance sections alone should provide sufficient information for a CSA to evaluate a resource.\nRecommendations should not require the CSA to spend a lot of time on background reading, they should not be open to interpretation, and they should not be vague. Remember that the CSA delivering the WARA is reviewing a large number of Azure resources in a limited amount of time and is not an expert in every Azure service.\nExamples\nGood recommendation: Use a /24 subnet for the service Bad recommendation: Size your subnet appropriately Not all best practices make good APRL recommendations. If the best practice relates to a particular service configuration and can be checked with an ARG query, it probably makes for a good APRL recommendation. If the best practice is more aligned to general architectural concepts that are true for many service or workload types, we very likely already have a recommendation in the APRL WAF section that addresses the topic. If not, consider adding a WAF recommendation to APRL. If neither is the case, APRL may not be the best location for this content.\nContext/Background Before jumping into the pre-requisites and specific section contribution guidance, please familiarize yourself with this context/background on how this library is built to help you contribute going forward.\nThis site is built using Hugo, a static site generator, that\u0026rsquo;s source code is stored in the APRL GitHub repo (link in header of this site too) and is hosted on GitHub Pages, via the repo.\nThe reason for the combination of Hugo \u0026amp; GitHub pages is to allow us to present an easy to navigate and consume library, rather than using a native GitHub repo, which is not easy to consume when there are lots of pages and folders. Also Hugo generates the site in such a way that it is also friendly for mobile consumers.\nBut I don\u0026rsquo;t have any skills in Hugo? That\u0026rsquo;s okay and you really don\u0026rsquo;t need them. Hugo just needs you to be able to author markdown (.md) files and it does the rest when it generates the site üëç\nPre-Requisites Read and follow the below sections to leave you in a \u0026ldquo;ready state\u0026rdquo; to contribute to APRL.\nA \u0026ldquo;ready state\u0026rdquo; means you have a forked copy of the Azure/Azure-Proactive-Resiliency-Library repo cloned to your local machine and open in VS Code.\nRun and Access a Local Copy of APRL During Development When in VS Code you should be able to open a terminal and run the below commands to access a copy of the APRL website from a local web server, provided by Hugo, using the following address http://localhost:1313/Azure-Proactive-Resiliency-Library/:\nCopy cd docs hugo server -D Software/Applications To contribute to this project/repo/library you will need the following installed:\nYou can use winget to install all the pre-requisites easily for you. See the below section Git Visual Studio Code (VS Code) Extensions: editorconfig.editorconfig, streetsidesoftware.code-spell-checker, ms-vsliveshare.vsliveshare, medo64.render-crlf, vscode-icons-team.vscode-icons VS Code will recommend automatically to install these when you open this repo, or a fork of it, in VS Code. Hugo Extended winget Install Commands To install winget follow the install instructions here.\nCopy winget install --id \u0026#39;Git.Git\u0026#39; winget install --id \u0026#39;Microsoft.VisualStudioCode\u0026#39; winget install --id \u0026#39;Hugo.Hugo.Extended\u0026#39; Other requirements A GitHub profile/account A fork of the Azure/Azure-Proactive-Resiliency-Library repo into your GitHub org/account and cloned locally to your machine Instructions on forking a repo and then cloning it can be found here Useful Resources Below are links to a number of useful resources to have when contributing to APRL:\nAce Documentation Theme (that we use) - Docs Shortcodes - e.g. Code Ace Documentation Theme (that we use) - Repo The Example Site, which is the first link above, source code Hugo Quick Start Hugo Docs Markdown Cheat Sheet Steps to do before contributing anything (after pre-requisites) Run the following commands in your terminal of choice from the directory where you fork of the repo is located:\nCopy git checkout main git pull git fetch -p git fetch -p upstream git pull upstream main git push Doing this will ensure you have the latest changes from the upstream repo and you are ready to now create a new branch from main by running the below commands:\nCopy git checkout main git checkout -b \u0026lt;YOUR-DESIRED-BRANCH-NAME-HERE\u0026gt; Creating a Service\u0026rsquo;s Recommendation Page Important Make sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section. The is a common task that is likely to be done is adding a new service to which you want to provide recommendations and supporting queries etc. for example Virtual Machines.\nFor this task we use Hugo\u0026rsquo;s archetype features which enables you to create a whole directory for a new service with a lot of templated content ready for you to change and use. This can be called by using the following command hugo new --kind service-bundle services/\u0026lt;category\u0026gt;/\u0026lt;service-name\nYou can see source code of the directory archetype called service-bundle here in the repo.\nFor the steps below we will use the Virtual Machine service as an example. Please change this to the service you are wanting to create. Steps to follow:\nIn your terminal of choice run the following: Copy cd docs/ hugo new --kind service-bundle services/compute/virtual-machines You will now see a new folder in content/services/compute called virtual-machines Copy ‚îú‚îÄ‚îÄ‚îÄcontent ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcontributing ‚îÇ ‚îî‚îÄ‚îÄ‚îÄservices ‚îÇ ‚îú‚îÄ‚îÄ‚îÄai-ml ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcompute ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄvirtual-machines ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcode ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcm-1 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcm-2 Inside the virtual-machines folder you will see the following files pre-staged Copy ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄvirtual-machines ‚îÇ ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcode ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcm-1 ‚îÇ ‚îÇ ‚îÇ cm-1.azcli ‚îÇ ‚îÇ ‚îÇ cm-1.kql ‚îÇ ‚îÇ ‚îÇ cm-1.ps1 ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcm-2 ‚îÇ ‚îÇ cm-2.azcli ‚îÇ ‚îÇ cm-2.kql ‚îÇ ‚îÇ cm-2.ps1 Open _index.md in VS Code and make relevant changes You can copy the recommendations labelled CM-1 or CM-2 multiple times to create more recommendations Update Azure Resource Graph queries, PowerShell, AZCLI scripts in the code folder within virtual-machines You will see there is a folder, e.g. cm-1, cm-2, per recommendation to help with file structure organization Ensure you use the correct Azure resource abbreviations provided within our Cloud Adoption Framework (CAF) documentation here. For example, use vm for Virtual Machines. Save, commit and push your changes to your branch and repo Create a create a Pull Request into the main branch of the upstream repo Get it merged Don\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here. Automation Standards for Recommendations When creating recommendations for a service, please follow the below standards:\nRecommendation categories Each recommendation should have one and only one associated category from this list below.\nRecommendation Category Category Description Application Resilience Ensures software applications remain functional under failures or disruptions. Utilizes fault-tolerance, stateless architecture, and microservices to maintain application health and reduce downtime. Automation Uses automated systems or scripts for routine tasks, backups, and recovery. Minimizes human intervention, thereby reducing errors and speeding up recovery processes. Availability Focuses on ensuring services are accessible and operational. Combines basic mechanisms like backups with advanced techniques like clustering and data replication to achieve near-zero downtime. (Includes High Availability) Access \u0026amp; Security Encompasses identity management, authentication, and security measures for safeguarding systems. Centralizes access control and employs robust security mechanisms like encryption and firewalls. (Includes Identity) Governance Involves policies, procedures, and oversight for IT resource utilization. Ensures adherence to legal, regulatory, and compatibility requirements, while guiding overall system management. (Includes Compliance and Compatibility) Disaster Recovery Involves strategies and technologies to restore systems and data after catastrophic failures. Utilizes off-site backups, recovery sites, and detailed procedures for quick recovery after a disaster. System Efficiency Maintains acceptable service levels under varying conditions. Employs techniques like resource allocation, auto-scaling, and caching to handle changes in load and maintain smooth operation. (Includes Performance and Scalability) Monitoring Involves constant surveillance of system health, performance, and security. Utilizes real-time alerts and analytics to identify and resolve issues quickly, aiding in faster response times. Networking Aims to ensure uninterrupted network service through techniques like failover routing, load balancing, and redundancy. Focuses on maintaining the integrity and availability of network connections. Storage Focuses on the integrity and availability of data storage systems. Employs techniques like RAID, data replication, and backups to safeguard against data loss or corruption. Azure Resource Graph (ARG) Queries All ARG queries should have two comments at the top of the query, one comment stating Azure Resource Graph Query and another comment providing a description of the query results returned. For example:\n// Azure Resource Graph Query // Provides a list of Azure Container Registry resources that do not have soft delete enabled If the ARG query is under development, the query should have a single line stating: // under-development\nIf a recommendation query cannot be returned due to limitations with the data provided within ARG, the query should have a single line stating: // cannot-be-validated-with-arg\nQueries should only return resources that do not adhere to the APRL recommendation. For example, if the recommendation is to enable soft delete for Azure Container Registries, the associated query should only return Azure Container Registry resources that do not have soft delete enabled.\nIf a ARG query folder has a file with a file type suffixed with .fix, this means that the current query does not work as anticipated and to consider using this as a starting point for fixing the query. Once you have validated that the query is working as anticipated, please remove the file with the .fix suffix.\nARG query columns name returned should only include the following:\nNOTE: The column names should be in the order they are listed and match exactly. Column Name Required Information Returned (Example) Description recommendationId Yes aks-1 The acronym of the Azure service that the query is returning results for, followed by the APRL recommendation number. name Yes test-aks The resource name of the Azure resource that does not adher to the APRL recommendation. id Yes /subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test-resource-group/providers/Microsoft.ContainerService/managedClusters/test-aks The resource ID of the Azure resource that does not adhere to the APRL recommendation. tags No {\u0026ldquo;Environment\u0026rdquo;:\u0026ldquo;Test\u0026rdquo;,\u0026ldquo;Department\u0026rdquo;:\u0026ldquo;IT\u0026rdquo;} Any relevant tags associated to the resource that does not adhere to the APRL recommendation. param1 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param2 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param3 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param4 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param5 No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. If you need support with validating a query, please reach out to the APRL team via the APRL GitHub General Question/Feedback Form Azure PowerShell Scripts All PowerShell scripts should have two comments at the top of the script, one comment stating Azure PowerShell script and another comment providing a description of the script results returned. For example:\n# Azure PowerShell script # Provides a list of Azure Container Registry resources that do not have soft delete enabled Scripts should only return resources that do not adhere to the APRL recommendation. For example, if the recommendation is to enable soft delete for Azure Container Registries, the associated scripts should only return Azure Container Registry resources that do not have soft delete enabled.\nScripts should exclusively contain code to retrieve resources that do not comply with the APRL recommendation. They should not include supporting code, such as Azure sign-in (Connect-AzAccount, Login-AzAccount) or subscription selection (Set-AzContext, Select-AzSubscription). Execute these cmdlets separately from the APRL recommendation PowerShell script.\nThe script should return the result as an array of the PSCustomObject data type, with each result object containing only the following properties:\nNOTE: The property names should be in the order they are listed and match exactly. Property Name Data Type Required Information Returned (Example) Description recommendationId string Yes aks-1 The acronym of the Azure service that the query is returning results for, followed by the APRL recommendation number. name string Yes test-aks The resource name of the Azure resource that does not adher to the APRL recommendation. id string Yes /subscriptions/00000000-0000-0000-0000-000000000000/resourcegroups/test-resource-group/providers/Microsoft.ContainerService/managedClusters/test-aks The resource ID of the Azure resource that does not adhere to the APRL recommendation. tags PSCustomObject No {\u0026ldquo;Environment\u0026rdquo;:\u0026ldquo;Test\u0026rdquo;,\u0026ldquo;Department\u0026rdquo;:\u0026ldquo;IT\u0026rdquo;} Any relevant tags associated to the resource that does not adhere to the APRL recommendation. The data type should match the data type of tags in the result of ARG queries by Search-AzGraph. If not set tags, set $null. param1 string No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param2 string No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param3 string No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param4 string No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. param5 string No networkProfile:kubenet Any additional information that is necessary to provide clarification for the APRL recommendation. Below is a sample code to return a result that aligned to the above standards.\n[PSCustomObject] @{ recommendationId = \u0026#39;aks-1\u0026#39; name = $resource.Name id = $resource.Id tags = if ($resource.Tags) { [PSCustomObject] ([Hashtable] $resource.Tags) } else { $null } param1 = \u0026#39;networkProfile:kubenet\u0026#39; param2 = \u0026#39;networkProfile:kubenet\u0026#39; param3 = \u0026#39;networkProfile:kubenet\u0026#39; param4 = \u0026#39;networkProfile:kubenet\u0026#39; param5 = \u0026#39;networkProfile:kubenet\u0026#39; } If you need support with validating a script, please reach out to the APRL team via the APRL GitHub General Question/Feedback Form Updating a Service\u0026rsquo;s Recommendation Page Important Make sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section. This is likely the most common task that will be performed.\nAll you need to do is just make edits directly to the existing markdown (.md) files, save your changes, commit, stage and push them to your branch and repo. Then create a Pull Request into the main branch of the upstream repo and you are done üëç\nDon\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here. Creating a Service Category Important Make sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section. For this task we use Hugo\u0026rsquo;s archetype features which enables you to create a whole directory for a new service with a lot of templated content ready for you to change and use. This can be called by using the following command hugo new --kind category-bundle services/\u0026lt;category\u0026gt;\nYou can see source code of the directory archetype called category-bundle here in the repo.\nFor the steps below we will use the AAA category as an example. Please change this to the category you are wanting to create. Steps to follow:\nIn your terminal of choice run the following: Copy cd docs/ hugo new --kind category-bundle services/aaa You will now see a new folder in content/services called aaa Copy ‚îú‚îÄ‚îÄ‚îÄcontent ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcontributing ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄservices ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄaaa ‚îÇ ‚îÇ _index.md Inside the aaa folder you will see the following file _index.md pre-staged Copy ‚îú‚îÄ‚îÄ‚îÄaaa ‚îÇ ‚îÇ _index.md Open _index.md in VS Code and make relevant changes Save, commit and push your changes to your branch and repo Create a create a Pull Request into the main branch of the upstream repo Get it merged Don\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here. Top Tips Sometimes the local version of the website may show some inconsistencies that don\u0026rsquo;t reflect the content you have created. If this happens, simply kill the Hugo local web server by pressing CTRL+C and then restart the Hugo web server by running hugo server -D from the docs/ directory "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/4-deploy/",
	"title": "4 - Deploy",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 4 - Deploy",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;4 - Deploy (Automation and Deployment)\u0026rdquo; and associated resources and their settings.\nAt this stage, the system is launched into a production environment. Proper deployment strategies, like blue-green or canary deployments, are used to minimize risks associated with releasing new versions.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WADP-1 - Avoid manual configuration to enforce consistency with Infrastructure as code Automation Medium Verified No WADP-2 - Validated all changes in development environments before applying them to Production Automation Medium Verified No Definitions of states can be found here Recommendations Details WADP-1 - Avoid manual configuration to enforce consistency with Infrastructure as code Category: Automation\nImpact: Medium\nRecommendation/Guidance\nInfrastructure as code (IaC) uses DevOps methodology and versioning with a descriptive model to define and deploy infrastructure, such as networks, virtual machines, load balancers, and connection topologies. Just as the same source code always generates the same binary, an IaC model generates the same environment every time it deploys.\nIaC is a key DevOps practice and a component of continuous delivery. With IaC, DevOps teams can work together with a unified set of practices and tools to deliver applications and their supporting infrastructure rapidly and reliably at scale.\nKey Points:\nAvoid manual configuration to enforce consistency Deliver stable test environments rapidly at scale Use declarative definition files Resources\nAvoid manual configuration to enforce consistency WADP-2 - Validated all changes in development environments before applying them to production Category: Automation\nImpact: Medium\nRecommendation/Guidance\nContinuously delivering value has become a mandatory requirement for organizations. To deliver value to your end users, you must release continually and without errors. Continuous delivery (CD) is the process of automating build, test, configuration, and deployment from a build to a production environment. A release pipeline can create multiple testing or staging environments to automate infrastructure creation and deploy new builds. Successive environments support progressively longer-running integration, load, and user acceptance testing activities.\nResources\nSafe deployment practices "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/privacy/",
	"title": "Privacy",
	"tags": null,
	"description": "This Privacy Policy outlines how we collect and use your data when you interact with this website.",
	"content": "We partner with Microsoft Clarity to capture how you use and interact with our website through behavioral metrics, heatmaps, and session replay to improve the content and usage of the website. Website usage data is captured using first and third-party cookies and other tracking technologies and is used for site optimization. For more information about how Microsoft collects and uses your data, visit the Microsoft Privacy Statement.\n"
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/5-monitor/",
	"title": "5 - Monitor",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 5 - Monitor",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;5 - Monitor (Observability and Monitoring)\u0026rdquo; and associated resources and their settings.\nOngoing monitoring is essential for maintaining system reliability. Key performance indicators (KPIs) are constantly observed to ensure the system is meeting its defined objectives. Services like Azure Monitor, Network Watcher, and Service Health can be invaluable here.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WAMN-1 - Make sure your application\u0026rsquo;s health is being monitored Monitoring Medium Verified No WAMN-2 - Define a health model based on performance, availability, and recovery targets Monitoring Low Verified No WAMN-3 - Create Dashboards and Alerts for Azure Platform resources Monitoring Low Verified No WAMN-4 - Ensure that the right people in your organization will be notified about any future service issues Monitoring Medium Verified No Definitions of states can be found here Recommendations Details WAMN-1 - Make sure your application\u0026rsquo;s health is being monitored Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nMonitoring and diagnostics are crucial for availability and resiliency. If something fails, you need to know that it failed, when it failed, and why.\nMonitoring isn\u0026rsquo;t the same as failure detection. For example, your application might detect a transient error and retry, avoiding downtime. It should also log the retry operation so that you can monitor the error rate to get an overall picture of application health.\nKey points:\nDefine alerts that are actionable and effectively prioritized. Create alerts that poll for services nearing their limits and quotas. Use application instrumentation to detect and resolve performance anomalies. Track the progress of long-running processes. Troubleshoot issues to gain an overall view of application health. Document how to analyze, diagnose, and respond to signals being monitored Resources\nMonitoring application health for reliability WAMN-2 - Define a health model based on performance, availability, and recovery targets Category: Monitoring\nImpact: Low\nRecommendation/Guidance\nThe health model should be able to surface the health of critical system flows or key subsystems to ensure that appropriate operational prioritization is applied. For example, the health model should be able to represent the current state of the user sign-in transaction flow.\nThe health model shouldn\u0026rsquo;t treat all failures the same. The health model should distinguish between transient and non transient faults. It should clearly distinguish between expected-transient but recoverable failures and a true disaster state.\nKey points:\nKnow how to tell if an application is healthy or unhealthy. Understand the effects of logs in diagnostic data. Ensure the consistent use of diagnostic settings across the application. Use critical system flows in your health model. Resources\nHealth modeling for reliability WAMN-3 - Create Dashboards and Alerts for Azure Platform resources Category: Monitoring\nImpact: Low\nRecommendation/Guidance\nIn this stage, telemetry data is presented so that an operator can quickly notice problems or trends. Examples include Workbook, Dashboards or email alerts. With Azure Workbooks and/or dashboards, you can build a single pane of glass view of monitoring graphs originating from Application Insights, Log Analytics, Azure Monitor metrics and service health. With Azure Monitor alerts, you can create alerts on service health and resource health.\nResources\nAzure Workbooks templates WAMN-4 - Ensure that the right people in your organization will be notified about any future service issues Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nAzure offers a suite of experiences to keep you informed about the health of your cloud resources. The Service Health portal tracks four types of health events that may impact your resources:\nService issues - Problems in the Azure services that affect you right now (Outages) Planned maintenance - Upcoming maintenance that can affect the availability of your services in the future. Health advisories - Changes in Azure services that require your attention. Examples include deprecation of Azure features or upgrade requirements (e.g upgrade to a supported PHP framework). Security advisories - Security related notifications or violations that may affect the availability of your Azure services. Resources\nCreate a Service Health alert using the Azure portal "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/well-architected/6-respond/",
	"title": "6 - Respond",
	"tags": null,
	"description": "Microsoft Azure Well-Architected Framework best practices and recommendations for the Reliability Stage - 6 - Respont",
	"content": "The presented Microsoft Azure Well-Architected Framework recommendations in this guidance include Reliability Stage \u0026ldquo;6 - Respond (Responding to Failures)\u0026rdquo; and associated resources and their settings.\nThis final stage involves having plans and procedures in place to react to incidents affecting reliability. This includes automated failovers, backup restoration, and escalation protocols for manual intervention.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WARD-1 - Implement proactive Incident Response Disaster Recovery High Verified No Definitions of states can be found here Recommendations Details WARD-1 - Implement proactive Incident Response Category: Disaster Recovery\nImpact: High\nRecommendation/Guidance\nPrevention of all problems is a laudable, but impossible goal. Things will go wrong, so we need a plan to limit the impact on our end users and return operations to normal as quickly as possible.\nThe key is to respond with urgency, rather than react. A reaction tends to be more impulsive and based in the present moment, without consideration of long-term effects. A response is well-thought-out, organized, and information based.\nYour incident response approach determines your effectiveness at:\nUnderstanding what‚Äôs going on (diagnosing the problem) Triaging (determining the urgency) and prioritizing the problem Engaging the right resources to mitigate the issue(s), and Communicating with stakeholders about the problem After the problem has been remediated, you can then learn from the incident through a post-incident review process. That\u0026rsquo;s an important subject which has a whole separate module worth of discussion.\nResources\nImportance of incident response Incident tracking "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/sqldb/",
	"title": "SQL DB",
	"tags": null,
	"description": "Best Practices and Resiliency Recommendations for Azure SQL Database",
	"content": "The presented resiliency recommendations in this guidance include Azure Database Services\nSummary of Recommendations Recommendation Category Impact State ARG Query Available SQLDB-1 - Use Active Geo Replication to Create a Readable Secondary in Another Region Disaster Recovery High Preview Yes SQLDB-2 - Use Auto Failover Groups that can include one or multiple databases, typically used by the same application Disaster Recovery High Preview Yes SQLDB-3 - Use a Zone-Redundant database Availability Medium Preview Yes SQLDB-4 - Implement Retry Logic Application Resilience High Preview Yes SQLDB-5 - Monitor your Azure SQL Database in near-real time to detect reliability incidents Monitoring High Preview Yes SQLDB-6 - Back up your keys Disaster Recovery Medium Preview Yes Definitions of states can be found here Recommendations Details SQLDB-1 - Use Active Geo Replication to Create a Readable Secondary in Another Region Category: Disaster Recovery\nImpact: High\nGuidance\nIf your primary database fails, perform a manual failover to the secondary database. Until you fail over, the secondary database remains read-only. Active geo-replication enables you to create readable replicas and manually failover to any replica if there is a datacenter outage or application upgrade. Up to four secondaries are supported in the same or different regions, and the secondaries can also be used for read-only access queries. The failover must be initiated manually by the application or the user. After failover, the new primary has a different connection end point.\nResources\nActive Geo Replication Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of SQL databases that are not configured for Geo-redundant storage. resources | where type == \u0026#34;microsoft.sql/servers/databases\u0026#34; | where (properties[\u0026#39;currentBackupStorageRedundancy\u0026#39;] ) \u0026lt;\u0026gt; \u0026#39;Geo\u0026#39; | project recommendationId = \u0026#34;sqldb-1\u0026#34;, name, id, tags, param1=strcat(\u0026#34;CurrentGeoRedudancy=\u0026#34;, properties[\u0026#39;currentBackupStorageRedundancy\u0026#39;] ) SQLDB-2 - Use Auto Failover Groups that can include one or multiple databases, typically used by the same application Category: Disaster Recovery\nImpact: High\nGuidance\nYou can use the readable secondary databases to offload read-only query workloads. Because autofailover groups involve multiple databases, these databases must be configured on the primary server. Autofailover groups support replication of all databases in the group to only one secondary server or instance in a different region.\nResources\nAutoFailover Groups DR Design Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of SQL databases that are not configured to use a failover-group. resources | where type =~\u0026#39;microsoft.sql/servers/databases\u0026#39; | where isnull(properties[\u0026#39;failoverGroupId\u0026#39;]) | project recommendationId = \u0026#34;sqldb-2\u0026#34;, name, id, tags, param1= strcat(\u0026#34;databaseId=\u0026#34;, properties[\u0026#39;databaseId\u0026#39;]) SQLDB-3 - Use a Zone-Redundant Database Category: Availability\nImpact: Medium\nGuidance\nBy default, the cluster of nodes for the premium availability model is created in the same datacenter. With the introduction of Azure Availability Zones, SQL Database can place different replicas of the Business Critical database to different availability zones in the same region. To eliminate a single point of failure, the control ring is also duplicated across multiple zones as three gateway rings (GW). The routing to a specific gateway ring is controlled by Azure Traffic Manager (ATM). Because the zone redundant configuration in the Premium or Business Critical service tiers doesn\u0026rsquo;t create extra database redundancy, you can enable it at no extra cost.\nResources\n-Zone Redundant Databases\nResource Graph Query/Scripts\nShow/Hide Query/Script Copy Resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | where tolower(tostring(properties.zoneRedundant))=~\u0026#39;false\u0026#39; |project recommendationId = \u0026#34;sqldb-3\u0026#34;, name, id, tags SQLDB-4 - Implement Retry Logic Category: Application Resilience\nImpact: High\nGuidance\nAlthough Azure SQL Database is resilient when it concerns transitive infrastructure failures, these failures might affect your connectivity. When a transient error occurs while working with SQL Database, make sure your code can retry the call.\nResources\nHow to Implement Retry Logic Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SQLDB-5 - Monitor your Azure SQL Database in Near Real-Time to Detect Reliability Incidents Category: Monitoring\nImpact: Medium\nGuidance\nUse one of the available solutions to monitor SQL DB to detect potential reliability incidents early and make your databases more reliable. Choose a near real-time monitoring solution to quickly react to incidents.\nResources\nAzure Monitor Azure SQL Database Monitoring Monitoring SQL Database Reference Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of SQL databases that are not configured for monitoring. resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | project databaseid = properties_scopes, monitoredMetric = properties_criteria_allOf.metricName | where databaseid contains \u0026#39;databases\u0026#39; | summarize monitoredMetrics=make_list(monitoredMetric) by tostring(databaseid) | join kind=fullouter ( resources | where type =~ \u0026#39;microsoft.sql/servers/databases\u0026#39; | project databaseid = tolower(id), name, tags ) on databaseid |where isnull(monitoredMetrics) |project recommendationId = \u0026#34;sqldb-5\u0026#34;, name, id=databaseid1, tags, param1=strcat(\u0026#34;MonitoringMetrics=false\u0026#34; ) SQLDB-6 - Back Up Your Keys Category: Disaster Recovery\nImpact: Medium\nGuidance\nIt is highly recommended to use Azure Key Vault (AKV) to store encryption keys related to Always Encrypted configurations, however it is not required. If you are not using AKV, then ensure that your keys are properly backed up.\nResources\nAzure Key Vault Getting Started with Always Encrypted Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/ai-ml/",
	"title": "AI and ML",
	"tags": null,
	"description": "Artificial Intelligence (AI) and Machine Learning (ML) Services",
	"content": "This page lists all of the Azure Services under the AI and ML category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Azure Databricks "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/batch/",
	"title": "Batch",
	"tags": null,
	"description": "Batch Services",
	"content": "This page lists all of the Azure Services under the Batch (High Performance Computing) category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Batch Accounts "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/",
	"title": "Compute",
	"tags": null,
	"description": "Compute Services",
	"content": "This page lists all of the Azure Services under the Compute category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Azure Site Recovery Compute Gallery Image Templates Virtual Machine Scale Sets Virtual Machines "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/container/",
	"title": "Containers",
	"tags": null,
	"description": "Container Services",
	"content": "This page lists all of the Azure Services under the Containers category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. AKS Container Registry "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/",
	"title": "Databases",
	"tags": null,
	"description": "Database Services",
	"content": "This page lists all of the Azure Services under the Databases category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. SQL DB Cosmos DB DB for MySQL DB for PostgreSQL Redis Cache "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/general/",
	"title": "General",
	"tags": null,
	"description": "General Services",
	"content": "This page lists all of the Azure Services under the General category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/hybrid/",
	"title": "Hybrid",
	"tags": null,
	"description": "Hybrid Services",
	"content": "This page lists all of the Azure Services under the Hybrid category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/integration/",
	"title": "Integration",
	"tags": null,
	"description": "Integration Services",
	"content": "This page lists all of the Azure Services under the Integration category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Api Management Event Grid Event Hub Service Bus "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/iot/",
	"title": "Internet of Things",
	"tags": null,
	"description": "Internet of Things Services",
	"content": "This page lists all of the Azure Services under the Internet of Things category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. IoT Hub "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/management/",
	"title": "Management",
	"tags": null,
	"description": "Management Services",
	"content": "This page lists all of the Azure Services under the Management category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Automation Account Management Groups Resource Groups "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/migration/",
	"title": "Migration",
	"tags": null,
	"description": "Migration Services",
	"content": "This page lists all of the Azure Services under the Migration category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Azure Backup "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/monitoring/",
	"title": "Monitoring",
	"tags": null,
	"description": "Monitoring Services",
	"content": "This page lists all of the Azure Services under the Monitoring category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Application Insights Log Analytics Resource Health Alerts Service Health Alerts "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/",
	"title": "Networking",
	"tags": null,
	"description": "Networking Services",
	"content": "This page lists all of the Azure Services under the Networking category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Application Gateway DDoS Protection Plans ExpressRoute Circuits ExpressRoute Connection ExpressRoute Direct ExpressRoute Gateway ExpressRoute Traffic Collector Firewall Front Door Load Balancer Network Security Group Network Watcher Private DNS Zones Private Endpoints Public Ip Route Table Traffic Manager Virtual Networks VPN Gateway Web Application Firewall "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/security/",
	"title": "Security",
	"tags": null,
	"description": "Security Services",
	"content": "This page lists all of the Azure Services under the Security category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Key Vault "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/specialized-workloads/",
	"title": "Specialized Workloads",
	"tags": null,
	"description": "Specialized Workloads Services",
	"content": "This page lists all of the Azure Services under the Specialized Workloads category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Azure Virtual Desktop Azure VMware Solution SAP on Azure "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/storage/",
	"title": "Storage",
	"tags": null,
	"description": "Storage Services",
	"content": "This page lists all of the Azure Services under the Storage category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. Azure NetApp Files Storage Account "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/web/",
	"title": "Web",
	"tags": null,
	"description": "Web Services",
	"content": "This page lists all of the Azure Services under the Web category for which the APRL has guidance, recommendations and queries for.\nServices List The below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo. App Service Plan SignalR Web App "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/container/aks/",
	"title": "AKS",
	"tags": null,
	"description": "Best practices and resiliency recommendations for AKS and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Aks and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available AKS-1 - Deploy AKS cluster across availability zones Availability High Preview Yes AKS-2 - Isolate system and application pods Governance High Preview Yes AKS-3 - Disable local accounts Access \u0026amp; Security High Preview Yes AKS-4 - Configure Azure CNI networking for dynamic allocation of IPs Networking Medium Preview Yes AKS-5 - Enable the cluster auto-scaler on an existing cluster System Efficiency High Preview Yes AKS-6 - Back up Azure Kubernetes Service Disaster Recovery Low Preview No AKS-7 - Plan an AKS version upgrade Compliance High Preview No AKS-8 - Ensure that Persistent Volumes in storage account are redundant for Pods with stateful applications Availability Low Preview No AKS-9 - Upgrade Persistent Volumes with deprecated version to Azure CSI drivers Storage High Preview No AKS-10 - Implement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits. System Efficiency Low Preview No AKS-11 - Attach Virtual Nodes (ACI) to the AKS cluster System Efficiency Low Preview No AKS-12 - Update AKS tier to Standard Availability High Preview Yes AKS-13 - Enable AKS Monitoring Monitoring High Preview Yes AKS-14 - Use Ephemeral Disks on AKS clusters System Efficiency Medium Preview No AKS-15 - Enable and remediate Azure Policies configured for AKS Governance Low Preview No AKS-16 - Enable GitOps when using DevOps frameworks Automation Low Preview Yes AKS-17 - Configure affinity or anti-affinity rules based on application requirements Availability High Preview No AKS-18 - Configures Pods Liveness, Readiness, and Startup Probes Availability High Preview No AKS-19 - Configure Pod replica sets in production applications to guarantee availability Availability High Preview No AKS-20 - Configure system nodepool count Availability High Preview Yes AKS-21 - Configure user nodepool count Availability High Preview Yes AKS-22 - Configure pod disruption budgets (PDBs) Availability Medium Preview No AKS-23 - Nodepool subnet size needs to accommodate maximum auto-scale settings Availability High Preview No AKS-24 - Enforce resource quotas at the namespace level Availability High Preview No Definitions of states can be found here Recommendations Details AKS-1 - Deploy AKS cluster across availability zones Category: Availability\nImpact: High\nGuidance\nAzure Availability Zones are a high-availability offering that protects applications and data from datacenter-level failures. Availability Zones are unique physical locations within an Azure region that are equipped with independent power, cooling, and networking. Each Availability Zone is made up of one or more datacenters and is designed to be highly available and fault tolerant.\nBy deploying resources such as aks clusters, virtual machines, storage, and databases across multiple Availability Zones in the same region, you can protect your applications and data from datacenter-level failures. If one Availability Zone goes down, the other Availability Zones in the region can continue to provide service.\nResources\nAKS Availability Zones Zone Balancing Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns AKS clusters that do not have any availability zones enabled resources | where type == \u0026#39;microsoft.containerservice/managedclusters\u0026#39; | project id, name, location, properties.agentPoolProfiles | mv-expand properties_agentPoolProfiles | where isempty(array_length(properties_agentPoolProfiles.availabilityZones)) | project recommendationId=\u0026#34;aks-1\u0026#34;, id, name, tags, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, properties_agentPoolProfiles.name), param2=strcat(\u0026#34;orchestratorVersion: \u0026#34;, properties_agentPoolProfiles.orchestratorVersion), param3=strcat(\u0026#34;currentOrchestratorVersion: \u0026#34;, properties_agentPoolProfiles.currentOrchestratorVersion), param4=strcat(\u0026#34;numberOfZones: \u0026#34;, iff(isempty(array_length(properties_agentPoolProfiles.availabilityZones)), 0, array_length(properties_agentPoolProfiles.availabilityZones))) AKS-2 - Isolate system and application pods Category: Governance\nImpact: High\nGuidance\nAKS automatically assigns the label kubernetes.azure.com/mode: system to nodes in a system node pool. This label signals to AKS that system pods should be scheduled on nodes in this pool. However, you can still schedule application pods on these nodes if you choose to do so.\nTo prevent misconfigured or rogue application pods from accidentally killing system pods, it is recommended that you isolate critical system pods from your application pods. This can be achieved by scheduling system pods on dedicated node pools or by using node selectors to ensure that system pods are only scheduled on nodes with the kubernetes.azure.com/mode: system label.\nResources\nSystem and user node pools Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns each AKS cluster with nodepools that do not have taints set resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taint = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where isempty(taint) | project recommendationid=\u0026#34;aks-2\u0026#34;, id, name, tags, param1=strcat(\u0026#34;nodepoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;taint: \u0026#34;, iff(isempty(taint), \u0026#34;None\u0026#34;, taint)) AKS-3 - Disable local accounts Category: Access \u0026amp; Security\nImpact: High\nGuidance\nLocal Kubernetes accounts provide a legacy non-auditable means of accessing an AKS cluster and are not recommended for use. Enabling Microsoft Entra integration on an AKS cluster provides several benefits for managing access to the cluster. By using Microsoft Entra, you can centralize user and group management, enforce multi-factor authentication, and enable role-based access control (RBAC) for fine-grained access control to cluster resources. Additionally, Microsoft Entra provides a secure and scalable authentication mechanism that can be integrated with other Azure services and third-party identity providers.\nResources\nEntra integration Use Azure role-based access control for AKS Manage AKS local accounts Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns a list of AKS clusters not using AAD enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend aadProfile = tostring (parse_json(properties.aadProfile)) | extend disablelocalAdmin = tostring(parse_json(properties.disableLocalAccounts)) | extend RBAC = tostring(parse_json(properties.enableRBAC)) | where RBAC == \u0026#34;false\u0026#34; | project recommendationId=\u0026#34;aks-3\u0026#34;, name, id, tags, param1=strcat(\u0026#34;aadProfile: \u0026#34;, aadProfile), param2=strcat(\u0026#34;disablelocalAdmin: \u0026#34;,disablelocalAdmin), param3=strcat(\u0026#34;RBAC: \u0026#34;, RBAC) AKS-4 - Configure Azure CNI networking for dynamic allocation of IPs Category: Networking\nImpact: Medium\nGuidance\nThe Azure CNI networking solution provides several benefits for managing IP addresses and network connectivity for cluster pods including dynamic allocation of IPs to pods, allowing node and pod subnets to scale independently, direct network connectivity between pods and resources in the VNET and allowing different network policies for pods and nodes. It also supports different networking policies including Azure Network Policies and Calico.\nResources\nConfigure Azure CNI networking Configure Azure CNI Overlay networking Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Check AKS Clusters using kubenet network profile resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend networkProfile = tostring (parse_json(properties.networkProfile.networkPlugin)) | where networkProfile ==\u0026#34;kubenet\u0026#34; | project recommendationId=\u0026#34;aks-4\u0026#34;, name, id, tags, param1=strcat(\u0026#34;networkProfile :\u0026#34;,networkProfile) AKS-5 - Enable the cluster auto-scaler on an existing cluster Category: System Efficiency\nImpact: High\nGuidance\nThe cluster auto-scaler automatically scales the number of nodes in a node pool based on pod resource requests and the available capacity in the cluster. It helps ensure that the cluster can scale according to demand and prevent outages.\nIf the cluster has availability zones enabled, the following configuration changes need to be verified or established:\nPersistent Volumes - If the cluster is using persistent volumes backed by Azure Storage, ensure you have one nodepool per availability zone. Persistent volumes do not work across AZs and the auto-scaler could fail to create new pods if the nodepool cannot access the persistent volume. Multiple Nodepools per Zone - If the cluster has multiple nodepools per AZ, enable the --balance-similar-node-groups property through the auto-scaler profile. This feature detects similar nodepools and balances the number of nodes across them. Resources\nUse the Cluster Autoscaler on AKS Best practices for advanced scheduler features Node pool scaling considerations and best practices Best practices for basic scheduler features Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find AKS clusters with auto-scaling disabled Resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend autoScaling = tostring (parse_json(properties.agentPoolProfiles.[0].enableAutoScaling)) | where autoScaling == \u0026#34;false\u0026#34; | project recommendationId=\u0026#34;aks-5\u0026#34;, name, id, tags, param1=strcat(\u0026#34;autoScaling :\u0026#34;, autoScaling) AKS-6 - Back up Azure Kubernetes Service Category: Disaster Recovery\nImpact: Low\nGuidance\nAKS is increasingly being used for stateful applications that require a backup strategy. Azure Backup now allows you to back up AKS clusters (cluster resources and persistent volumes attached to the cluster) using a backup extension, which must be installed in the cluster. Backup vault communicates with the cluster via this Backup Extension to perform backup and restore operations.\u0026quot;\nResources\nAKS Backups Best Practices for AKS Backups Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find AKS clusters that do not have backup enabled resources | where type =~ \u0026#39;Microsoft.ContainerService/managedClusters\u0026#39; | extend lname = tolower(name) | join kind=leftouter(recoveryservicesresources | where type =~ \u0026#39;microsoft.dataprotection/backupvaults/backupinstances\u0026#39; | extend lname = tolower(tostring(split(properties.dataSourceInfo.resourceID, \u0026#39;/\u0026#39;)[8])) | extend protectionState = properties.currentProtectionState | project lname, protectionState) on lname | where protectionState != \u0026#39;ProtectionConfigured\u0026#39; | extend param1 = iif(isnull(protectionState), \u0026#39;Protection Not Configured\u0026#39;, strcat(\u0026#39;Protection State: \u0026#39;, protectionState)) | project recommendationID = \u0026#34;aks-6\u0026#34;, name, id, tags, param1 AKS-7 - Plan an AKS version upgrade Category: Compliance\nImpact: High\nGuidance\nMinor version releases include new features and improvements. Patch releases are more frequent (sometimes weekly) and are intended for critical bug fixes within a minor version. Patch releases include fixes for security vulnerabilities or major bugs. If you\u0026rsquo;re running an unsupported Kubernetes version, you\u0026rsquo;ll be asked to upgrade when requesting support for the cluster. Clusters running unsupported Kubernetes releases aren\u0026rsquo;t covered by the AKS support policies.\nResources\nUpdating to the latest AKS version Upgrade cluster Auto-upgrading cluster Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-8 - Ensure that Persistent Volumes in storage account are redundant for Pods with stateful applications Category: Availability\nImpact: Low\nGuidance\nData in an Azure Storage account is always replicated three times in the primary region. Azure Storage for Persistent Volumes offers other options for how your data is replicated in the primary or paired region:\nLRS synchronously replicates data 3 times in single physical location. It is least expensive replication but not recommended for apps with high availability and durability. LRS provides eleven 9 durability. ZRS copies data synchronously across 3 availability zone in primary region. ZRS is recommended for apps requiring high availability across zones. ZRS provides twelve 9s durability. In AKS Premium_ZRS and StandardSSD_ZRS disk types are supported. ZRS disk could be scheduled on the zone or non-zone node, without the restriction that disk volume should be co-located in the same zone as a given node.\nResources\nAzure Disk CSI Driver Virtual Machine Disk Redundancy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-9 - Upgrade Persistent Volumes with deprecated version to Azure CSI drivers Category: Storage\nImpact: High\nGuidance\nStarting with Kubernetes version 1.26, in-tree persistent volume types kubernetes.io/azure-disk and kubernetes.io/azure-file are deprecated and will no longer be supported. Removing these drivers following their deprecation is not planned, however you should migrate to the corresponding CSI drivers disks.csi.azure.com and file.csi.azure.com.\nResources\nCSI Storage Drivers CSI Migrate in Tree Volumes Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-10 - Implement Resource Quota to ensure that Kubernetes resources do not exceed hard resource limits Category: System Efficiency\nImpact: Low\nGuidance\nA resource quota, defined by a ResourceQuota object, provides constraints that limit aggregate resource consumption per namespace. It can limit the quantity of objects that can be created in a namespace by type, as well as the total amount of compute resources that may be consumed by resources in that namespace.\nResources\nResource Quotas Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-11 - Attach Virtual Nodes (ACI) to the AKS cluster Category: System Efficiency\nImpact: Low\nGuidance\nTo rapidly scale application workloads in an AKS cluster, you can use virtual nodes. With virtual nodes, pods provision much faster than through the Kubernetes cluster auto-scaler.\nIf the cluster has availability zones enabled, the following configuration changes need to be verified or established:\nPersistent Volumes - If the cluster is using persistent volumes backed by Azure Storage, ensure you have one nodepool per availability zone. Persistent volumes do not work across AZs and the auto-scaler could fail to create new pods if the nodepool cannot access the persistent volume. Resources\nVirtual Nodes Azure Container Instances Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-12 - Update AKS tier to Standard Category: Availability\nImpact: High\nGuidance\nProduction AKS clusters should be configured with the Standard tier. The AKS free service doesn\u0026rsquo;t offer a financially backed SLA and node scalability is limited. To obtain that SLA, Standard tier must be selected.\nResources\nPricing Tiers AKS Baseline Architecture Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns all AKS clusters not running on the Standard tier resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | where sku.tier != \u0026#34;Standard\u0026#34; | project recommendationId=\u0026#34;aks-12\u0026#34;, id, name, tags, param1=strcat(\u0026#34;skuName: \u0026#34;, sku.name), param2=strcat(\u0026#34;skuTier: \u0026#34;, sku.tier) AKS-13 - Enable AKS Monitoring Category: Monitoring\nImpact: High\nGuidance\nAzure Monitor collects events, captures container logs, collects CPU/Memory information from the Metrics API and allows the visualization of the data, to validate the near real time health and performance of AKS environments. The visualization tool can be Azure Monitor Container Insights, Prometheus, Grafana or others.\nResources\nMonitor AKS Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns AKS clusters where either Azure Monitor is not enabled and/or Container Insights is not enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend azureMonitor = tostring(parse_json(properties.azureMonitorProfile.metrics.enabled)) | extend insights = tostring(parse_json(properties.addonProfiles.omsagent.enabled)) | where isempty(azureMonitor) or isempty(insights) | project recommendationId=\u0026#34;aks-13\u0026#34;,id, name, tags, param1=strcat(\u0026#34;azureMonitorProfileEnabled: \u0026#34;, iff(isempty(azureMonitor), \u0026#34;false\u0026#34;, azureMonitor)), param2=strcat(\u0026#34;containerInsightsEnabled: \u0026#34;, iff(isempty(insights), \u0026#34;false\u0026#34;, insights)) AKS-14 - Use Ephemeral Disks on AKS clusters Category: System Efficiency\nImpact: Medium\nGuidance\nEphemeral OS disks provide lower read/write latency on the OS disk of AKS agent nodes since the disk is locally attached, and it is not replicated as managed disks. You will also get faster cluster operations like scale or upgrade thanks to faster re-imaging and boot times.\nResources\nAKS Ephemeral OS Disk Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-15 - Enable and remediate Azure Policies configured for AKS Category: Governance\nImpact: Low\nGuidance Azure Policies allow companies to enforce governance best practices in the AKS cluster around security, authentication, provisioning, networking and others.\nResources\nAKS Baseline - Policy Management Built-in Policy Definitions for AKS Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-16 - Enable GitOps when using DevOps frameworks Category: Automation\nImpact: Low\nGuidance\nGitOps is an operating model for cloud-native applications that stores application and declarative infrastructure code in Git to be used as the source of truth for automated continuous delivery. With GitOps, you describe the desired state of your entire system in a git repository, and a GitOps operator deploys it to your environment, which is often a Kubernetes cluster. To prevent potential outages or unsuccessful failover scenarios, GitOps helps maintain the configuration of all AKS clusters to the intended configuration.\nResources\nGitOps with AKS GitOps for AKS - Reference Architecture Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns AKS clusters where GitOps is not enabled resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | extend gitops = tostring (parse_json(properties.addOnProfiles.gitops.enabled)) | where isempty(gitops) | project recommendationId=\u0026#34;aks-16\u0026#34;, id, name, tags, param1=strcat(\u0026#34;gitopsEnabled: \u0026#34;, \u0026#34;false\u0026#34;) AKS-17 - Configure affinity or anti-affinity rules based on application requirements Category: Availability\nImpact: High\nGuidance\nConfigure Topology Spread Constraints to control how Pods are spread across your cluster among failure-domains such as regions, zones, nodes, and other user-defined topology domains. This can help to achieve high availability as well as efficient resource utilization.\nResources\nTopology Spread Constraints Assign Pod Node Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-18 - Configures Pods Liveness, Readiness, and Startup Probes Category: Availability\nImpact: High\nGuidance\nAKS kubelet controller uses liveness probes to validate containers and applications health. Based on containers health, kubelet will know when to restart a container.\nResources\nConfigure probes Assign Pod Node Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-19 - Configure pod replica sets in production applications to guarantee availability Category: Availability\nImpact: High\nGuidance\nConfigure ReplicaSets in the Pod or Deployment manifests to maintain a stable set of replica Pods running at any given time. This feature will guarantee the availability of a specified number of identical Pods.\nResources\nReplica Sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-20 - Configure system nodepool count Category: Availability\nImpact: High\nGuidance\nThe system node pool should be configured with a minimum node count of two to ensure critical system pods are resilient to node outages.\nResources\nSystem nodepools Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns each AKS cluster with nodepools that have system nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationid=\u0026#34;aks-20\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) AKS-21 - Configure user nodepool count Category: Availability\nImpact: High\nGuidance\nThe user node pool should be configured with a minimum node count of two if the application requires high availability.\nResources\nAzure Well-Architected Framework review for Azure Kubernetes Service (AKS) Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns each AKS cluster with nodepools that have user nodepools with less than 2 nodes resources | where type == \u0026#34;microsoft.containerservice/managedclusters\u0026#34; | mv-expand agentPoolProfile = properties.agentPoolProfiles | extend taints = tostring(parse_json(agentPoolProfile.nodeTaints)) | extend nodePool = tostring(parse_json(agentPoolProfile.name)) | where taints !has \u0026#34;CriticalAddonsOnly=true:NoSchedule\u0026#34; and agentPoolProfile.minCount \u0026lt; 2 | project recommendationid=\u0026#34;aks-21\u0026#34;, id, name, param1=strcat(\u0026#34;nodePoolName: \u0026#34;, nodePool), param2=strcat(\u0026#34;nodePoolMinNodeCount: \u0026#34;, agentPoolProfile.minCount) AKS-22 - Configure pod disruption budgets (PDBs) Category: Availability\nImpact: Medium\nGuidance\nA Pod Disruption Budget (PDB) is a Kubernetes resource that allows you to configure the minimum number or percentage of pods that should remain available during voluntary disruptions, such as maintenance or scaling events. To maintain the availability of applications, define Pod Disruption Budgets (PDBs) to make sure that a minimum number of pods are available in the cluster.\nResources\nConfigure PDBs Plan availability using PDBs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-23 - Nodepool subnet size needs to accommodate maximum auto-scale settings Category: Availability\nImpact: High\nGuidance\nNodepool subnets should be sized to accommodate maximum auto-scale settings. By properly sizing the subnet, AKS can efficiently scale out nodes to meet increased demand, reducing the risk of resource constraints and potential service disruptions.\nResources\nAKS Networking Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AKS-24 - Enforce resource quotas at the namespace level Category: Availability\nImpact: High\nGuidance\nEnforcing namespace-level resource quotas is crucial for ensuring reliability by preventing resource exhaustion and maintaining cluster stability. This helps prevent individual applications or users from monopolizing resources, which can lead to degraded performance or outages for other applications in the cluster.\nResources\nResource quotas Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/integration/api-management/",
	"title": "Api Management",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Api Management and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Api Management and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available APIM-1 - Migrate API Management services to Premium SKU to support Availability Zones Availability High Preview Yes APIM-2 - Enable Availability Zones on Premium API Management instances Availability High Preview Yes Definitions of states can be found here Recommendations Details APIM-1 - Migrate API Management services to Premium SKU to support Availability Zones Category: Availability\nImpact: High\nGuidance\nUpgrade the API Management instance to the Premium SKU to add support for Availability Zones.\nResources\nChange your API Management service tier Migrate Azure API Management to availability zone support Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all API Management instances that aren\u0026#39;t Premium resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend skuName = sku.name | where tolower(skuName) != tolower(\u0026#39;premium\u0026#39;) | project recommendationId = \u0026#34;apim-1\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SKU: \u0026#34;, skuName) APIM-2 - Enable Availability Zones on Premium API Management instances Category: Availability\nImpact: High\nGuidance\nEnable zone redundancy for APIM instances. With zone redundancy, the gateway and the control plane of your API Management instance (Management API, developer portal, Git configuration) are replicated across datacenters in physically separated zones, making it resilient to a zone failure.\nResources\nEnsure API Management availability and reliability Migrate Azure API Management to availability zone support Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Premium API Management instances that aren\u0026#39;t zone redundant resources | where type =~ \u0026#39;Microsoft.ApiManagement/service\u0026#39; | extend skuName = sku.name | where tolower(skuName) == tolower(\u0026#39;premium\u0026#39;) | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend zoneValue = iff((isnull(zones)), \u0026#34;null\u0026#34;, zones) | project recommendationId = \u0026#34;apim-2\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Zones value: \u0026#34;, zoneValue ) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/web/app-service-plan/",
	"title": "App Service Plan",
	"tags": null,
	"description": "Best practices and resiliency recommendations for App Service Plan and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include App Service Plan and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ASP-1 - Migrate App Service to availability Zone Support Availability High Preview Yes ASP-2 - Use Standard or Premium tier Availability High Preview Yes ASP-3 - Avoid scaling up or down System Efficiency Medium Preview Yes ASP-4 - Create separate App Service plans for production and test Governance High Preview No ASP-5 - Enable Autoscale/Automatic scaling to ensure adequate resources are available to service requests System Efficiency Medium Preview Yes Definitions of states can be found here Recommendations Details ASP-1 - Migrate App Service to availability Zone Support Category: Availability\nImpact: High\nGuidance\nDeploying your App Service plans and App Service Environments across availability zones (AZ) is a feature provided by Azure to enhance the resiliency and reliability of your business-critical workloads. By distributing your applications across multiple availability zones, you can ensure their continued operation even in the event of a datacenter-level failure. This approach offers excellent redundancy without the need for deploying your applications in different Azure regions. Availability zones provide a higher level of fault tolerance, helping to safeguard your applications and minimize downtime. This enables your business to maintain continuity and deliver uninterrupted services to your customers.\nResources\nMigrate App Service to availability zone support High availability enterprise deployment using App Service Environment Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // The query filters the qualified App Service Plans that do not have Zone Redundancy enabled. // Its important to check regions that support availability zones for Azure App Services running on multi-tenant and App Service Environments https://learn.microsoft.com/en-us/azure/reliability/reliability-app-service?tabs=graph%2Ccli#:~:text=The%20following%20regions%20support%20Azure%20App%20Services%20running%20on%20multi%2Dtenant%20environments%3A resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | extend zoneRedundant = tobool(properties.zoneRedundant) | extend sku_tier = tostring(sku.tier) | where (tolower(sku_tier) contains \u0026#34;isolated\u0026#34; or tolower(sku_tier) contains \u0026#34;premium\u0026#34;) and zoneRedundant == false | project recommendationid=\u0026#34;asp-1\u0026#34;, name, id, tags, param1=sku_tier, param2=\u0026#34;Not Zone Redundant\u0026#34; ASP-2 - Use Standard or Premium tier Category: Availability\nImpact: High\nGuidance\nThe use of the Standard or Premium tier for Azure App Service Plan is crucial for highly resilient applications, as it provides advanced scaling, high availability, traffic management, enhanced performance, networking features, and multiple deployment slots, ensuring uninterrupted operation and robustness in the face of potential failures or increased demands.\nResources\nResiliency checklist for specific Azure services Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure App Service Plans that are not in the \u0026#34;Standard\u0026#34;, \u0026#34;Premium\u0026#34;, or \u0026#34;IsolatedV2\u0026#34; SKU tiers. resources | where type =~ \u0026#39;microsoft.web/serverfarms\u0026#39; | extend sku_tier = tostring(sku.tier) | where tolower(sku_tier) !contains \u0026#34;standard\u0026#34; and tolower(sku_tier) !contains \u0026#34;premium\u0026#34; and tolower(sku_tier) !contains \u0026#34;isolatedv2\u0026#34; | project recommendationid=\u0026#34;asp-2\u0026#34;, name, id, tags, param1= strcat(\u0026#34;SKU=\u0026#34;,sku_tier) ASP-3 - Avoid scaling up or down Category: System Efficiency\nImpact: Medium\nGuidance\nIt is recommended to avoid scaling up or down your Azure App Service instances frequently. Instead, choose an appropriate tier and instance size that can handle your typical workload, and scale out the instances to accommodate changes in traffic volume. Scaling up or down can potentially trigger an application restart, which may result in service disruptions.\nResources\nResiliency checklist for specific Azure services Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure App Service Plans and the number of changes that was made to the pricing tier, if the count is higher that 3 it means you need to avoid scaling up and down that often resourcechanges | extend changeTime = todatetime(properties.changeAttributes.timestamp), targetResourceId = tostring(properties.targetResourceId), changeType = tostring(properties.changeType), correlationId = properties.changeAttributes.correlationId, changedProperties = properties.changes, changeCount = properties.changeAttributes.changesCount | where changeTime \u0026gt; ago(14d) | join kind=inner (resources | project resources_Name = name, resources_Type = type, resources_Subscription= subscriptionId, resources_ResourceGroup= resourceGroup, id) on $left.targetResourceId == $right.id | where resources_Type contains \u0026#34;microsoft.web/serverfarms\u0026#34; | where changedProperties[\u0026#39;sku.name\u0026#39;].propertyChangeType == \u0026#39;Update\u0026#39; or changedProperties[\u0026#39;sku.tier\u0026#39;].propertyChangeType == \u0026#39;Update\u0026#39; | summarize count() by targetResourceId, resources_Name ,tostring(changedProperties[\u0026#39;sku.name\u0026#39;].previousValue), tostring(changedProperties[\u0026#39;sku.tier\u0026#39;].newValue) | project recommendationid=\u0026#34;asp-3\u0026#34;, name=resources_Name, id=targetResourceId, tags=\u0026#34;\u0026#34;, param1=[\u0026#39;changedProperties_sku.name_previousValue\u0026#39;], param2=[\u0026#39;changedProperties_sku.tier_newValue\u0026#39;], param3=count_ ASP-4 - Create separate App Service plans for production and test Category: Governance\nImpact: High\nGuidance\nIt is strongly recommended to create separate App Service plans for production and test environments. Avoid using slots within your production deployment for testing purposes. When apps within the same App Service plan share VM instances, combining production and test deployments can have adverse effects on the production environment. For instance, load tests conducted on the test deployment may degrade the live production site. By isolating test deployments in a separate plan, you ensure the separation and protection of the production version.\nResources\nResiliency checklist for specific Azure services Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg ASP-5 - Enable Autoscale/Automatic scaling to ensure adequate resources are available to service requests Category: System Efficiency\nImpact: Medium\nGuidance\nIt is highly recommended to enable Autoscale/Automatic Scaling for your Azure App Service to ensure that sufficient resources are available to handle incoming requests. Autoscaling is rule based scaling while Automatic Scaling newer platform feature that performs automatic scale out and in based on HTTP traffic.\nResources\nAutomatic scaling in Azure App Service Auto Scale Web Apps Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/application-gateway/",
	"title": "Application Gateway",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Application Gateway and Web Application Firewall and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Application Gateway, Web Application Firewall and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available AGW-1 - Set a minimum instance count of 2 System Efficiency High Preview Yes AGW-2 - Secure all incoming connections with SSL Access \u0026amp; Security High Preview No AGW-3 - Enable WAF policies Access \u0026amp; Security High Preview Yes AGW-4 - Use Application GW V2 instead of V1 System Efficiency High Preview No AGW-5 - Monitor and Log the configurations and traffic Monitoring Medium Preview No AGW-6 - Use Health Probes to detect backend availability Monitoring Medium Preview No AGW-7 - Deploy backends in a zone-redundant configuration Availability High Preview No AGW-8 - Plan for backend maintenance by using connection draining Governance Medium Preview No AGW-9 - Ensure Application Gateway Subnet is using a /24 subnet mask Networking High Preview No Definitions of states can be found here Recommendations Details AGW-1 - Set a minimum instance count of 2 Category: System Efficiency\nImpact: High\nGuidance\nAzure Application Gateways v2 are always deployed in a highly available fashion, deployed with multiple instances by default regardless of your autoscaling configuration. However, creating a new instance can take up to six or seven minutes. In order to avoid downtime for various failure modes, it is recommended that you configure a minimum instance count of two, ideally with Availability Zone support. By doing this, you will always have at least two instances in your Azure Application Gateway under normal circumstances. If one of them was to have a problem, there will always be another instance present to handle the traffic while a new instance is being created. Also, continue to leverage auto scaling to dynamically scale out based on the traffic requirements without the need of manual intervention.\nResources\nApplication Gateway Autoscaling Zone-Redundant Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all Application Gateways that do not have autoscale enabled or have a min capacity of 1 resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where isnull(properties.autoscaleConfiguration) or properties.autoscaleConfiguration.minCapacity \u0026lt;= 1 | project recommendationId = \u0026#34;agw-1\u0026#34;, name, id, tags, param1 = \u0026#34;autoScaleConfiguration: isNull or MinCapacity \u0026lt;= 1\u0026#34; | order by id asc AGW-2 - Secure all incoming connections with SSL Category: Access \u0026amp; Security\nImpact: High\nGuidance\nEnsure that all incoming connections are using HTTP/s for production services. Using end to end SSL/TLS or SSL/TLS termination to ensure the security of all incoming connections to the Application Gateway allows you and your users to be safe from possible attacks as it ensures that all data passed between the web server and browsers remain private and encrypted.\nResources\nApplication Gateway Security Application Gateway SSL Overview Application Gateway SSL Policy Overview Application Gateway KeyVault Certs Application Gateway SSL Cert Management Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AGW-3 - Enable Web Application Firewall policies Category: Access \u0026amp; Security\nImpact: High\nGuidance\nUse Application Gateway with Web Application Firewall (WAF) within an application virtual network to protect inbound HTTP/S traffic from the Internet. The WAF provides centralized protection from possible exploits by using rules based on the OWASP (Open Web Application Security Project) core rule sets.\nResources\nWell-Architected Framework Application Gateway Overview Application Gateway - Web Application Firewall Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all Application Gateways that do not have WAF enabled Resources | where type =~ \u0026#34;microsoft.network/applicationGateways\u0026#34; | where properties.firewallpolicy != \u0026#34;\u0026#34; | project recommendationId = \u0026#34;agw-3\u0026#34;, name, id, tags, param1 = \u0026#34;webApplicationFirewallConfiguration: isNull\u0026#34; | order by id asc AGW-4 - Use Application GW V2 instead of V1 Category: System Efficiency\nImpact: High\nGuidance\nYou should use Application Gateway v2 unless there is a compelling reason for using v1. V2 has many more built in features such as autoscaling, static VIPs, Azure KeyVault integration for certificate management and many more features listed in our comparison charts. Leveraging this updated version allows for better performance and control of how your traffic routed and the ability to make changes to the traffic.\nResources\nApplication Gateway Overview V2 Application Gateway Feature Comparison Between V1 and V2 Application Gateway V1 Retirement Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AGW-5 - Monitor and Log the configurations and traffic Category: Monitoring\nImpact: Medium\nGuidance\nEnable logs that can be stored in storage accounts, Log Analytics, and other monitoring services. If NSGs are applied NSG flow logs can be enabled and stored for traffic audit and to provide insights into the traffic flowing into your Azure Cloud.\nResources\nApplication Gateway Metrics Application Gateway Diagnostics Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg AGW-6 - Use Health Probes to detect backend availability Category: Monitoring\nImpact: Medium\nGuidance\nUsing custom health probes can help with understand the availability of your backends and allows you to monitor the backend services if they are being affected in any way.\nResources\nApplication Gateway Probe Overview Well-Architected Framework Application Gateway Overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AGW-7 - Deploy backends in a zone-redundant configuration Category: Availability\nImpact: High\nGuidance\nDeploying your backend services in a zone-aware configurations ensures that if a specific zone goes down that customers will still have access to the services as the other services located in other zones will still be available.\nResources\nWell-Architected Framework Application Gateway Reliability Application Gateway V2 Overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AGW-8 - Plan for backend maintenance by using connection draining Category: Governance\nImpact: Medium\nGuidance\nPlan for backend maintenance by using connection draining. Connection draining helps you achieve graceful removal of backend pool members during planned service updates or problems with backend health. This setting is enabled via the Backend Setting and is applied to all backend pool members during rule creation.\nResources\nApplication Gateway Connection Draining Application Gateway Connection Draining HTTP Settings Resource Graph Query/Scripts Show/Hide Query/Script Copy // under-development AGW-9 - Ensure Application Gateway Subnet is using a /24 subnet mask Category: Networking\nImpact: High\nRecommendation/Guidance\nApplication Gateway (Standard_v2 or WAF_v2 SKU) can support up to 125 instances. Although a /24 subnet isn\u0026rsquo;t required per Application Gateway v2 SKU deployment, it is highly recommended. This is to ensure that Application Gateway v2 has sufficient space for autoscaling expansion and maintenance upgrades.\nResources\nAzure Application Gateway infrastructure configuration | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will validate the subnet id for an appGW ends with a /24 resources | where type =~ \u0026#39;Microsoft.Network/applicationGateways\u0026#39; | extend subnetid = tostring(properties.gatewayIPConfigurations[0].properties.subnet.id) | join kind=leftouter(resources | where type == \u0026#34;microsoft.network/virtualnetworks\u0026#34; | mv-expand properties.subnets | extend subnetid = tostring(properties_subnets.id) | extend addressprefix = tostring(properties_subnets.properties.addressPrefix) | project subnetid, addressprefix) on subnetid | where addressprefix !endswith \u0026#39;/24\u0026#39; | project recommendationID = \u0026#34;agw-8\u0026#34;, name, id, tags, param1 = strcat(\u0026#39;AppGW subnet prefix: \u0026#39;, addressprefix) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/monitoring/application-insights/",
	"title": "Application Insights",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Application Insights and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Application Insights and associated resources and settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Application Insights and associated resources.\nRecommendation Category Impact State ARG Query Available APPI-1 - Convert Classic Deployments Availability Medium Preview Yes Definitions of states can be found here Recommendations Details APPI-1 - Convert Classic Deployments Category: Availability\nImpact: Medium\nRecommendation\nClassic Application Insights will be retired in February 2024. To minimize disruption to your existing application monitoring scenarios, transition to workspace-based Application Insights before 29 February 2024.\nResources\nMigrate an Application Insights classic resource to a workspace-based resource Resource Graph Query/Scripts\nShow/Hide Query/Script Copy resources | where type =~ \u0026#34;microsoft.insights/components\u0026#34; | extend IngestionMode = properties.IngestionMode | where IngestionMode =~ \u0026#39;ApplicationInsights\u0026#39; | project recommendationId= \u0026#34;appi-1\u0026#34;, name, id, tags, param1=\u0026#34;ApplicationInsightsDeploymentType: Classic\u0026#34; "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/management/automation-account/",
	"title": "Automation Account",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Automation account and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Automation account and its associated settings.\nSummary of Recommendations Recommendation Impact State ARG Query Available AA-1 - Set up disaster recovery of Automation accounts and its dependent resources High Preview No Definitions of states can be found here Recommendations Details AA-1 - Set up disaster recovery of Automation accounts and its dependent resources Category: Availability\nImpact: High\nGuidance\nSet up disaster recovery of Automation accounts, and its dependent resources such as Modules, Connections, Credentials, Certificates, Variables and Schedules to handle a region-wide service outage or zone-wide failure. For disaster recovery, the replica Automation account must be already deployed and ready in the secondary region to failover if the Automation account in the primary region becomes unavailable. Ensure that your disaster recovery strategy considers your Automation account and the dependent resources.\nYou can use the PowerShell script to migrate assets of the Automation account from one region to another, or if you are using ARM templates to define and deploy Automation runbooks, you can use these templates to deploy the same runbooks in any other Azure region where you create the replica Automation account.\nResources\nDisaster recovery for Automation accounts Disaster recovery scenarios for cloud and hybrid jobs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/migration/azure-backup/",
	"title": "Azure Backup",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Backup and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Backup and associated settings.\nSummary of Recommendations |\nRecommendation Category Impact State ARG Query Available BK-1 - Migrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults Monitoring Medium Preview Yes BK-2 - Opt-in to Cross Region Restore for all Geo-Redundant Storage (GRS) Azure Recovery Services vaults Disaster Recovery Medium Verified Yes Definitions of states can be found here Recommendations Details BK-1 - Migrate from classic alerts to built-in Azure Monitor alerts for Azure Recovery Services Vaults Category: Monitoring\nImpact: Medium\nGuidance\nOn 31 March 2026, classic alerts for Recovery Services vaults in Azure Backup will be retired and no longer supported. Before that date, transition to built-in Azure monitor alerting solution. Using Azure Monitor Alerts you can:\nConfigure notifications to a wide range of notification channels. Enable notifications for selective scenarios. Monitor alerts at-scale via Backup center. Manage alerts and notifications programmatically. Consistent alert management for multiple Azure services, including backup. Resources\nMove to Azure monitor Alerts Classic alerts retirement announcement Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // This Resource Graph query will return all Recovery services vault with Classic alerts enabled. resources | where type in~ (\u0026#39;microsoft.recoveryservices/vaults\u0026#39;) | extend monitoringSettings = parse_json(properties).monitoringSettings | extend isUsingClassicAlerts = case(isnull(monitoringSettings),\u0026#39;Enabled\u0026#39;,monitoringSettings.classicAlertSettings.alertsForCriticalOperations) | extend isUsingJobsAlerts = case(isnull(monitoringSettings), \u0026#39;Enabled\u0026#39;, monitoringSettings.azureMonitorAlertSettings.alertsForAllJobFailures) | where isUsingClassicAlerts == \u0026#39;Enabled\u0026#39; | project recommendationId = \u0026#34;bk-1\u0026#34;, name, id, tags, param1=strcat(\u0026#34;isUsingClassicAlerts: \u0026#34;, isUsingClassicAlerts), param2=strcat(\u0026#34;isUsingJobsAlerts: \u0026#34;, isUsingJobsAlerts) BK-2 - Opt-in to Cross Region Restore for all Geo-Redundant Storage (GRS) Azure Recovery Services vaults Category: Disaster Recovery\nImpact: Medium\nGuidance\nCross Region Restore allows you to restore Azure VMs in a secondary region, which is an Azure paired region. This option allows you to conduct drills to meet audit or compliance requirements, and to restore the VM or its disk if there\u0026rsquo;s a disaster in the primary region. CRR is an opt-in feature for any GRS vault only.\nResources\nSet Cross Region Restore Azure Backup Best Practices Minimum Role Requirements for Cross Region Restore Recovery Services Vault Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Displays all recovery services vaults that do not have cross region restore enabled resources | where type == \u0026#34;microsoft.recoveryservices/vaults\u0026#34; | where properties.properties.enableCrossRegionRestore != true | project recommendationId = \u0026#34;bk-2\u0026#34;, name, id, tags "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/ai-ml/databricks/",
	"title": "Azure Databricks",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Databricks and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Azure Databricks and dependent resources and settings.\nSummary of Recommendation Recommendation Category Impact State ARG Query Available DBW-1 - Databricks runtime version is not latest and/or is not LTS version Governance Medium Verified No DBW-2 - Use Databricks Pools System Efficiency High Verified No DBW-3 - Use SSD backed VMs for Worker VM Type and Driver type System Efficiency Medium Verified No DBW-4 - Enable autoscaling for batch workloads System Efficiency High Verified No DBW-5 - Enable autoscaling for SQL warehouse System Efficiency High Verified No DBW-6 - Use Delta Live Tables enhanced autoscaling System Efficiency Medium Verified No DBW-7 - Automatic Job Termination is enabled, ensure there are no user-defined local processes Availability Medium Verified No DBW-8 - Enable Logging-Cluster log delivery Monitoring Medium Verified No DBW-9 - Use Delta Lake for higher reliability Availability High Verified No DBW-10 - Use Photon Acceleration Availability Low Verified No DBW-11 - Automatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables Application Resilience Low Verified No DBW-12 - Configure jobs for automatic retries and termination Availability High Verified No DBW-13 - Use a scalable and production-grade model serving infrastructure System Efficiency High Verified No DBW-14 - Use a layered storage architecture Application Resilience Medium Verified No DBW-15 - Improve data integrity by reducing data redundancy Application Resilience Low Verified No DBW-16 - Actively manage schemas Governance Medium Verified No DBW-17 - Use constraints and data expectations Application Resilience Low Verified No DBW-18 - Create regular backups Disaster Recovery Low Verified No DBW-19 - Recover from Structured Streaming query failures Availability High Verified No DBW-20 - Recover ETL jobs based on Delta time travel Disaster Recovery Medium Verified No DBW-21 - Use Databricks Workflows and built-in recovery Disaster Recovery Low Verified No DBW-22 - Configure a disaster recovery pattern Disaster Recovery High Preview No DBW-23 - Automate deployments and workloads Automation High Preview No DBW-24 - Set up monitoring, alerting, and logging Monitoring High Preview No DBW-25 - Deploy workspaces in separate Subscriptions System Efficiency High Preview No DBW-26 - Isolate each workspace in its own Vnet System Efficiency High Preview No DBW-27 - Do not Store any Production Data in Default DBFS Folders Availability High Preview No DBW-28 - Do not use Azure Sport VMs for critical Production workloads Availability High Preview No Definitions of states can be found here Recommendations Details DBW-1 - Databricks runtime version is not latest or is not LTS version Category: Governance\nImpact: Medium\nGuidance\nUse 12.2 LTS later. Databricks recommends that you migrate your workloads in the following order:\nIf your workloads are currently running on Databricks Runtime 11.3 LTS or above, you can migrate directly to the latest version of Databricks Runtime 12.x, as described later in this article. If your workloads are currently running on Databricks Runtime 11.3 LTS or below, do the following: Migrate to Databricks Runtime 11.3 LTS first. See the Databricks Runtime 11.x migration guide. Follow the guidance in this article to migrate from Databricks Runtime 11.3 LTS to the latest version of Databricks Runtime 12.x. Resources\nDatabricks runtime support lifecycles Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-2 - Use Databricks Pools Category: System Efficiency\nImpact: High\nGuidance\nDatabricks pools are a standard feature of the service, pre-provisions VM‚Äôs instead of spinning them up on demand will help to vastly reduce risks of ‚Äúprovisioning‚Äù errors when starting or scaling clusters.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-3 - Use SSD backed VMs for Worker VM Type and Driver type Category: System Efficiency\nImpact: Low\nGuidance\nWe have identified that you are using standard hard disks with your premium-capable Virtual Machines and we recommend you consider upgrading the standard-hdd disks to standard-ssd or premium disks. For any Single Instance Virtual Machine using premium storage for all Operating System Disks and Data Disks, we guarantee you will have Virtual Machine Connectivity of at least 99.9%. Consider these factors when making your upgrade decision. The first is that upgrading requires a VM reboot and this process takes 3-5 minutes to complete. The second is if the VMs in the list are mission-critical production VMs, evaluate the improved availability against the cost of premium disks.\nPremium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost. Standard SSDs are acceptable for some Production workloads as well.\nResources\nAzure managed disk types Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-4 - Enable autoscaling for batch workloads Category: System Efficiency\nImpact: High\nGuidance\nAutoscaling allows clusters to resize automatically based on workloads. Autoscaling can benefit many use cases and scenarios from both a cost and performance perspective. The documentation provides considerations for determining whether to use Autoscaling and how to get the most benefit.\nFor streaming workloads, Databricks recommends using Delta Live Tables with autoscaling.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-5 - Enable autoscaling for SQL warehouse Category: System Efficiency\nImpact: High\nGuidance\nThe scaling parameter of a SQL warehouse sets the minimum and the maximum number of clusters over which queries sent to the warehouse are distributed. The default is a minimum of one and a maximum of one cluster.\nTo handle more concurrent users for a given warehouse, increase the cluster count.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-6 - Use Delta Live Tables enhanced autoscaling Category: System Efficiency\nImpact: Medium\nGuidance\nA data disk is a managed disk that\u0026rsquo;s attached to a virtual machine to store application data, or other data you need to keep. Data disks are registered as SCSI drives and are labeled with a letter that you choose. Hosting you data on a data disk also helps with flexibility when backuping or restoring data, as well as migrating the disk without having to migrate the entire Virtual Machine and Operating System. You will be able to also select a different disk sku, with different type, size, and performance that meet your requirements.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-7 - Automatic Job Termination is enabled, ensure there are no user-defined local processes Category: Availability\nImpact: Medium\nGuidance\nTo save cluster resources, you can terminate a cluster. The terminated cluster‚Äôs configuration is stored so that it can be reused (or, in the case of jobs, autostarted) at a later time. You can manually terminate a cluster or configure the cluster to terminate automatically after a specified period of inactivity. When the number of terminated clusters exceeds 150, the oldest clusters are deleted. You can also set auto termination for a cluster. During cluster creation, you can specify an inactivity period in minutes after which you want the cluster to terminate. However, The auto termination feature monitors only Spark jobs, not user-defined local processes. Therefore, if all Spark jobs have completed, a cluster may be terminated, even if local processes are running.\nResources\nBest practices for reliability? Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-8 - Enable Logging-Cluster log delivery Category: Monitoring\nImpact: Medium\nGuidance\nWhen you create a cluster, you can specify a location to deliver the logs for the Spark driver node, worker nodes, and events. Logs are delivered every five minutes and archived hourly in your chosen destination. When a cluster is terminated, Azure Databricks guarantees to deliver all logs generated up until the cluster was terminated.\nThe destination of the logs depends on the cluster ID. If the specified destination is dbfs:/cluster-log-delivery, cluster logs for 0630-191345-leap375 are delivered to dbfs:/cluster-log-delivery/0630-191345-leap375.\nResources\nCreate a cluster Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-9 - Use Delta Lake for higher reliability Category: Availability\nImpact: High\nGuidance\nDelta Lake is an open source storage format that brings reliability to data lakes. Delta Lake provides ACID transactions, schema enforcement, scalable metadata handling, and unifies streaming and batch data processing. Delta Lake runs on top of your existing data lake and is fully compatible with Apache Spark APIs. Delta Lake on Databricks allows you to configure Delta Lake based on your workload patterns.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-10 - Use Photon Acceleration Category: Availability\nImpact: Low\nGuidance\nApache Spark, as the compute engine of the Databricks Lakehouse, is based on resilient distributed data processing. In case of an internal Spark task not returning a result as expected, Apache Spark automatically reschedules the missing tasks and continues with the execution of the entire job. This is helpful for failures outside the code, like a short network issue or a revoked spot VM. Working with both the SQL API and the Spark DataFrame API comes with this resilience built into the engine.\nIn the Databricks Lakehouse, Photon, a native vectorized engine entirely written in C++, is high performance compute compatible with Apache Spark APIs.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-11 - Automatically rescue invalid or nonconforming data with Databricks Auto Loader or Delta Live Tables Category: Application Resilience\nImpact: Low\nGuidance\nInvalid or nonconforming data can lead to crashes of workloads that rely on an established data format. To increase the end-to-end resilience of the whole process, it is best practice to filter out invalid and nonconforming data at ingestion. Supporting rescued data ensures you never lose or miss out on data during ingest or ETL. The rescued data column contains any data that wasn‚Äôt parsed, either because it was missing from the given schema, because there was a type mismatch, or the column casing in the record or file didn‚Äôt match that in the schema.\nDatabricks Auto Loader: Auto Loader is the ideal tool for streaming the ingestion of files. It supports rescued data for JSON and CSV. Delta Live Tables: Another option to build workflows for resilience is using Delta Live Tables with quality constraints. Resources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-12 - Configure jobs for automatic retries and termination Category: Availability\nImpact: High\nGuidance\nFor batch and streaming inference, use Databricks jobs and MLflow to deploy models as Apache Spark UDFs to leverage job scheduling, retries, autoscaling, and so on. Model serving provides a scalable and production-grade model real-time serving infrastructure. It processes your machine learning models using MLflow and exposes them as REST API endpoints. This functionality uses serverless compute, which means that the endpoints and associated compute resources are managed and run in the Databricks cloud account.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-13 - Use a scalable and production-grade model serving infrastructure Category: System Efficiency\nImpact: High\nGuidance\nFor batch and streaming inference, use Databricks jobs and MLflow to deploy models as Apache Spark UDFs to leverage job scheduling, retries, autoscaling, and so on. Model serving provides a scalable and production-grade model real-time serving infrastructure. It processes your machine learning models using MLflow and exposes them as REST API endpoints. This functionality uses serverless compute, which means that the endpoints and associated compute resources are managed and run in the Databricks cloud account.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-14 - Use a layered storage architecture Category: Application Resilience\nImpact: Medium\nGuidance\nCurate data by creating a layered architecture and ensuring data quality increases as data moves through the layers. A common layering approach is:\nRaw layer (bronze): Source data gets ingested into the lakehouse into the first layer and should be persisted there. When all downstream data is created from the raw layer, rebuilding the subsequent layers from this layer is possible if needed.\nCurated layer (silver): The purpose of the second layer is to hold cleansed, refined, filtered and aggregated data. The goal of this layer is to provide a sound, reliable foundation for analyses and reports across all roles and functions.\nFinal layer (gold): The third layer is created around business or project needs. It provides a different view as data products to other business units or projects, preparing data around security needs (such as anonymized data) or optimizing for performance (such as with preaggregated views). The data products in this layer are seen as the truth for the business.\nThe final layer should only contain high-quality data and can be fully trusted from a business point of view.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-15 - Improve data integrity by reducing data redundancy Category: Application Resilience\nImpact: Low\nGuidance\nCopying or duplicating data creates data redundancy and will lead to lost integrity, lost data lineage, and often different access permissions. This will decrease the quality of the data in the lakehouse. A temporary or throwaway copy of data is not harmful on its own - it is sometimes necessary for boosting agility, experimentation and innovation. However, if these copies become operational and regularly used for business decisions, they become data silos. These data silos getting out of sync has a significant negative impact on data integrity and quality, raising questions such as ‚ÄúWhich data set is the master?‚Äù or ‚ÄúIs the data set up to date?‚Äù.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-16 - Actively manage schemas Category: Governance\nImpact: Medium\nGuidance\nUncontrolled schema changes can lead to invalid data and failing jobs that use these data sets. Databricks has several methods to validate and enforce the schema:\nDelta Lake supports schema validation and schema enforcement by automatically handling schema variations to prevent the insertion of bad records during ingestion. Auto Loader detects the addition of new columns as it processes your data. By default, the addition of a new column causes your streams to stop with an UnknownFieldException. Auto Loader supports several modes for schema evolution. Resources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-17 - Use constraints and data expectations Category: Application Resilience\nImpact: Low\nGuidance\nDelta tables support standard SQL constraint management clauses that ensure that the quality and integrity of data added to a table are automatically verified. When a constraint is violated, Delta Lake throws an InvariantViolationException error to signal that the new data can‚Äôt be added. See Constraints on Azure Databricks.\nTo further improve this handling, Delta Live Tables supports Expectations: Expectations define data quality constraints on the contents of a data set. An expectation consists of a description, an invariant, and an action to take when a record fails the invariant. Expectations to queries use Python decorators or SQL constraint clauses. See Manage data quality with Delta Live Tables.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-18 - Create regular backups Category: Disaster Recovery\nImpact: Low\nGuidance\nTo recover from a failure, regular backups need to be available. The Databricks Labs project migrate allows workspace admins to create backups by exporting most of the assets of their workspaces (the tool uses the Databricks CLI/API in the background). See Databricks Migration Tool. Backups can be used either for restoring workspaces or for importing into a new workspace in case of a migration.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-19 - Recover from Structured Streaming query failures Category: Availability\nImpact: High\nGuidance\nStructured Streaming provides fault-tolerance and data consistency for streaming queries. Using Azure Databricks workflows, you can easily configure your Structured Streaming queries to restart on failure automatically. The restarted query continues where the failed one left off.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-20 - Recover ETL jobs based on Delta time travel Category: Disaster Recovery\nImpact: Medium\nGuidance\nDespite thorough testing, a job in production can fail or produce some unexpected, even invalid, data. Sometimes this can be fixed with an additional job after understanding the source of the issue and fixing the pipeline that led to the issue in the first place. However, often this is not straightforward, and the respective job should be rolled back. Using Delta Time travel allows users to easily roll back changes to an older version or timestamp, repair the pipeline, and restart the fixed pipeline.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-21 - Use Databricks Workflows and built-in recovery Category: Disaster Recovery\nImpact: Low\nGuidance\nDatabricks Workflows are built for recovery. When a task in a multi-task job fails (and, as such, all dependent tasks), Azure Databricks Workflows provide a matrix view of the runs, which lets you examine the issue that led to the failure. See View runs for a job. Whether it was a short network issue or a real issue in the data, you can fix it and start a repair run in Azure Databricks Workflows. It runs only the failed and dependent tasks and keep the successful results from the earlier run, saving time and money.\nResources\nBest practices for reliability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-22 - Configure a disaster recovery pattern Category: Disaster Recovery\nImpact: High\nGuidance\nA clear disaster recovery pattern is critical for a cloud-native data analytics platform like Azure Databricks. For some companies, it‚Äôs critical that your data teams can use the Databricks platform even in the rare case of a regional service-wide cloud-service provider outage, whether caused by a regional disaster like a hurricane or earthquake or another source.\nResources\nAzure Databricks Best Practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-23 - Automate deployments and workloads Category: Automation\nImpact: High\nGuidance\nThe Databricks Terraform provider manages Azure Databricks workspaces and the associated cloud infrastructure using a flexible, powerful tool. The goal of the Databricks Terraform provider is to support all Azure Databricks REST APIs, supporting automation of the most complicated aspects of deploying and managing your data platforms. The Databricks Terraform provider is the recommended tool to deploy and manage clusters and jobs reliably, provision Azure Databricks workspaces, and configure data access.\nResources\nBest practices for operational excellence Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-24 - Set up monitoring, alerting, and logging Category: Monitoring\nImpact: High\nGuidance\nThe Databricks Terraform provider manages Azure Databricks workspaces and the associated cloud infrastructure using a flexible, powerful tool. The goal of the Databricks Terraform provider is to support all Azure Databricks REST APIs, supporting automation of the most complicated aspects of deploying and managing your data platforms. The Databricks Terraform provider is the recommended tool to deploy and manage clusters and jobs reliably, provision Azure Databricks workspaces, and configure data access.\nResources\nBest practices for operational excellence Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-25 - Deploy workspaces in separate Subscriptions Category: System Efficiency\nImpact: High\nGuidance\nCustomers commonly partition workspaces based on teams or departments and arrive at that division naturally. But it is also important to partition keeping Azure Subscription and ADB Workspace limits in mind.\nResources\nAzure Databricks Best Practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-26 - Isolate each workspace in its own Vnet Category: System Efficiency\nImpact: High\nGuidance\nWhile you can deploy more than one Workspace in a VNet by keeping the associated subnet pairs separate from other workspaces, we recommend that you should only deploy one workspace in any Vnet. Doing this perfectly aligns with the ADB\u0026rsquo;s Workspace level isolation model. Most often organizations consider putting multiple workspaces in the same Vnet so that they all can share some common networking resource, like DNS, also placed in the same Vnet because the private address space in a vnet is shared by all resources. You can easily achieve the same while keeping the Workspaces separate by following the hub and spoke model and using Vnet Peering to extend the private IP space of the workspace Vnet.\nResources\nAzure Databricks Best Practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-27 - Do not Store any Production Data in Default DBFS Folders Category: Availability\nImpact: High\nGuidance\nThis recommendation is driven by security and data availability concerns. Every Workspace comes with a default DBFS, primarily designed to store libraries and other system-level configuration artifacts such as Init scripts. You should not store any production data in it, because:\nThe lifecycle of default DBFS is tied to the Workspace. Deleting the workspace will also delete the default DBFS and permanently remove its contents. One can\u0026rsquo;t restrict access to this default folder and its contents. Resources\nAzure Databricks Best Practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development DBW-28 - Do not use Azure Sport VMs for critical Production workloads Category: Availability\nImpact: High\nGuidance\nAzure Spot VMs are not recommended for critical production workloads that require high availability and reliability. Azure Spot VMs are designed for workloads that are fault-tolerant and can tolerate interruptions. The amount of available capacity can vary based on size, region, time of day, and more. When deploying Azure Spot Virtual Machines, Azure will allocate the VMs if there\u0026rsquo;s capacity available, but there\u0026rsquo;s no SLA for these VMs. An Azure Spot Virtual Machine offers no high availability guarantees. At any point in time when Azure needs the capacity back, the Azure infrastructure will evict Azure Spot Virtual Machines with 30-seconds notice.\nResources\nUse Azure Spot Virtual Machines Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/storage/azure-netapp-files/",
	"title": "Azure NetApp Files",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure NetApp Files and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Azure NetApp Files and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ANF-1 - Use the correct service level and volume quota size for the expected performance level System Efficiency High Preview No ANF-2 - Use standard network features for production in Azure NetApp Files Networking High Preview Yes ANF-3 - Use availability zones for high availability in Azure NetApp Files Availability High Preview Yes ANF-4 - Use snapshot and backup for in-region data protection in Azure NetApp Files Availability High Preview No ANF-5 - Enable Cross-region replication of Azure NetApp Files volumes Disaster Recovery High Preview Yes ANF-6 - Enable Cross-zone replication of Azure NetApp Files volumes Availability High Preview Yes ANF-7 - Monitor Azure NetApp Files metrics to better understand usage pattern and performance Monitoring Medium Preview No ANF-8 - Use Azure policy to enforce organizational standards and to assess compliance at-scale in Azure NetApp Files Governance Medium Preview No Definitions of states can be found here Recommendations Details ANF-1 - Use the correct service level and volume quota size for the expected performance level Category: System Efficiency\nImpact: High\nGuidance\nService levels are an attribute of a capacity pool. Service levels are defined and differentiated by the allowed maximum throughput for a volume in the capacity pool based on the quota that is assigned to the volume. Throughput is a combination of read and write speed. Azure NetApp Files supports three service levels:\nStandard (16 MiB/s per 1TiB) throughput Premium (64 MiB/s per 1TiB) throughput Ultra (128 MiB/s per 1TiB) throughput Resources\nService levels for Azure NetApp Files | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg ANF-2 - Use standard network features for production in Azure NetApp Files Category: Networking\nImpact: High\nGuidance\nStandard network feature enables higher IP limits and standard VNet features such as network security groups and user-defined routes on delegated subnets, and additional connectivity patterns. Please check the supported regions for standard network feature here\nResources\nGuidelines for Azure NetApp Files network planning | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // This Resource Graph query will return all NetApp Volumes without Network Feature Standard. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where properties.networkFeatures != \u0026#34;Standard\u0026#34; | project recommendationId = \u0026#34;ANF-2\u0026#34;, name, id, tags ANF-3 - Use availability zones for high availability in Azure NetApp Files Category: Availability\nImpact: High\nGuidance\nAzure‚ÄØavailability zones‚ÄØare physically separate locations within each supporting Azure region that are tolerant to local failures. Failures can range from software and hardware failures to events such as earthquakes, floods, and fires. Tolerance to failures is achieved because of redundancy and logical isolation of Azure services. To ensure resiliency, a minimum of three separate availability zones are present in all availability zone-enabled regions.\nResources\nUse availability zones for high availability in Azure NetApp Files | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // This Resource Graph query will return all NetApp Volumes without AVzone defined. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | where zones == \u0026#34;[]\u0026#34; | project recommendationId = \u0026#34;ANF-3\u0026#34;, name, id, tags ANF-4 - Use snapshot and backup for in-region data protection in Azure NetApp Files Category: Availability\nImpact: High\nGuidance\nAzure NetApp Files snapshot technology delivers stability, scalability, and swift recoverability without impacting performance. Azure NetApp Files supports a fully managed backup solution for long-term recovery, archive, and compliance. Backups can be restored to new volumes in the same region as the backup. Backups created by Azure NetApp Files are stored in Azure storage, independent of volume snapshots that are available for near-term recovery or cloning.\nResources\nSnapshots Backup Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ANF-5 - Enable Cross-region replication of Azure NetApp Files volumes Category: Disaster Recovery\nImpact: High\nGuidance\nThe Azure NetApp Files replication functionality provides data protection through cross-region volume replication. You can asynchronously replicate data from an Azure NetApp Files volume (source) in one region to another Azure NetApp Files volume (destination) in another region. This capability enables you to fail over your critical application if a region-wide outage or disaster happens.\nResources\nCross-zone replication of Azure NetApp Files volumes | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // This Resource Graph query will return all NetApp Volumes without Cross-Region Replication. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend NetAC0 = tostring(split(name,\u0026#39;/\u0026#39;)[0]) | join kind=leftouter (resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend NetAC1 = tostring(split(name,\u0026#39;/\u0026#39;)[0]) | project id,NetAC1,remid=tostring(properties.dataProtection.replication.remoteVolumeResourceId)) on $left.id == $right.remid | where properties.volumeType != \u0026#39;DataProtection\u0026#39; and NetAC0 == NetAC1 | project recommendationId = \u0026#34;ANF-5\u0026#34;, name, id, tags ANF-6 - Enable Cross-zone replication of Azure NetApp Files volumes Category: Availability\nImpact: High\nGuidance\nThe cross-zone replication (CZR) capability provides data protection between volumes in different availability zones. You can asynchronously replicate data from an Azure NetApp Files volume (source) in one availability zone to another Azure NetApp Files volume (destination) in another availability. This capability enables you to fail over your critical application if a zone-wide outage or disaster happens.\nResources\nCross-zone replication of Azure NetApp Files volumes | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // This Resource Graph query will return all NetApp Volumes without Cross-Zone Replication. resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend NetAC0 = tostring(split(name,\u0026#39;/\u0026#39;)[0]) | join kind=leftouter (resources | where type =~ \u0026#34;microsoft.netapp/netappaccounts/capacitypools/volumes\u0026#34; | extend NetAC1 = tostring(split(name,\u0026#39;/\u0026#39;)[0]) | project id,NetAC1,remid=tostring(properties.dataProtection.replication.remoteVolumeResourceId)) on $left.id == $right.remid | where properties.volumeType != \u0026#39;DataProtection\u0026#39; and NetAC0 != NetAC1 | project recommendationId = \u0026#34;ANF-6\u0026#34;, name, id, tags ANF-7 - Monitor Azure NetApp Files metrics to better understand usage pattern and performance Category: Monitoring\nImpact: Medium\nGuidance\nAzure NetApp Files provides metrics on allocated storage, actual storage usage, volume IOPS, and latency. With these metrics, you can gain a better understanding on the usage pattern and volume performance of your NetApp accounts.\nResources\nWays to monitor Azure NetApp Files | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg. The validation for this recommendation cannot be achieved with an Azure Resource Graph query. ANF-8 - Use Azure policy to enforce organizational standards and to assess compliance at-scale in Azure NetApp Files Category: Governance\nImpact: Medium\nGuidance\nAzure NetApp Files supports Azure Policy. You can integrate Azure NetApp Files with Azure Policy through creating custom policy definitions. You can find examples in Enforce Snapshot Policies with Azure Policy and Azure Policy now available for Azure NetApp Files.\nResources\nAzure Policy definitions for Azure NetApp Files | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/site-recovery/",
	"title": "Azure Site Recovery",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Site Recovery and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Azure Site Recovery and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ASR-1 - Ensure static IP addresses configured in VM failover settings are available in the failover subnet Disaster Recovery High Preview No ASR-2 - Perform a test failover to validate the functionality and performance of the VMs in the target location Disaster Recovery High Preview Yes Definitions of states can be found here Recommendations Details ASR-1 - Ensure static IP addresses configured in VM failover settings are available in the failover subnet Category: Disaster Recovery\nImpact: High\nGuidance\nEnsure static IP addresses configured in VM failover settings are available in the failover subnet. During failover if the target subnet has the same address space as source then the same static ip address is assigned to target VM provided it is available, otherwise the next available IP address in the target subnet is set as the target VM NIC address. You can modify the target IP address in the Network settings of the VM.\nResources\nSetup network mapping for site recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ASR-2 - Perform a test failover to validate the functionality and performance of the VMs in the target location Category: Disaster Recovery\nImpact: High\nGuidance\nPerform a test failover to validate your BCDR strategy and ensure that your applications are functioning correctly in the target region. This can be done without impacting your production environment. Test your Disaster Recovery plan periodically without any data loss or downtime, using test failovers.\nResources\nRun a test failover Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs where replication has been enabled but Test Failover was never performed recoveryservicesresources | where type == \u0026#34;microsoft.recoveryservices/vaults/replicationfabrics/replicationprotectioncontainers/replicationprotecteditems\u0026#34; | where properties.providerSpecificDetails.dataSourceInfo.datasourceType == \u0026#39;AzureVm\u0026#39; and isnull(properties.lastSuccessfulTestFailoverTime) | project recommendationId=\u0026#34;asr-2\u0026#34; , name = properties.providerSpecificDetails.recoveryAzureVMName, id=properties.providerSpecificDetails.dataSourceInfo.resourceId "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-virtual-desktop/",
	"title": "Azure Virtual Desktop",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Virtual Desktop and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Azure Virtual Desktop and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available AVD-1 Use Private link when connecting to File Share or Key Vault Access \u0026amp; Security Medium Preview Yes AVD-2 Monitor Service Health and Resource Health of AVD Monitoring Medium Preview No AVD-3 Deploy Session Hosts in an Availability Zone Availability High Preview No AVD-4 Deploy Domain Controllers and DNS Servers in Azure Virtual Network Across Availability Zones Availability Medium Preview No AVD-5 Implement RDP Shortpath for Public or Managed Networks Networking Medium Preview No AVD-6 Implement a Multi-Region BCDR Plan Disaster Recovery Medium Preview No AVD-7 Store Golden Image Redundantly for Disaster Recovery Disaster Recovery Low Preview No AVD-8 Capacity Planning for AVD Resources Disaster Recovery Low Preview No AVD-9 Ensure that FSLogix Storage Account is Redundant Availability High Preview No AVD-10 Enable Azure Backup for FSLogix Storage Account Disaster Recovery Medium Preview No IT-2 - Replicate your Image Templates to a secondary region Disaster Recovery Low Preview Yes CG-2 - Zone redundant storage should be used for image versions Availability Medium Preview Yes VM-2 - Deploy VMs across Availability Zones Availability High Verified Yes VM-7 - Enable Backups on your VMs Disaster Recovery Medium Verified Yes VM-8 - Production VMs should be using SSD disks System Efficiency High Verified Yes ERC-1 - Connect your on-premises network to critical workloads in Azure through two or more ExpressRoute circuits in different peering locations Availability High Preview No ERC-2 - Ensure the two physical links of your ExpressRoute circuit are connected to two distinct edge devices in your network Availability High Preview No VPNG-1 - Choose a Zone-redundant gateway Availability High Preview Yes VPNG-3 - Plan for Site-to-Site VPN and Azure ExpressRoute coexisting connection Disaster Recovery High Preview No NSG-4 - Configure NSG Flow Logs Monitoring Medium Preview Yes VM-21 - Configure diagnostic settings for all Azure Virtual Machines Monitoring Low Preview Yes VM-25 - Do not create more than 2000 Citrix VDA servers per subscription Application Resiliency High Preview Yes Definitions of states can be found here Recommendations Details AVD-1 - Use Private link when connecting to File Share or Key Vault Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nPrivate Link is available for other Azure services that work in conjunction with Azure Virtual Desktop, such as Azure Files and Key Vault. From a resiliency standpoint, we recommending implementing private endpoints for these services to reduce exposure to potential internet-related issues such as latency, packet loss, and/or downtime. This can lead to more reliable communication between AVD and dependent services.\nResources\nLearn More Private link Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Host Pools that do not have a Private endpoint associated with them. resources | where type == \u0026#34;microsoft.desktopvirtualization/hostpools\u0026#34; | where properties[\u0026#39;privateEndpointConnections\u0026#39;][0][\u0026#39;properties\u0026#39;][\u0026#39;provisioningState\u0026#39;] != \u0026#34;Succeeded\u0026#34; | project recommendationId = \u0026#34;avd-1\u0026#34;, name, id, tags, param1=\u0026#34;Private Endpoint: No Endpoint\u0026#34; AVD-2 - Monitor Service Health and Resource Health of AVD Category: Monitoring\nImpact: Medium\nGuidance\nUse Service Health to stay informed about the health of the Azure services and regions that you use to insure their availability. Set up Service Health alerts so that you stay aware of service issues, planned maintenance, or other changes that might affect your Azure Virtual Desktop resources. Use Resource Health to monitor your VMs and storage solutions.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-3 - Deploy Session Hosts in an Availability Zone Category: Availability\nImpact: High\nGuidance\nDeploy session hosts in an availability zone or an availability set helps protect the environment from outages.\nEnhances reliability by minimizing latency and impacts reliability helping keep the data synchronized and protecting from outages. If one zone experiences an outage, then regional services, capacity, and high availability are supported by the remaining zones.\nResources\nLearn More Availability Zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-4 - Deploy Domain Controllers and DNS Servers in Azure Virtual Network Across Availability Zones Category: Availability\nImpact: Medium\nGuidance\nWhen using an AD DS identity solution with AVD, it is recommended to deploy domain controllers and DNS servers on Azure virtual machines across availability zones. This improves the environment‚Äôs reliability by removing a dependency on an on-premises service and improves performance by creating a shorter path for user authentication.\nThis recommendation is not relevant when you are utilizing Microsoft Entra as the identity provider.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-5 - Implement RDP Shortpath for Public or Managed Networks Category: Networking\nImpact: Medium\nGuidance\nIt is recommended to enable RDP Shortpath for AVD. RDP Shortpath is a feature of Azure Virtual Desktop that establishes a direct UDP-based transport between a supported Windows Remote Desktop client and session host. By default, Remote Desktop Protocol (RDP) tries to establish connection using UDP and uses a TCP-based reverse connect transport as a fallback connection mechanism. TCP-based reverse connect transport provides the best compatibility with various networking configurations and has a high success rate for establishing RDP connections. UDP-based transport offers better connection reliability and more consistent latency.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-6 - Implement a Multi-Region BCDR Plan Category: Disaster Recovery\nImpact: Medium\nGuidance\nIt is recommended to adopt a multi-region deployment (active-active) for AVD. Each region should contain at least identity, name resolution, AVD management resources, and session hosts in case of a primary region outage.\nResources\nMulti-region BCDR Learn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-7 - Store Golden Image Redundantly for Disaster Recovery Category: Disaster Recovery\nImpact: Low\nGuidance\nIf a full BCDR strategy is not in place, consider using zone-redundant storage to store golden images across availability zones. Having the image available will allow for faster recovery in case of zonal or regional outage.\nResources\nGolden Image Learn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-8 - Capacity Planning for AVD Resources Category: Disaster Recovery\nImpact: Low\nGuidance\nMonitor and plan for subscription limits. Closely monitor your Azure Virtual Desktop deployments, and keep track of resource usage within your subscription. By proactively monitoring capacity, you can identify potential challenges early on, and you can take suitable actions to avoid reaching limits. Consider scaling across multiple subscriptions if further scaling is required, or work with Azure support to adjust limits based on your business requirements. To handle a large number of users, consider scaling horizontally by creating multiple host pools.\nResources\nCapacity Planning Learn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-9 - Ensure that FSLogix Storage Account is Redundant Category: Availability\nImpact: High\nGuidance\nIt is important to ensure the redundancy of our user profiles when using FSLogix. When using FSLogix with AVD, it is deployed on a file share in a storage account. Data in an Azure Storage account is always replicated three times in the primary region. Below are the options for how your data is replicated in the primary or paired region: LRS for least expensive replication (not recommended for apps with high availability and durability).\nLRS provides eleven 9s durability and replicates three time in a single physical location. ZRS is recommended for apps requiring high availability across zones. ZRS provides twelve 9s durability. Replicated across three availability zones GRS replicates an additional three copies to secondary region and provides sixteen 9s durability. GZRS provides both high availability and redundancy across geo replication. It provides sixteen 9s durability over a given year. Generally, it is recommended to store your data as secure and redundant as possible.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVD-10 - Enable Azure Backup for FSLogix Storage Account Category: Backup/Storage\nImpact: Medium\nGuidance\nIt is recommended to enable backup on the FSLogix Storage Account. Ensuring the user profiles are resilient will allow user data and experience to be consistent through outages.\nResources\nFSLogix Backup Storage Account Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-vmware-solution/",
	"title": "Azure VMware Solution",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure VMware Solution and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Azure VMware Solution and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available AVS-1 Configure Azure Service Health notification and alerts for AVS Monitoring Medium Preview Yes AVS-2 Configure Syslog in Diagnostic Settings for AVS Monitoring Medium Preview Yes AVS-3 Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization Monitoring High Preview No AVS-4 Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore Availability Low Preview Yes AVS-5 Monitor CPU Utilization to ensure sufficient resources for workloads Monitoring Medium Preview Yes AVS-6 Monitor Memory Utilization to ensure sufficient resources for workloads Monitoring Medium Preview Yes AVS-7 Monitor when Azure VMware Solution Cluster Size is approaching the host limit Monitoring Medium Preview No AVS-8 Monitor when Azure VMware Solution Private Cloud is reaching capacity limit Monitoring Medium Preview No AVS-9 Apply Resource delete lock on the resource group hosting the private cloud Governance High Preview No Definitions of states can be found here Recommendations Details AVS-1 - Configure Azure Service Health notification and alerts for AVS Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nEnsure Azure Service Health notifications and alerts are configured for the Azure VMware Solution(AVS) service in the subscriptions and regions where AVS is deployed.\nAzure Service Health is the mechanism used to inform customers of any service or security issues affecting their private cloud deployment. Additionally, Azure Service Health is used to inform customers of maintenance activities in their AVS environments including host replacements, upgrades, and any service updates which could potentially impact customer operations. Proper configuration of Azure Service Health notifications and alerts ensures that customers receive relevant notifications and can reduce service request submissions due to AVS maintenance.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have one or more service health alerts covering AVS private clouds in the deployed subscription and region pairs. //full list of private clouds (resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend locale = location | project id, name, tags, subscriptionId, locale) | join kind=leftouter //Alert ID\u0026#39;s that include all incident types filtered by AVS Service Health alerts ((resources | where type == \u0026#34;microsoft.insights/activitylogalerts\u0026#34; | extend alertproperties = todynamic(properties) | where alertproperties.condition.allOf[0].field == \u0026#34;category\u0026#34; and alertproperties.condition.allOf[0].equals == \u0026#34;ServiceHealth\u0026#34; | where alertproperties.condition.allOf[1].field == \u0026#34;properties.impactedServices[*].ServiceName\u0026#34; and set_has_element(alertproperties.condition.allOf[1].containsAny, \u0026#34;Azure VMware Solution\u0026#34;) | extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[2].containsAny),\u0026#39; \u0026#39;), \u0026#39;\u0026#39;) | mv-expand todynamic(locale) | where locale != \u0026#34;global\u0026#34; | project subscriptionId, tostring(locale) ) | union //Alert ID\u0026#39;s that include only some of the incident types after filtering by service health alerts covering AVS private clouds. (resources | where type == \u0026#34;microsoft.insights/activitylogalerts\u0026#34; | extend alertproperties = todynamic(properties) | where alertproperties.condition.allOf[0].field == \u0026#34;category\u0026#34; and alertproperties.condition.allOf[0].equals == \u0026#34;ServiceHealth\u0026#34; | where alertproperties.condition.allOf[2].field == \u0026#34;properties.impactedServices[*].ServiceName\u0026#34; and set_has_element(alertproperties.condition.allOf[2].containsAny, \u0026#34;Azure VMware Solution\u0026#34;) | extend locale = strcat_array(split(tolower(alertproperties.condition.allOf[3].containsAny),\u0026#39; \u0026#39;), \u0026#39;\u0026#39;) | mv-expand todynamic(locale) | mv-expand alertproperties.condition.allOf[1].anyOf | extend incidentType = alertproperties_condition_allOf_1_anyOf.equals | where locale != \u0026#34;global\u0026#34; | project id, subscriptionId, locale, incidentType | distinct subscriptionId, tostring(locale), tostring(incidentType) | summarize incidentTypes=count() by subscriptionId, locale | where incidentTypes == 5 //only include this subscription, region pair if it includes all the incident types. | project subscriptionId, locale)) on subscriptionId, locale | where subscriptionId1 == \u0026#34;\u0026#34; or locale1 == \u0026#34;\u0026#34; or isnull(subscriptionId1) or isnull(locale1) | project recommendationId = \u0026#34;avs-1\u0026#34;, name, id, tags, param1 = \u0026#34;avsServiceHealthAlertsAllIncidentTypesConfigured: False\u0026#34; AVS-2 - Configure Syslog in Diagnostic Settings for AVS Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nEnsure Diagnostic Settings are configured for each private cloud to send the syslogs to one or more external sources for analysis and/or archiving.\nAzure VMware Solution Syslogs have useful data for troubleshooting and performance that can help with quicker issue resolution and can also enable early detection of some kinds of issues. Configure Diagnostic Settings on the private cloud to send the Syslogs to one or more external sources for querying and/or archiving in case of an audit.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy # Azure PowerShell script # Provides a list of private clouds that don\u0026#39;t have a diagnostic setting configured to export the logs $output = @() $privateClouds = get-AzVMwarePrivateCloud foreach ($privateCloud in $privateClouds) { $ds = Get-AzDiagnosticSetting -ResourceId $privateCloud.id if (!$ds) { $output += [PSCustomObject] @{ #no diagnostic settings values recommendationId = \u0026#39;aks-2\u0026#39; name = $privateCloud.Name id = $privateCloud.Id tags = if ($privateCloud.tag) { $privateCloud.tag } else { $null } param1 = \u0026#39;exportSyslogWithDiagnosticSetting:false\u0026#39; } } if ($ds) { $fixFlag = $false foreach ($log in $ds.log) { #diagnostic settings exist but not for logs if (($log.CategoryGroup -eq \u0026#34;allLogs\u0026#34;) -and ($log.Enabled -eq $false)){ $fixFlag = $true} if (($log.Category -eq \u0026#34;vmwaresyslog\u0026#34;) -and ($log.Enabled -eq $false)){ $fixFlag = $true} } if ($fixFlag){ $output += [PSCustomObject] @{ recommendationId = \u0026#39;aks-2\u0026#39; name = $privateCloud.Name id = $privateCloud.Id tags = if ($privateCloud.tag) { $privateCloud.tag } else { $null } param1 = \u0026#39;exportSyslogWithDiagnosticSetting:false\u0026#39; } } } } $output AVS-3 - Configure Azure Monitor Alert warning thresholds for vSAN datastore utilization Category: Monitoring\nImpact: High\nRecommendation/Guidance\nEnsure storage utilization is monitored, and alerts are configured so that VMware vSAN datastore slack space‚ÄØis maintained at the level the service-level agreement (SLA) mandates.\nFor service-level agreement (SLA) purposes, Azure VMware Solution requires slack space of 25% available on vSAN. vSAN storage utilization should be regularly monitored and alerts configured at 70% utilization (30% slack space available on vSAN) and 75% utilization (25% slack space available on vSAN) in order to provide enough time for capacity planning.\nTo expand the vSAN datastore additional hosts can be added, up to the maximum supported cluster size (16 hosts). Note, you may need to request host quota. In addition, external storage can be added (e.g. Azure Elastic SAN, Azure NetApp Files, Pure Cloud Block Storage) if the CPU and RAM requirements are being met by the Azure VMware Solution cluster.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a vSAN capacity critical alert with a threshold of 75% or a warning capacity of 70%. ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tostring(id) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tostring(alertProperties_scopes) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 75 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;avs-3\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityCriticalAlert: isNull or threshold != 75\u0026#34; ) | union ( resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tostring(id) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tostring(alertProperties_scopes) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;DiskUsedPercentage\u0026#34; | where threshold == 70 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;avs-3\u0026#34;, name, id, tags, param1 = \u0026#34;vsanCapacityWarningAlert: isNull or threshold != 70\u0026#34; ) AVS-4 - Enable Stretched Clusters for Multi-AZ Availability of the vSAN Datastore Category: Availability\nImpact: Low\nRecommendation/Guidance\nIf the customer has a requirement for Multi-AZ deployment of Azure VMware Solution, need an infrastructure SLA of 99.99%, or need synchronous storage replication between AZs (RPO=0), then Azure VMware Solution Stretched Clusters should be considered. If you are in a region that supports stretched clusters, consider enabling this feature to spread the VMware vSAN datastore across two availability zones. Note: Configuring an Azure VMware Solution private cloud as a stretched cluster can only be done during initial implementation and requires twice the amount of quota. This is due to a stretched cluster extending the cluster to the second availability zone.\nResources\nLearn More Stretched Clusters Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that aren\u0026#39;t configured as stretched clusters and in supported regions. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend avsproperties = todynamic(properties) | where avsproperties.availability.strategy != \u0026#34;DualZone\u0026#34; | where location in (\u0026#34;uksouth\u0026#34;, \u0026#34;westeurope\u0026#34;, \u0026#34;germanywestcentral\u0026#34;, \u0026#34;australiaeast\u0026#34;) | project recommendationId = \u0026#34;avs-4\u0026#34;, name, id, tags, param1 = \u0026#34;stretchClusters: Disabled\u0026#34; AVS-5 - Monitor CPU Utilization to ensure sufficient resources for workloads Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nEnsure there are enough compute resources to avoid host resource exhaustion. Azure VMware Solution uses vSphere DRS and vSphere HA to manage workload resources dynamically, however sustained host CPU utilization of over 95% can contribute to high CPU Ready times which will impact running workloads.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a Cluster CPU capacity critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tostring(id) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tostring(alertProperties_scopes) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;EffectiveCpuAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;avs-5\u0026#34;, name, id, tags, param1 = \u0026#34;hostCpuCriticalAlert: isNull or threshold != 95\u0026#34; AVS-6 - Monitor Memory Utilization to ensure sufficient resources for workloads Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nEnsure there are enough memory resources to avoid host resource exhaustion. Azure VMware Solution uses vSphere DRS and vSphere HA to manage workload resources dynamically, however sustained host memory utilization of over 95% can contribute to host memory swapping to disk which will impact running workloads.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure VMware Solution resources that don\u0026#39;t have a cluster host memory critical alert with a threshold of 95%. resources | where [\u0026#39;type\u0026#39;] == \u0026#34;microsoft.avs/privateclouds\u0026#34; | extend scopeId = tostring(id) | project [\u0026#39;scopeId\u0026#39;], name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | extend alertProperties = todynamic(properties) | mv-expand alertProperties.scopes | mv-expand alertProperties.criteria.allOf | extend scopeId = tostring(alertProperties_scopes) | extend metric = alertProperties_criteria_allOf.metricName | extend threshold = alertProperties_criteria_allOf.threshold | project scopeId, tostring(metric), toint([\u0026#39;threshold\u0026#39;]) | where metric == \u0026#34;UsageAverage\u0026#34; | where threshold == 95 ) on scopeId | where isnull([\u0026#39;threshold\u0026#39;]) | project recommendationId = \u0026#34;avs-6\u0026#34;, name, id, tags, param1 = \u0026#34;hostMemoryCriticalAlert: isNull or threshold != 95\u0026#34; AVS-7 - Monitor when Azure VMware Solution Cluster Size is approaching the host limit Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nAlert when the cluster size of 14 hosts is reached. Periodically fire up alerts, to prompt the customer to plan for a new cluster or additional datastore, if growth driven solely by storage. Beyond 14 hosts, every time a new host is added, surface an alert.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVS-8 - Monitor when Azure VMware Solution Private Cloud is reaching capacity limit Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nAlert when the total node count is greater than or equal to 90 hosts so that it\u0026rsquo;s clear when to start planning for a new private cloud.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AVS-9 - Apply Resource delete lock on the resource group hosting the private cloud Category: Governance\nImpact: High\nRecommendation/Guidance\nAnyone with contributor access on the resource group hosting Azure VMware Solution Private Cloud can delete it. Applying a resource delete lock to the Azure VMware Solution Private Cloud resource group to prevent deletion of the Azure VMware Solution Private Cloud.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/batch/batch-accounts/",
	"title": "Batch Accounts",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Batch Accounts and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Batch Accounts (Azure High Performance Computing) and associated resources and settings.\nSummary of Recommendations Recommendation Impact Design Area State ARG Query Available BA-1 Monitor Batch account quota Medium Monitoring Preview No BA-3 Create an Azure Batch pool across Availability Zones High Availability Preview No Definitions of states can be found here Recommendations Details BA-1 - Monitor Batch Account quota Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nTo enable Cross-region disaster recovery and business continuity, ensure that the appropriate quotas are set for all user subscription Batch accounts. This will allocate the required number of cores made available upfront. Without enough allocated cores capacity a job execution will be interrupted with operational errors indicating \u0026ldquo;Quota Reached\u0026rdquo;.\nPre-create all required services in each region, such as the Batch account and the storage account. There\u0026rsquo;s often no charge for having accounts created, and charges accrue only when the account is used or when data is stored.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg BA-3 - Create an Azure Batch pool across Availability Zones Category: Availability\nImpact: High\nRecommendation/Guidance\nWhen you create an Azure Batch pool using Virtual Machine Configuration, you can choose to provision your Batch pool across Availability Zones. Creating your pool with this zonal policy helps protect your Batch compute nodes from Azure datacenter-level failures. For example, you could create your pool with zonal policy in an Azure region that supports three Availability Zones. If an Azure datacenter in one Availability Zone has an infrastructure failure, your Batch pool will still have healthy nodes in the other two Availability Zones, so the pool will remain available for task scheduling.\nResources\nLearn More Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/categories/",
	"title": "Categories",
	"tags": null,
	"description": "",
	"content": ""
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/compute-gallery/",
	"title": "Compute Gallery",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Compute gallery and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Compute Gallery and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available CG-1 - A minimum of three replicas should be kept for production image versions Availability Medium Preview Yes CG-2 - Zone redundant storage should be used for image versions Availability Medium Preview Yes CG-3 - Consider using hyper-V generation version 2 images where possible Availability Low Preview Yes Definitions of states can be found here Recommendations Details CG-1 - A minimum of three replicas should be kept for production image versions Category: Availability\nImpact: Medium\nGuidance\nKeep a minimum of 3 replicas for production images. In multi-VM deployment scenarios the VM deployments can be spread to different replicas reducing the chance of instance creation processing being throttled due to overloading of a single replica. For every 20 VMs that you create concurrently, we recommend you keep one replica. For example, if you create 1000 VMs concurrently, you should keep 50 replicas (you can have a maximum of 50 replicas per region). To update the replica count, please go to the gallery -\u0026gt; Image Definition -\u0026gt; Image Version -\u0026gt; Update replication.\nResources\nCompute Gallery best practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Query to list all image versions,its associated image name and version replica configurations per region in a compute gallery whose version replicas is less than 3 resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | mv-expand VersionReplicas = properties.publishingProfile.targetRegions | project RecommendationId=\u0026#34;cg-1\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;VersionReplicaRegionName: \u0026#34;,VersionReplicas.name),param4=strcat(\u0026#34;VersionReplicationCount: \u0026#34;,VersionReplicas.regionalReplicaCount),rc=toint(VersionReplicas.regionalReplicaCount) | where rc \u0026lt; 3 | project-away rc CG-2 - Zone redundant storage should be used for image versions Category: Availability\nImpact: Medium\nGuidance\nUse ZRS wherever available for high availability. You can configure ZRS in the replication tab when you create a version of the image or VM application. Azure Zone Redundant Storage (ZRS) provides resilience against an Availability Zone failure in the region. With the general availability of Azure Compute Gallery, you can choose to store your images in ZRS accounts in regions with Availability Zones. You can also choose the account type for each of the target regions. The default storage account type is Standard_LRS, but it is recommended to select Standard_ZRS for regions with Availability Zones.\nResources\nCompute Gallery best practices Zone-redundant storage Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Query to list all image versions and its associated image and gallery name whose Storage account type is not using ZRS resources | where type =~ \u0026#34;microsoft.compute/galleries/images/versions\u0026#34; | extend GalleryName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[8]), ImageName = tostring(split(tostring(id), \u0026#34;/\u0026#34;)[10]) | extend StorageAccountType = tostring(properties.publishingProfile.storageAccountType) | where StorageAccountType !has \u0026#34;ZRS\u0026#34; | project RecommendationId=\u0026#34;cg-2\u0026#34;,name,id,tags,param1=strcat(\u0026#34;GalleryName: \u0026#34;,GalleryName),param2=strcat(\u0026#34;ImageName: \u0026#34;,ImageName),param3=strcat(\u0026#34;StorageAccountType: \u0026#34;,StorageAccountType) CG-3 - Consider using hyper-V generation version 2 images where possible Category: Availability\nImpact: Low\nGuidance\nWe recommend that you create a generation 2 virtual machine to take advantage of features like Secure Boot, vTPM, trusted launch VMs, large boot volume. Your choice to create a generation 1 or generation 2 virtual machine depends on which guest operating system you want to install and the boot method you want to use to deploy the virtual machine. You can\u0026rsquo;t change a virtual machine\u0026rsquo;s generation after you\u0026rsquo;ve created it. So it is recommended to review the considerations first.\nResources\nCompute Gallery best practices Generation 1 vs Generation 2 in Hyper-V Images in Compute gallery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Query to list all images whose Hyper-V generation is not V2 resources | where type =~ \u0026#34;microsoft.compute/galleries/images\u0026#34; | extend VMGeneration = properties.hyperVGeneration | where VMGeneration \u0026lt;\u0026gt; \u0026#39;V2\u0026#39; | project RecommendationId=\u0026#34;cg-3\u0026#34;,name,id,tags,param1=strcat(\u0026#34;VMGeneration: \u0026#34;,VMGeneration) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/container/container-registry/",
	"title": "Container Registry",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Container Registries and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Container Registries and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available CR-1 - Use Premium tier for critical production workloads System Efficiency High Preview Yes CR-2 - Enable zone redundancy Availability High Preview Yes CR-3 - Enable geo-replication Disaster Recovery High Preview Yes CR-4 - Maximize pull performance System Efficiency High Preview No CR-5 - Use Repository namespaces Access \u0026amp; Security Low Preview No CR-6 - Move Container Registry to a dedicated resource group Governance Low Preview Yes CR-7 - Manage registry size System Efficiency Medium Preview No CR-8 - Disable anonymous pull access Access \u0026amp; Security Medium Preview Yes CR-10 - Configure Diagnostic Settings for all Azure Container Registries Monitoring Medium Preview No CR-11 - Monitor Azure Container Registry with Azure Monitor Monitoring Medium Preview No CR-12 - Enable soft delete policy Disaster Recovery Medium Preview Yes Definitions of states can be found here Recommendations Details CR-1 - Use Premium tier for critical production workloads Category: System Efficiency\nImpact: High\nGuidance\nChoose a service tier of Azure Container Registry that meets your performance needs. The Premium tier provides the greatest bandwidth and highest rate of concurrent read and write operations when you have high-volume deployments. Use Basic for getting started, Standard for most production applications, and Premium for hyper-scale performance and geo-replication.\nResources\nContainer Registry Best Practices Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Container Registries that are not using the Premium tier resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where sku.name != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;cr-1\u0026#34;, name, id, tags, param1=strcat(\u0026#34;SkuName: \u0026#34;, tostring(sku.name)) | order by id asc CR-2 - Enable zone redundancy Category: Availability\nImpact: High\nGuidance\nAzure Container Registry supports optional zone redundancy. Zone redundancy provides resiliency and high availability to a registry or replication resource (replica) in a specific region.\nResources\nRegistry best practices - Enable zone redundancy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Container Registries that do not have zone redundancy enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.zoneRedundancy != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;cr-2\u0026#34;, name, id, tags, param1=strcat(\u0026#34;zoneRedundancy: \u0026#34;, tostring(properties.zoneRedundancy)) | order by id asc CR-3 - Enable geo-replication Category: Disaster Recovery\nImpact: High\nGuidance\nUse Azure Container Registry\u0026rsquo;s geo-replication feature if you\u0026rsquo;re deploying containers to multiple regions. Whether you\u0026rsquo;re serving global customers from local data centers or your development team is in different locations, you can simplify registry management and minimize latency by geo-replicating your registry. You can also configure regional webhooks to notify you of events in specific replicas such as when images are pushed.\nGeo-replication is available with Premium registries.\nResources\nRegistry best practices - Enable geo-replication Geo-Replicate Container Registry Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Container Registries that do not have geo-replication enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | project registryName = name, registryId = id, tags, primaryRegion = location | join kind=leftouter ( Resources | where type =~ \u0026#34;microsoft.containerregistry/registries/replications\u0026#34; | project replicationRegion=name, replicationId = id | extend registryId=strcat_array(array_slice(split(replicationId, \u0026#39;/\u0026#39;), 0, -3), \u0026#39;/\u0026#39;) ) on registryId | project-away registryId1, replicationId | where isempty(replicationRegion) | project recommendationId = \u0026#34;cr-3\u0026#34;, name=registryName, id=registryId, tags | order by id asc CR-4 - Maximize pull performance Category: System Efficiency\nImpact: High\nGuidance\nSome characteristics of your images themselves can impact pull performance:\nImage size - Minimize the sizes of your images by removing unnecessary layers or reducing the size of layers. One way to reduce image size is to use the multi-stage Docker build approach to include only the necessary runtime components. Also check whether your image can include a lighter base OS image. And if you use a deployment environment such as Azure Container Instances that caches certain base images, check whether you can swap an image layer for one of the cached images.\nNumber of layers - Balance the number of layers used. If you have too few, you don‚Äôt benefit from layer reuse and caching on the host. Too many, and your deployment environment spends more time pulling and decompressing. Five to 10 layers is optimal.\nResources\nRegistry authentication options - Azure Container Registry Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg CR-5 - Use Repository namespaces Category: Access \u0026amp; Security\nImpact: Low\nGuidance\nBy using repository namespaces, you can allow sharing a single registry across multiple groups within your organization. Registries can be shared across deployments and teams. Azure Container Registry supports nested namespaces, enabling group isolation. However, the registry manages all repositories independently, not as a hierarchy.\nResources\nRegistry best practices - use repository namespaces Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg CR-6 - Move Container Registry to a dedicated resource group Category: Governance\nImpact: Low\nGuidance\nBecause container registries are resources that are used across multiple container hosts, a registry should reside in its own resource group.\nAlthough you might experiment with a specific host type, such as Azure Container Instances, you\u0026rsquo;ll likely want to delete the container instance when you\u0026rsquo;re done. However, you might also want to keep the collection of images you pushed to Azure Container Registry. By placing your registry in its own resource group, you minimize the risk of accidentally deleting the collection of images in the registry when you delete the container instance resource group.\nResources\nRegistry best practices - Use dedicated resource group Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // List container registries that contain additional resources within the same resource group. resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | project registryName=name, registryId=id, registryTags=tags, resourceGroupId=strcat(\u0026#39;/subscriptions/\u0026#39;, subscriptionId, \u0026#39;/resourceGroups/\u0026#39;, resourceGroup), resourceGroup, subscriptionId | join kind=inner ( resources | where not(type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34;) | summarize recourceCount=count() by subscriptionId, resourceGroup | where recourceCount != 0 ) on resourceGroup, subscriptionId | project recommendationId = \u0026#34;cr-6\u0026#34;, name=registryName, id=registryId, tags=registryTags, param1=strcat(\u0026#39;resourceGroupName:\u0026#39;,resourceGroup), param2=strcat(\u0026#39;resourceGroupId:\u0026#39;,resourceGroupId) CR-7 - Manage registry size Category: System Efficiency\nImpact: Medium\nGuidance\nThe storage constraints of each container registry service tier are intended to align with a typical scenario: Basic for getting started, Standard for most production applications, and Premium for hyper-scale performance and geo-replication. Throughout the life of your registry, you should manage its size by periodically deleting unused content. Consider also enabling a retention policy to automatically delete untagged image manifests to free up storage space.\nResources\nRegistry best practices - Manage registry size Retention Policy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Container Registries that have their retention policy disabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.policies.retentionPolicy.status == \u0026#34;disabled\u0026#34; | project recommendationId = \u0026#34;cr-7\u0026#34;, name, id, tags, param1=\u0026#39;retentionPolicy:disabled\u0026#39; | order by id asc CR-8 - Disable anonymous pull access Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nBy default, access to pull or push content from an Azure container registry is only available to authenticated users. Enabling anonymous (unauthenticated) pull access makes all registry content publicly available for read (pull) actions. Warning: Anonymous pull access currently applies to all repositories in the registry. If you manage repository access using repository-scoped tokens, all users may pull from those repositories in a registry enabled for anonymous pull. We recommend deleting tokens when anonymous pull access is enabled.\nResources\nEnable anonymous pull access Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Container Registries that have anonymous pull access enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.anonymousPullEnabled == \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;cr-8\u0026#34;, name, id, tags | order by id asc CR-10 - Configure Diagnostic Settings for all Azure Container Registries Category: Monitoring\nImpact: Medium\nGuidance\nResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\nResources\nMonitoring Azure Container Registry data reference - Resource Logs Monitor Azure Container Registry - Enable diagnostic logs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg CR-11 - Monitor Azure Container Registry with Azure Monitor Category: Monitoring\nImpact: Medium\nGuidance\nWhen you have critical applications and business processes relying on Azure resources, you want to monitor those resources for their availability, performance, and operation. Azure Container Registry creates monitoring data using Azure Monitor, which is a full stack monitoring service in Azure that provides a complete set of features to monitor your Azure resources in addition to resources in other clouds and on-premises.\nResources\nMonitoring Azure Container Registry data reference Monitor Azure Container Registry Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg CR-12 - Enable soft delete policy Category: Disaster Recovery\nImpact: Medium\nGuidance\nOnce you enable the soft delete policy, ACR manages the deleted artifacts as the soft deleted artifacts with a set retention period. Thereby you have ability to list, filter, and restore the soft deleted artifacts. Once the retention period is complete, all the soft deleted artifacts are auto-purged.\nResources\nEnable soft delete policy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure Container Registry resources that do not have soft delete enabled resources | where type =~ \u0026#34;microsoft.containerregistry/registries\u0026#34; | where properties.policies.softDeletePolicy.status == \u0026#34;disabled\u0026#34; | project recommendationId = \u0026#34;cr-12\u0026#34;, name, id, tags | order by id asc "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/cosmosdb/",
	"title": "Cosmos DB",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Cosmos DB and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Cosmos DB and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available COSMOS-1 ‚Äì Configure at least two regions for high availability Availability High Preview Yes COSMOS-2 ‚Äì Enable service-managed failover for multi-region accounts with single write region Disaster Recovery High Preview No COSMOS-3 ‚Äì Evaluate multi-region write capability Disaster Recovery High Preview Yes COSMOS-4 ‚Äì Choose appropriate consistency mode reflecting data durability requirements Disaster Recovery High Preview No COSMOS-5 ‚Äì Configure continuous backup mode Disaster Recovery High Preview Yes COSMOS-6 ‚Äì Ensure query results are fully drained System Efficiency High Preview No COSMOS-7 ‚Äì Maintain singleton pattern in your client System Efficiency Medium Preview No COSMOS-8 ‚Äì Implement retry logic in your client Application Resilience Medium Preview No COSMOS-9 ‚Äì Monitor Cosmos DB health and set up alerts Monitoring Medium Preview No Definitions of states can be found here Recommendations Details COSMOS-1 - Configure at least two regions for high availability Category: Availability\nImpact: High\nGuidance\nAzure implements multi-tier isolation approach with rack, DC, zone, and region isolation levels. Cosmos DB is by default highly resilient by running four replicas, but it is still susceptible to failures or issues with entire regions or availability zones. As such, it is crucial to enable at least a secondary region on your Cosmos DB to achieve higher SLA. Doing so does not incur any downtime at all and it is as easy as selecting a pin on map.\nResources\nDistribute data globally with Azure Cosmos DB | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026lt; 2 | project recommendationId=\u0026#39;cosmos-1\u0026#39;, name, id, tags COSMOS-2 - Enable service-managed failover for multi-region accounts with single write region Category: Disaster Recovery\nImpact: High\nGuidance\nCosmos DB is a battle-tested service with extremely high uptime and resiliency, but even the most resilient of systems sometimes run into a small hiccup. Should a region become unavailable, the Service-Managed failover option allows Azure Cosmos DB to fail over automatically to the next available region with no user action needed.\nResources\nManage an Azure Cosmos DB account by using the Azure portal | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development COSMOS-3 - Evaluate multi-region write capability Category: Disaster Recovery\nImpact: High\nGuidance\nMulti-region write capability enables you to design multi-region application that is inherently highly available by virtue of being active in multiple regions. This, however, requires that you pay close considerations to consistency requirements and handle potential writes conflicts by way of conflict resolution policy. On the flip side, blindly enabling this configuration can lead to decreased availability due to unexpected application behavior and data corruption due to unhandled conflicts.\nResources\nDistribute data globally with Azure Cosmos DB | Microsoft Learn Conflict resolution types and resolution policies in Azure Cosmos DB | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where array_length(properties.locations) \u0026gt; 1 and properties.enableMultipleWriteLocations == false | project recommendationId=\u0026#39;cosmos-3\u0026#39;, name, id, tags COSMOS-4 - Choose appropriate consistency mode reflecting data durability requirements Category: Disaster Recovery\nImpact: High\nGuidance\nWithin a globally distributed database environment, there is a direct relationship between the consistency level and data durability in the presence of a region-wide outage. As you develop your business continuity plan, you need to understand the maximum period of recent data updates the application can tolerate losing when recovering after a disruptive event. We recommend using Session consistency unless you have established that stronger consistency mode is needed, you are willing to tolerate higher write latencies, and understand that outages on read-only regions can affect the ability of write region to accept writes.\nResources\nConsistency level choices - Azure Cosmos DB | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development COSMOS-5 - Configure continuous backup mode Category: Disaster Recovery\nImpact: High\nGuidance\nCosmos DB automatically backs up your data and there is no way to turn back ups off. In short, you are always protected. But should any mishap occur ‚Äì a process that went haywire and deleted data it shouldn‚Äôt, customer data was overwritten by accident, etc. ‚Äì minimizing the time it takes to revert the changes is of the essence. With continuous mode, you can self-serve restore your database/collection to a point in time before such mishap occurred. With periodic mode, however, you must contact Microsoft support, which despite us striving to provide speedy help will inevitably increase the restore time.\nResources\nContinuous backup with point in time restore feature in Azure Cosmos DB | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Resources | where type =~ \u0026#39;Microsoft.DocumentDb/databaseAccounts\u0026#39; | where properties.backupPolicy.type == \u0026#39;Periodic\u0026#39; and properties.enableMultipleWriteLocations == false and properties.enableAnalyticalStorage == false | project recommendationId=\u0026#39;cosmos-5\u0026#39;, name, id, tags COSMOS-6 - Ensure query results are fully drained Category: System Efficiency\nImpact: High\nGuidance\nCosmos DB limits single response to 4 MB. If your query requests a large amount of data or data from multiple backend partitions, the results will span multiple pages for which separate requests must be issued. Each result page will indicate whether more results are available and provide a continuation token to access the next page. You must include a while loop in your code and traverse the pages until no more results are available.\nResources\nPagination in Azure Cosmos DB | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development COSMOS-7 - Maintain singleton pattern in your client Category: System Efficiency\nImpact: Medium\nGuidance\nNot only is establishing a new database connection expensive, so is maintaining it. As such it is critical to maintain only one instance, a so-called ‚Äúsingleton‚Äù, of the SDK client per account per application. Connections, both HTTP and TCP, are scoped to the client instance. Most compute environments have limitations in terms of the number of connections that can be open at the same time and when these limits are reached, connectivity will be affected.\nResources\nDesigning resilient applications with Azure Cosmos DB SDKs | Microsoft Learn Resource Graph Query/Scripts Show/Hide Query/Script Copy // under-development COSMOS-8 - Implement retry logic in your client Category: Application Resilience\nImpact: Medium\nGuidance\nCosmos DB SDKs by default handle large number of transient errors and automatically retry operations, where possible. That said, your application should add retry policies for certain well-defined cases that cannot be generically handled by the SDKs.\nResources\nDesigning resilient applications with Azure Cosmos DB SDKs | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development COSMOS-9 - Monitor Cosmos DB health and set up alerts Category: Monitoring\nImpact: Medium\nGuidance\nIt is good practice to monitor the availability and responsiveness of your Azure Cosmos DB resources and have alerts in place for your workload to stay proactive in case an unforeseen event occurs.\nResources\nCreate alerts for Azure Cosmos DB using Azure Monitor | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/db-for-mysql/",
	"title": "DB for MySQL",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Db for Mysql and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include DB for MySQL and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available MYSQL-1 - Enable HA with zone redundancy Availability High Preview Yes MYSQL-2 - Enable custom maintenance schedule System Efficiency High Preview Yes Definitions of states can be found here Recommendations Details MYSQL-1 - Enable HA with zone redundancy Category: Availability\nImpact: High\nGuidance\nEnable HA with zone redundancy on flexible server instances. Zone redundant high availability deploys a standby replica in a different zone with automatic failover capability.\nResources\nHigh availability concepts in Azure Database for MySQL - Flexible Server Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Database for MySQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;psql-1\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; MYSQL-2 - Enable custom maintenance schedule Category: System Efficiency\nImpact: High\nGuidance\nUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\nResources\nScheduled maintenance in Azure Database for MySQL - Flexible Server Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Database for MySQL instances that do not have a custom maintenance window resources | where type == \u0026#34;microsoft.dbformysql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;psql-2\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;]) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/db-for-postgresql/",
	"title": "DB for PostgreSQL",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Database for PostgreSQL and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Database for PostgreSQL and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available PSQL-1 - Enable HA with zone redundancy Availability High Preview Yes PSQL-2 - Enable custom maintenance schedule System Efficiency High Preview Yes Definitions of states can be found here Recommendations Details PSQL-1 - Enable HA with zone redundancy Category: Availability\nImpact: High\nRecommendation\nEnable HA with zone redundancy on flexible server instances. Zone redundant high availability deploys a standby replica in a different zone with automatic failover capability.\nResources\nOverview of high availability with Azure Database for PostgreSQL Resource Graph Query\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Database for PostgreSQL instances that are not zone redundant resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.highAvailability.mode != \u0026#34;ZoneRedundant\u0026#34; | project recommendationId = \u0026#34;psql-1\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; PSQL-2 - Enable custom maintenance schedule Category: System Efficiency\nImpact: High\nRecommendation\nUse custom maintenance schedule on flexible server instances to select a preferred time for service updates to be applied.\nResources\nScheduled maintenance in Azure Database for PostgreSQL - Flexible Server Resource Graph Query\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Database for PostgreSQL instances that do not have a custom maintenance window resources | where type == \u0026#34;microsoft.dbforpostgresql/flexibleservers\u0026#34; | where properties.maintenanceWindow.customWindow != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;psql-2\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;customWindow:\u0026#34;, properties[\u0026#39;maintenanceWindow\u0026#39;][\u0026#39;customWindow\u0026#39;]) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/ddos-protection-plans/",
	"title": "DDoS Protection Plans",
	"tags": null,
	"description": "Best practices and resiliency recommendations for DDoS Protection Plans and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include DDoS Protection Plans and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available DDOS-1 - Monitor Azure DDoS Protection Plan metrics Access \u0026amp; Security Medium Preview No Definitions of states can be found here Recommendations Details DDOS-1 - Monitor Azure DDoS Protection Plan metrics Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nThe metric names present different packet types, and bytes vs. packets, with a basic construct of tag names on each metric as follows:\nDropped tag name (for example, Inbound Packets Dropped DDoS): The number of packets dropped/scrubbed by the DDoS protection system. Forwarded tag name (for example Inbound Packets Forwarded DDoS): The number of packets forwarded by the DDoS system to the destination VIP ‚Äì traffic that wasn\u0026rsquo;t filtered. No tag name (for example Inbound Packets DDoS): The total number of packets that came into the scrubbing system ‚Äì representing the sum of the packets dropped and forwarded. Resources\nMonitoring Azure DDoS Protection Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/integration/event-grid/",
	"title": "Event Grid",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Event Grid and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Event Grid and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available EVG-1 - Configure Diagnostic Settings for all Azure Event Grid resources Monitoring Low Preview No EVG-2 - Configure Dead-letter to save events that cannot be delivered Automation Low Preview No EVG-3 - Configure Private Endpoints Access \u0026amp; Security Low Preview Yes Definitions of states can be found here Recommendations Details EVG-1 - Configure Diagnostic Settings for all Azure Event Grid resources Category: Monitoring\nImpact: Low\nGuidance\nEnabling diagnostic settings allow you to capture and view diagnostic information so that you can troubleshoot any failures. The following table shows the settings available for different types of Event Grid resources - custom topics, system topics, and domains.\nResources\nAzure Event Grid - Enable diagnostic logs for Event Grid resources Resource Graph Query/Scripts\nShow/Hide Query/Script Copy #Pulls a list of all event grid resources without diagnostic settings configured. $NeedsDiagnosticSetting = @() $subscriptions = Get-azsubscription foreach ($subscription in $subscriptions){ set-azcontext $subscription | Out-Null $EventGridResources = @() $EventGridResources += get-azresource -Resourcetype \u0026#34;microsoft.eventgrid/systemtopics\u0026#34; $EventGridResources += get-azresource -Resourcetype \u0026#34;microsoft.eventgrid/topics\u0026#34; $EventGridResources += get-azresource -Resourcetype \u0026#34;microsoft.eventgrid/domains\u0026#34; foreach ($resource in $EventGridResources){ $result = Get-AzDiagnosticSetting -resourceid $resource.resourceid If ($result -eq $null) {$NeedsDiagnosticSetting += $resource} } } $NeedsDiagnosticSetting | select Name, ResourceType, ResourceGroupName, Location, ResourceID | format-table EVG-2 - Configure Dead-letter to save events that cannot be delivered Category: Automation\nImpact: Low\nGuidance\nWhen Event Grid can\u0026rsquo;t deliver an event within a certain time period or after trying to deliver the event a certain number of times, it can send the undelivered event to a storage account. This process is known as dead-lettering. By default, Event Grid doesn\u0026rsquo;t turn on dead-lettering. To enable it, you must specify a storage account to hold undelivered events when creating the event subscription. You pull events from this storage account to resolve deliveries.\nResources\nAzure Event Grid delivery and retry Resource Graph Query/Scripts\nShow/Hide Query/Script Copy #Pulls a list of all event grid subscriptions without dead letter configured. $NeedsDeadLetter = @() $subscriptions = Get-azsubscription foreach ($subscription in $subscriptions){ set-azcontext $subscription | Out-Null $EventGridSub = (Get-AzEventGridSubscription).PsEventSubscriptionsList foreach ($resource in $EventGridSub){ $result = $resource.DeadLetterEndpoint If ($result -eq $null) {$NeedsDeadLetter += $resource} } } $NeedsDeadLetter | select EventSubscriptionName, Type, ID | format-table EVG-3 - Configure Private Endpoints Category: Access \u0026amp; Security\nImpact: Low\nGuidance\nYou can use private endpoints to allow ingress of events directly from your virtual network to your custom topics and domains securely over a private link without going through the public internet. The private endpoint uses an IP address from the VNet address space for your custom topic or domain.\nResources\nConfigure private endpoints for Azure Event Grid topics or domains Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all eventgrid services not protected by private endpoints. Resources | where type contains \u0026#34;eventgrid\u0026#34; | where properties[\u0026#39;publicNetworkAccess\u0026#39;] == \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;evg-3\u0026#34;, name, id, tags | order by id asc "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/integration/event-hub/",
	"title": "Event Hub",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Event Hub and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Event Hub and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available EVHNS-1 - Enable zone redundancy for Event Hub namespace High Availability High Preview Yes EVHNS-2 - Enable auto-inflate on Event Hub Standard tier System Efficiency High Preview Yes Definitions of states can be found here Recommendations Details EVHNS-1 - Enable zone redundancy for Event Hub namespace Category: Availability\nImpact: High\nRecommendation\nEvent Hubs supports Availability Zones, providing fault-isolated locations within an Azure region. The Availability Zones support is only available in Azure regions with availability zones. Both metadata and data (events) are replicated across data centers in the availability zone.\nResources\nAzure Event Hubs - Geo-disaster recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Event Hub namespace instances that are not zone redundant resources | where type == \u0026#34;microsoft.eventhub/namespaces\u0026#34; | where properties.zoneRedundant == false | project recommendationId = \u0026#34;evhns-1\u0026#34;, name, id, tags, param1 = \u0026#34;ZoneRedundant: False\u0026#34; | order by id asc EVHNS-2 - Enable auto-inflate on Event Hub Standard tier Category: System Efficiency\nImpact: High\nRecommendation\nEnable auto-inflate on Event Hub Standard tier namespaces. The auto-inflate feature of Event Hubs automatically scales up by increasing the number of TUs, to meet usage needs. Increasing TUs prevents throttling scenarios where data ingress or data egress rates exceed the rates allowed by the TUs assigned to the namespace.\nResources\nAzure Event Hubs - Automatically scale throughput units Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Event Hub namespace instances that are Standard tier and do not have Auto Inflate enabled resources | where type == \u0026#34;microsoft.eventhub/namespaces\u0026#34; | where sku.tier == \u0026#34;Standard\u0026#34; | where properties.isAutoInflateEnabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;evhns-2\u0026#34;, name, id, tags, param1 = \u0026#34;AutoInflateEnabled: False\u0026#34; "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/expressroute-circuits/",
	"title": "ExpressRoute Circuits",
	"tags": null,
	"description": "Best practices and resiliency recommendations for ExpressRoute circuits and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include ExpressRoute circuits and associated ExpressRoute circuit settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for ExpressRoute circuits and associated resources.\nRecommendation Category Impact State ARG Query Available ERC-1 - Connect your on-premises network to critical workloads in Azure through two or more ExpressRoute circuits in different peering locations Availability High Preview No ERC-2 - Ensure the two physical links of your ExpressRoute circuit are connected to two distinct edge devices in your network Availability High Preview No ERC-3 - Ensure both connections of an ExpressRoute circuit are configured in active-active mode Availability High Preview Yes ERC-4 - Ensure Bidirectional Forwarding Detection is enabled and configured on customer or provider edge routing devices Availability High Preview No ERC-5 - Configure monitoring and alerting for ExpressRoute circuits Monitoring Medium Preview No ERC-6 - Configure service health to receive ExpressRoute circuit maintenance notification Monitoring Medium Preview No ERC-7 - Use a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit Disaster Recovery Medium Preview No Definitions of states can be found here Recommendations Details ERC-1 - Connect your on-premises network to critical workloads in Azure through two or more ExpressRoute circuits in different peering locations Category: Availability\nImpact: High\nGuidance\nConnect each ExpressRoute Gateway to a minimum of two circuits instantiated in different peering locations. Resources\nDesigning for disaster recovery with ExpressRoute private peering Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// under-development ERC-2 - Ensure the two physical links of your ExpressRoute circuit are connected to two distinct edge devices in your network Category: Availability\nImpact: High\nGuidance\nMicrosoft (in the ExpressRoute direct model) or the ExpressRoute provider (in the ExpressRoute provider-based model) always offer a physically redundant service. Make sure that the same level of physical redundancy (two physical devices, two physical links) is used across the entire path from the ExpressRoute peering location to your network.\nResources\nDesigning for high availability with ExpressRoute Azure Well-Architected Framework review - Azure ExpressRoute - Design Checklist Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// cannot-be-validated-with-arg ERC-3 - Ensure both connections of an ExpressRoute circuit are configured in active-active mode Category: Availability\nImpact: High\nGuidance\nTo improve high availability, it\u0026rsquo;s recommended that you operate both the connections of an ExpressRoute circuit in active-active mode. If you configure the connections to operate in active-active mode, the Microsoft network will load balance the traffic across the connections on a per-flow basis.\nResources\nDesigning for high availability with ExpressRoute - Active-active connections Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// Azure Resource Graph Query // Goal: Show any ExpressRoute circuit where one of the connections is not configured (i.e. no IP) Resources | where type =~ \u0026#39;Microsoft.Network/expressRouteCircuits\u0026#39; | where properties.value[0].provisioningState != \u0026#39;Succeeded\u0026#39; or properties.value[1].provisioningState != \u0026#39;Succeeded\u0026#39; | where not(properties.peerings[0].properties.primaryPeerAddressPrefix != \u0026#34;null\u0026#34; and properties.peerings[0].properties.secondaryPeerAddressPrefix != \u0026#34;null\u0026#34;) | project recommendationId = \u0026#34;erc-1\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;Peer1_IP: \u0026#34;,properties.peerings[0].properties.primaryPeerAddressPrefix), param2=strcat(\u0026#34;Peer2_IP: \u0026#34;, properties.peerings[0].properties.secondaryPeerAddressPrefix) | order by id asc ERC-4 - Ensure Bidirectional Forwarding Detection is enabled and configured on customer or provider edge routing devices Category: Availability\nImpact: High\nGuidance\nWhen you enable Bidirectional Forwarding Detection (BFD) over ExpressRoute, you can speed up the link failure detection between Microsoft Enterprise edge (MSEE) devices and the routers that your ExpressRoute circuit gets configured (CE/PE). You can configure ExpressRoute over your edge routing devices or your Partner Edge routing devices (if you went with managed Layer 3 connection service).\nResources\nConfigure BFD over ExpressRoute Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// cannot-be-validated-with-arg ERC-5 - Configure monitoring and alerting for ExpressRoute circuits Category: Monitoring\nImpact: Medium\nGuidance\nConfigure monitoring using Network Insights for ExpressRoute circuit availability, circuit QoS, and throughput. Configure alerts for availability metrics and circuit QoS metrics according to ExpressRoute Circuits | Azure Monitor Baseline Alerts, and throughput metrics when bits/sec exceed a threshold appropriate for the ExpressRoute circuit SKU and customer usage.\nConfigure alerts using Connection Monitor for ExpressRoute with a Log Analytics workspace, and Network Watcher. Configure alerts for when ChecksFailedPercent exceeds 5%, and when RoundTripTimeMs exceeds a pre-tested average appropriate to the environment.\nFor ExpressRoute Direct, configure Traffic Collection for ExpressRoute Direct to send flow logs to a Log Analytics workspace.\nResources\nAzure ExpressRoute Insights using Network Insights | Microsoft Learn Monitoring Azure ExpressRoute Configure Traffic Collector for ExpressRoute Direct - Azure ExpressRoute | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// under-development ERC-6 - Configure service health to receive ExpressRoute circuit maintenance notification Category: Monitoring\nImpact: Medium\nGuidance\nExpressRoute uses service health to notify about planned and unplanned maintenance. Configuring service health will notify you about changes made to your ExpressRoute circuits.\nResources\nHow to view and configure alerts for Azure ExpressRoute circuit maintenance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// under-development ERC-7 - Use a site-to-site VPN as an interim backup solution for a single ExpressRoute circuit Category: Disaster Recovery\nImpact: Medium\nGuidance\nIf you have not yet added a second ExpressRoute circuit for an ExpressRoute Gateway, use a site-to-site VPN as an interim solution until the second ExpressRoute circuit is available.\nResources\nUsing S2S VPN as a backup for ExpressRoute private peering Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/expressroute-connection/",
	"title": "ExpressRoute Connection",
	"tags": null,
	"description": "Best practices and resiliency recommendations for ExpressRoute Connection and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include ExpressRoute Connection and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ERCON-1 - For Connections using ExpressRoute Direct circuits and UltraPerformance or ErGw3AZ ExpressRoute Gateways, enable FastPath to improve data path performance between your on-premises network and your virtual network System Efficiency Medium Preview No ERCON-2 - Configure an Azure Resource Lock on connections to prevent accidental deletion Availability High Preview No Definitions of states can be found here Recommendations Details ERCON-1 - For Connections using ExpressRoute Direct circuits and UltraPerformance or ErGw3AZ ExpressRoute Gateways, enable FastPath to improve data path performance between your on-premises network and your virtual network Category: System Efficiency\nImpact: Medium\nRecommendation/Guidance\nExpressRoute virtual network gateway is designed to exchange network routes and route network traffic. FastPath is designed to improve the data path performance between your on-premises network and your virtual network. When enabled, FastPath sends network traffic directly to virtual machines in the virtual network, bypassing the gateway. Bypassing the gateway enhances resiliency by reducing its utilization of the gateway.\nResources\nAbout ExpressRoute FastPath Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERCON-2 - Configure an Azure Resource Lock on connections to prevent accidental deletion Category: Availability\nImpact: High\nRecommendation/Guidance\nConfigure an Azure Resource lock for Gateway Connection resources to prevent accidental deletion. Accidental deletion of a Gateway Connection resource may result in unexpected loss of connectivity between your on-premises network and Azure workloads. As an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental user deletions and modifications. The lock overrides any user permission.\nResources\nProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/expressroute-direct/",
	"title": "ExpressRoute Direct",
	"tags": null,
	"description": "Best practices and resiliency recommendations for ExpressRoute Direct and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include ExpressRoute Direct and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ERD-1 - The Admin State of both Links of an ExpressRoute Direct should be in Enabled state Availability High Preview No ERD-2 - Ensure you do not over-subscribe an ExpressRoute Direct System Efficiency High Preview No ERD-3 - Enable rate-limiting to help optimize network performance by controlling the traffic volume across all your ExpressRoute Direct based circuits - In Preview System Efficiency Medium Preview No Definitions of states can be found here Recommendations Details ERD-1 - The Admin State of both Links of an ExpressRoute Direct should be in Enabled state Category: Availability\nImpact: High\nRecommendation/Guidance\nIn Azure ExpressRoute Direct, the \u0026ldquo;Admin State\u0026rdquo; refers to the administrative status of the ExpressRoute layer 1 links. It essentially indicates whether a particular link is enabled or disabled, in other words the physical port is on or off; and is required to pass traffic across the ExpressRoute Direct connection. Admin State is a crucial setting because it determines the operational status of your ExpressRoute Direct, affecting connectivity between your on-premises network and Azure services.\nResources\nHow to configure ExpressRoute Direct: Change Admin State of links Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERD-2 - Ensure you do not over-subscribe an ExpressRoute Direct Category: System Efficiency\nImpact: High\nRecommendation/Guidance\nYou can provision logical ExpressRoute circuits on top of your selected ExpressRoute Direct resource of 10-Gbps or 100-Gbps up to the subscribed Bandwidth of 20-Gbps or 200-Gbps. From a resiliency perspective this is not recommended. If one of the ExpressRoute Direct ports goes down, and your ExpressRoute circuits are already consuming 100% of the 10-Gbps or 100-Gbps, the second ExpressRoute Direct port wouldn‚Äôt have bandwidth enough to support any additional load. One reason a port may be down would be during a maintenance event. The remaining port would support all traffic during the maintenance event, up to the 10-Gbps or 100-Gbps capacity. Unless you use rate limiting for ExpressRoute Direct circuits (Preview) to limit the bandwidth of non-production connections, you should not over-subscribe your ExpressRoute Direct ports being used for production workloads.\nResources\nAbout ExpressRoute Direct: Circuit Sizes Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERD-3 - Enable rate-limiting to help optimize network performance by controlling the traffic volume across all your ExpressRoute Direct based Circuits - In Preview Category: System Efficiency\nImpact: Medium\nRecommendation/Guidance\nRate limiting is a feature that enables you to control the traffic volume between your on-premises network and Azure over an ExpressRoute Direct circuit. It applies to the traffic over either private or Microsoft peering of the ExpressRoute circuit. This feature helps distribute the port bandwidth evenly among the circuits, ensures network stability, and prevents network congestion. This document outlines the steps to enable rate limiting for your ExpressRoute Direct circuits.\nResources\nRate limiting for ExpressRoute Direct circuits (Preview) Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/expressroute-gateway/",
	"title": "ExpressRoute Gateway",
	"tags": null,
	"description": "Best practices and resiliency recommendations for ExpressRoute Gateway and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include ExpressRoute Gateway and associated ExpressRoute Gateway settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ERGW-1 - Connect the ExpressRoute Gateway to two or more circuits from different peering locations for higher resiliency Availability High Preview No ERGW-2 - Use Zone-redundant gateway SKUs Availability High Preview Yes ERGW-3 - Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Availability Medium Preview No ERGW-4 - Monitor gateway health Monitoring High Preview No ERGW-5 - Configure diagnostic logs and alerts for ExpressRoute virtual network gateway Monitoring High Preview No ERGW-6 - Avoid using ExpressRoute circuits for VNet to VNet communication Networking Medium Preview No ERGW-7 - Configure customer-controlled gateway maintenance - In Preview Networking High Preview No Definitions of states can be found here Recommendations Details ERGW-1 - Connect the ExpressRoute Gateway to two or more circuits from different peering locations for higher resiliency Category: Availability\nImpact: High\nGuidance\nConnect each ExpressRoute Gateway to a minimum of two circuits, with each circuit connecting from a diverse peering location compared to the other.\nResources\nDesigning for disaster recovery with ExpressRoute private peering Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERGW-2 - Use Zone-redundant gateway SKUs Category: Availability\nImpact: High\nGuidance\nAzure ExpressRoute gateway provides different SLAs when it‚Äôs deployed in a single availability zone and when it‚Äôs deployed in two or more availability zones. For information about all Azure SLAs, see Service Level Agreements (SLA) for Online Services. To automatically deploy your virtual network gateways across availability zones, you can use zone-redundant virtual network gateways. With zone-redundant gateways, you can benefit from zone-resiliency to access your mission-critical, scalable services on Azure\nResources\nAbout ExpressRoute virtual network gateways - Zone-redundant gateway SKUs About zone-redundant virtual network gateway in Azure availability zones Create a zone-redundant virtual network gateway in Azure Availability Zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy Ôªø// Azure Resource Graph Query // For all VNGs of type ExpressRoute, show any that do not have AZ in the SKU tier resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.gatewayType == \u0026#34;ExpressRoute\u0026#34; | where properties.sku.tier !contains \u0026#39;AZ\u0026#39; | project recommendationId = \u0026#34;ergw-1\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location | order by id asc ERGW-3 - Configure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion Category: Availability\nImpact: Medium\nGuidance\nConfigure an Azure Resource lock for ExpressRoute Gateway to prevent accidental deletion. As an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental user deletions and modifications. The lock overrides any user permission.\nResources\nProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERGW-4 - Monitor gateway health Category: Monitoring\nImpact: High\nGuidance\nSetup monitoring using Network Insights for ExpressRoute Gateway availability, performance, and scalability.\nConfigure alerts for availability metrics for routes advertised, routes learned and number of VMs based on the supported amounts for the ExpressRoute Gateway SKU in use. Configure alerts for frequency of routes changed based on the customer environment.\nConfigure alerts for performance metrics for bits in, bits out and CPU utilization according to ExpressRoute Gateways | Azure Monitor Baseline Alerts. Configure alerts for packets per second based on the supported amount for the ExpressRoute Gateway SKU in use and based on the customer environment.\nConfigure alerts for scalability metrics for active flows based on the supported amounts for the ExpressRoute Gateway SKU in use and the expected number of flows for the customer environment, and for max flows per second for when this value exceeds a historical baseline for the customer environment.\nResources\nExpressRoute monitoring, metrics, and alerts | ExpressRoute gateways Azure ExpressRoute Insights using Network Insights Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERGW-5 - Configure diagnostic logs and alerts for ExpressRoute virtual network gateway Category: Monitoring\nImpact: High\nGuidance\nEnabling diagnostic logs allows you to capture and view diagnostic information so that you can troubleshoot any failures for ExpressRoute virtual network gateway.\nConfigure logging for GatewayDiagnosticLog and RouteDiagnosticLog. Create alerts based on the GatewayDiagnosticLog for gateway configuration events, primary changes, and maintenance events. Create alerts based on the RouteDiagnosticLog for changes to static routes and BGP events.\nResources\nTroubleshooting Azure VPN Gateway using diagnostic logs | Microsoft Learn Configure alerts on diagnostic resource log events - Azure VPN Gateway | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERGW-6 - Avoid using ExpressRoute circuits for VNet to VNet communication Category: Networking\nImpact: Medium\nGuidance\nBy default, connectivity between virtual networks is enabled when you link multiple virtual networks, each with an ExpressRoute Gateway, to the same ExpressRoute circuit. However, Microsoft advises against using your ExpressRoute circuit for communication between virtual networks and instead use other techniques such as VNet peering, routing in a VNet hub via Azure Firewall, NVA and/or Azure Route Server, site-to-site VPN within Azure, the use of virtual WAN, or the use of SD-WAN.\nFor more information about why VNet-to-VNet connectivity isn‚Äôt recommended over ExpressRoute, see: Connectivity between virtual networks over ExpressRoute | Microsoft Learn\nResources\nAbout ExpressRoute virtual network gateways - VNet-to-VNet connectivity Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ERGW-7 - Configure customer-controlled gateway maintenance - In Preview Category: Availability\nImpact: High\nGuidance\nExpressRoute virtual network gateways undergo regular updates to enhance functionality, reliability, performance, and security. Configuring and scheduling customer-controlled maintenance will minimize the impact of these updates and align the update schedule to best fit your maintenance windows.\nResources\nConfigure customer-controlled maintenance for your virtual network gateway - ExpressRoute | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/expressroute-traffic-collector/",
	"title": "ExpressRoute Traffic Collector",
	"tags": null,
	"description": "Best practices and resiliency recommendations for ExpressRoute Traffic Collector and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include ExpressRoute Traffic Collector and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ERTC-1 - Ensure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits Monitoring Medium Preview No Definitions of states can be found here Recommendations Details ERTC-1 - Ensure ExpressRoute Traffic Collector is enabled and configured for ExpressRoute Direct circuits Category: Monitoring\nImpact: Medium\nRecommendation/Guidance\nExpressRoute Traffic Collector enables sampling of network flows sent over your ExpressRoute Direct circuits. Flow logs get sent to a Log Analytics workspace where you can create your own log queries for further analysis. You can also export the data to any visualization tool or SIEM (Security Information and Event Management) of your choice. Flow logs can be enabled for both private peering and Microsoft peering with ExpressRoute Traffic Collector.\nYou can associate a single ExpressRoute Direct circuit with multiple ExpressRoute Traffic Collectors deployed in different Azure region within a given geo-political region. It\u0026rsquo;s recommended that you associate your ExpressRoute Direct circuit with multiple ExpressRoute Traffic Collectors as part of your disaster recovery and high availability plan.\nResources\nAzure ExpressRoute Traffic Collector Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/firewall/",
	"title": "Firewall",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Firewall and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Firewall and associated Firewall settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available AFW-1 - Deploy Azure Firewall across multiple availability zones Availability High Preview Yes AFW-2 - Monitor Azure Firewall metrics Monitoring Medium Preview Yes AFW-3 - Configure DDoS Protection on the Azure Firewall VNet Access \u0026amp; Security High Preview Yes AFW-4 - Leverage Azure Policy inheritance model Governance Medium Preview No Definitions of states can be found here Recommendations Details AFW-1 - Deploy Azure Firewall across multiple availability zones Category: Availability\nImpact: High\nGuidance\nAzure Firewall provides different SLAs when it\u0026rsquo;s deployed in a single availability zone and when it\u0026rsquo;s deployed in two or more availability zones.\nResources\nAzure Well Architected Framework - Azure Firewall Deploy Azure Firewall across multiple availability zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // List all Azure Firewalls that are not configured with multiple availability zones or deployed without a zone resources | where type == \u0026#39;microsoft.network/azurefirewalls\u0026#39; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;afw-1\u0026#34;, name, id, tags, param1=\u0026#34;multipleZones:false\u0026#34; AFW-2 - Monitor Azure Firewall metrics Category: Monitoring\nImpact: Medium\nGuidance\nMonitor metrics related to availability and performance issues. More specifically:\nFirewallHealth: Indicates the overall health of the firewall. Throughput: Throughput processed by the firewall. An alert should be triggered if throughput gets close to the documented limits. SNATPortUtilization: Percentage of outbound SNAT ports currently in use. An alert should be triggered if this metric gets close to 100% (at which point Source-NATted connections, such as outbound internet connections will start to fail). If you\u0026rsquo;ll need more than 512,000 SNAT ports, deploying a NAT gateway with Azure Firewall can be considered. However, deploying NAT gateway with a zone redundant firewall is not recommended deployment option, as the NAT gateway does not support zonal deployment at this time. In order to use NAT gateway with Azure Firewall, a zonal Firewall deployment is required. In addition, Azure Virtual Network NAT integration is not currently supported in secured virtual hub network architectures. Resources\nAzure Firewall metrics supported in Azure Monitor Azure Firewall performance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // List all Azure Firewalls resources in-scope, along with any metrics associated to Azure Monitor alert rules, that are not fully configured. resources | where type == \u0026#34;microsoft.network/azurefirewalls\u0026#34; | project firewallId = tolower(id), name, tags | join kind = leftouter ( resources | where type == \u0026#34;microsoft.insights/metricalerts\u0026#34; | mv-expand properties.scopes | mv-expand properties.criteria.allOf | where properties_scopes contains \u0026#34;azureFirewalls\u0026#34; | project metricId = tolower(properties_scopes), monitoredMetric = properties_criteria_allOf.metricName, tags | summarize monitoredMetrics = make_list(monitoredMetric) by tostring(metricId) | project metricId, monitoredMetrics, allAlertsConfigured = monitoredMetrics contains(\u0026#34;FirewallHealth\u0026#34;) and monitoredMetrics contains (\u0026#34;Throughput\u0026#34;) and monitoredMetrics contains (\u0026#34;SNATPortUtilization\u0026#34;) ) on $left.firewallId == $right.metricId | extend alertsNotFullyConfigured = isnull(allAlertsConfigured) or not(allAlertsConfigured) | where alertsNotFullyConfigured | project recommendationId = \u0026#34;afw-3\u0026#34;, name, id = firewallId, tags, param1 = strcat(\u0026#34;MetricsAlerts:\u0026#34;, monitoredMetrics) AFW-3 - Configure DDoS Protection on the Azure Firewall VNet Category: Access \u0026amp; Security\nImpact: High\nGuidance\nAssociate a DDoS protection plan with the virtual network hosting Azure Firewall. A DDoS protection plan provides enhanced mitigation features to defend your firewall from DDoS attacks. Azure Firewall Manager is an integrated tool to create your firewall infrastructure and DDoS protection plans.\nResources\nAzure DDoS Protection overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // List all in-scope Azure Firewall resources, where the VNet is not associated to a DDoS Protection Plan resources | where type == \u0026#34;microsoft.network/azurefirewalls\u0026#34; | mv-expand properties.ipConfigurations | project name, firewallId = id, vNet = substring(properties_ipConfigurations.properties.subnet.id, 0, indexof(properties_ipConfigurations.properties.subnet, \u0026#34;/subnet\u0026#34;) - 7), tags | join kind=fullouter ( resources | where type == \u0026#34;microsoft.network/ddosprotectionplans\u0026#34; | mv-expand properties.virtualNetworks | extend vNet = tostring(properties_virtualNetworks.id) | project ddosProtectionPlan = id, vNet ) on $left.vNet == $right.vNet | where ddosProtectionPlan == \u0026#39;\u0026#39; | project recommendationId = \u0026#34;afw-5\u0026#34;, name, id = firewallId, tags, param1 = \u0026#34;ddosProtectionPlan:false\u0026#34; AFW-4 - Leverage Azure Policy inheritance model Category: Governance\nImpact: Medium\nGuidance\nAzure Firewall policy allows you to define a rule hierarchy and enforce compliance. It provides a hierarchical structure to overlay a central base policy on top of a child application team policy. The base policy has a higher priority and runs before the child policy. Use an Azure custom role definition to prevent inadvertent base policy removal and provide selective access to rule collection groups within a subscription or resource group.\nResources\nAzure Firewall Policy hierarchy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/front-door/",
	"title": "Front Door",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Front Door and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Front Door and associated Front Door settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Front Door and associated resources.\nRecommendation Category Impact State ARG Query Available AFD-1 - Avoid combining Traffic Manager and Front Door Networking High Preview No AFD-2 - Restrict traffic to your origins Access \u0026amp; Security High Preview No AFD-3 - Use the latest API version and SDK version Networking Medium Preview No AFD-4 - Configure logs Monitoring Medium Preview No AFD-5 - Use end-to-end TLS Security High Preview No AFD-6 - Use HTTP to HTTPS redirection Access \u0026amp; Security High Preview No AFD-7 - Use managed TLS certificates Access \u0026amp; Security Medium Preview No AFD-8 - Use latest version for customer-managed certificates Access \u0026amp; Security Medium Preview No AFD-9 - Use the same domain name on Front Door and your origin Networking Medium Preview No AFD-10 - Enable the WAF Access \u0026amp; Security Medium Preview No AFD-11 - Disable health probes when there is only one origin in an origin group Availability Low Preview No AFD-12 - Select good health probe endpoints Availability Medium Preview No AFD-13 - Use HEAD health probes System Efficiency Medium Preview No AFD-14 - Use geo-filtering in Azure Front Door Access \u0026amp; Security Medium Preview No AFD-15 - Secure your Origin with Private Link in Azure Front Door Access \u0026amp; Security Medium Preview No Definitions of states can be found here Recommendations Details AFD-1 - Avoid combining Traffic Manager and Front Door Category: Networking\nImpact: High\nGuidance\nFor most solutions, you should use either Front Door or Azure Traffic Manager, but not both. Traffic Manager is a DNS-based load balancer. It sends traffic directly to your origin\u0026rsquo;s endpoints. In contrast, Front Door terminates connections at points of presence (PoPs) near to the client and establishes separate long-lived connections to the origins. The products work differently and are intended for different use cases.\nIf you need content caching and delivery (CDN), TLS termination, advanced routing capabilities, or a web application firewall (WAF), consider using Front Door. For simple global load balancing with direct connections from your client to your endpoints, consider using Traffic Manager.\nHowever, as part of a complex architecture, you might choose to use Traffic Manager in front of Front Door. In the unlikely event that Front Door is unavailable, Traffic Manager can route traffic to an alternative destination, such as Azure Application Gateway or a partner content delivery network (CDN). These architectures are difficult to implement and most customers don\u0026rsquo;t need them.\nResources\nAzure Load Balancing Options Azure Traffic Manager Azure Front Door Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-2 - Restrict traffic to your origins Category: Access \u0026amp; Security\nImpact: High\nGuidance\nFront Door\u0026rsquo;s features work best when traffic only flows through Front Door. You should configure your origin to block traffic that hasn\u0026rsquo;t been sent through Front Door.\nResources\nSecure traffic to Azure Front Door origins Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-3 - Use the latest API version and SDK version Category: Networking\nImpact: Medium\nGuidance\nWhen you work with Front Door by using APIs, ARM templates, Bicep, or Azure SDKs, it\u0026rsquo;s important to use the latest available API or SDK version. API and SDK updates occur when new functionality is available, and also contain important security patches and bug fixes.\nResources\nREST API Reference Client library for Java SDK for Python Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-4 - Configure logs Category: Monitoring\nImpact: Medium\nGuidance\nFront Door tracks extensive telemetry about every request. When you enable caching, your origin servers might not receive every request, so it\u0026rsquo;s important that you use the Front Door logs to understand how your solution is running and responding to your clients.\nResources\nMonitor metrics and logs in Azure Front Door WAF logs Configure Azure Front Door logs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-5 - Use end-to-end TLS Category: Security\nImpact: High\nGuidance\nFront Door terminates TCP and TLS connections from clients. It then establishes new connections from each point of presence (PoP) to the origin. It\u0026rsquo;s a good practice to secure each of these connections with TLS, even for origins that are hosted in Azure. This approach ensures that your data is always encrypted during transit.\nResources\nEnd-to-end TLS with Azure Front Door Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-6 - Use HTTP to HTTPS redirection Category: Access \u0026amp; Security\nImpact: High\nGuidance\nIt\u0026rsquo;s a good practice for clients to use HTTPS to connect to your service. However, sometimes you need to accept HTTP requests to allow for older clients or clients who might not understand the best practice.\nYou can configure Front Door to automatically redirect HTTP requests to use the HTTPS protocol. You should enable the Redirect all traffic to use HTTPS setting on your route.\nResources\nCreate HTTP to HTTPS redirect rule Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-7 - Use managed TLS certificates Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nWhen Front Door manages your TLS certificates, it reduces your operational costs, and helps you to avoid costly outages caused by forgetting to renew a certificate. Front Door automatically issues and rotates the managed TLS certificates.\nResources\nConfigure HTTPS on an Azure Front Door custom domain using the Azure portal Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-8 - Use latest version for customer-managed certificates Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nIf you decide to use your own TLS certificates, then consider setting the Key Vault certificate version to \u0026lsquo;Latest\u0026rsquo;. By using \u0026lsquo;Latest\u0026rsquo;, you avoid having to reconfigure Front Door to use new versions of your certificate and waiting for the certificate to be deployed throughout Front Door\u0026rsquo;s environments.\nResources\nSelect the certificate for Azure Front Door to deploy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-9 - Use the same domain name on Front Door and your origin Category: Networking\nImpact: Medium\nGuidance\nFront Door can rewrite the Host header of incoming requests. This feature can be helpful when you manage a set of customer-facing custom domain names that route to a single origin. This feature can also help when you want to avoid configuring custom domain names in Front Door and at your origin. However, when you rewrite the Host header, request cookies and URL redirections might break. In particular, when you use platforms like Azure App Service, features like session affinity and authentication and authorization might not work correctly.\nBefore you rewrite the Host header of your requests, carefully consider whether your application is going to work correctly.\nResources\nPreserve the original HTTP host name between a reverse proxy and its back-end web application Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-10 - Enable the WAF Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nFor internet-facing applications, we recommend you enable the Front Door web application firewall (WAF) and configure it to use managed rules. When you use a WAF and Microsoft-managed rules, your application is protected from a wide range of attacks.\nResources\nhttps://learn.microsoft.com/azure/frontdoor/web-application-firewall Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-11 - Disable health probes when there is only one origin in an origin group Category: Availability\nImpact: Low\nGuidance\nFront Door\u0026rsquo;s health probes are designed to detect situations where an origin is unavailable or unhealthy. When a health probe detects a problem with an origin, Front Door can be configured to send traffic to another origin in the origin group.\nIf you only have a single origin, Front Door always routes traffic to that origin even if its health probe reports an unhealthy status. The status of the health probe doesn\u0026rsquo;t do anything to change Front Door\u0026rsquo;s behavior. In this scenario, health probes don\u0026rsquo;t provide a benefit and you should disable them to reduce the traffic on your origin.\nResources\nHealth probes Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-12 - Select good health probe endpoints Category: Availability\nImpact: Medium\nGuidance\nConsider the location where you tell Front Door\u0026rsquo;s health probe to monitor. It\u0026rsquo;s usually a good idea to monitor a webpage or location that you specifically design for health monitoring. Your application logic can consider the status of all of the critical components required to serve production traffic including application servers, databases, and caches. That way, if any component fails, Front Door can route your traffic to another instance of your service\nResources\nHealth Endpoint Monitoring pattern Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-13 - Use HEAD health probes Category: System Efficiency\nImpact: Medium\nGuidance\nHealth probes can use either the GET or HEAD HTTP method. It\u0026rsquo;s a good practice to use the HEAD method for health probes, which reduces the amount of traffic load on your origins.\nResources\nSupported HTTP methods for health probes Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-14 - Use geo-filtering in Azure Front Door Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nBy default, Azure Front Door will respond to all user requests regardless of the location where the request is coming from. In some scenarios, you may want to restrict the access to your web application by countries/regions. The Web application firewall (WAF) service in Front Door enables you to define a policy using custom access rules for a specific path on your endpoint to either allow or block access from specified countries/regions.\nA WAF policy contains a set of custom rules. The rule consists of match conditions, an action, and a priority. In a match condition, you define a match variable, operator, and match value. For a geo filtering rule, a match variable is either RemoteAddr or SocketAddr. RemoteAddr is the original client IP that is usually sent via X-Forwarded-For request header. SocketAddr is the source IP address WAF sees. If your user is behind a proxy, SocketAddr is often the proxy server address. The operator in the case of this geo filtering rule is GeoMatch, and the value is a two letter country/region code of interest. \u0026ldquo;ZZ\u0026rdquo; country code or \u0026ldquo;Unknown\u0026rdquo; country captures IP addresses that are not yet mapped to a country in our dataset. You may add ZZ to your match condition to avoid false positives. You can combine a GeoMatch condition and a REQUEST_URI string match condition to create a path-based geo-filtering rule.\nResources\nGeo filter WAF policy - GeoMatch Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development AFD-15 - Secure your Origin with Private Link in Azure Front Door Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nAzure Private Link enables you to access Azure PaaS services and services hosted in Azure over a private endpoint in your virtual network. Traffic between your virtual network and the service goes over the Microsoft backbone network, eliminating exposure to the public Internet.\nAzure Front Door Premium can connect to your origin using Private Link. Your origin can be hosted in a virtual network or hosted as a PaaS service such as Azure App Service or Azure Storage. Private Link removes the need for your origin to be accessed publicly.\nResources\nPrivate link for Azure Front Door Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/image-templates/",
	"title": "Image Templates",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Image Templates and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Image Templates and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available IT-1 - Use Generation 2 virtual machine source image Availability Low Preview No IT-2 - Replicate your Image Templates to a secondary region Disaster Recovery Low Preview Yes Definitions of states can be found here Recommendations Details IT-1 - Use Generation 2 virtual machine source image Category: Availability\nImpact: Low\nGuidance\nWhen building your Image Templates, utilize source images that support generation 2 virtual machines. Generation 2 VMs support key features that aren\u0026rsquo;t supported in generation 1 VMs.These features include increased memory, support for larger \u0026gt;2TB disks, it uses the new UEFI-based boot architecture rather than the BIOS-based architecture used by generation 1 VMs which can improve boot and installation times, Intel Software Guard Extensions (Intel SGX), and virtualized persistent memory (vPMEM).\nResources\nGeneration 1 vs generation 2 virtual machines IT-2 - Replicate your Image Templates to a secondary region Category: Disaster Recovery\nImpact: Low\nGuidance\nThe Azure Image Builder service that is used to deploy Image Templates doesn\u0026rsquo;t currently support availability zones. Therefore, when building your Image Templates, replicate them to a secondary region, preferably to your primary region\u0026rsquo;s paired region. This will allow you to quickly recover from a region failure and continue to deploy virtual machines from your Image Templates.\nResources\nImage Template resiliency Azure Image Builder Supported Regions Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // List all Image Templates that are not replicated to another region resources | where type =~ \u0026#34;microsoft.virtualmachineimages/imagetemplates\u0026#34; | mv-expand distribution=properties.distribute | where array_length(parse_json(distribution).replicationRegions) == 1 | project recommendationId = \u0026#34;it-2\u0026#34;, name, id, param1=strcat(\u0026#34;replicationRegions:\u0026#34;,parse_json(distribution).replicationRegions) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/iot/iot-hub/",
	"title": "IoT Hub",
	"tags": null,
	"description": "Best practices and resiliency recommendations for IoT Hub and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include IoT Hub and associated resources and settings. General guidance are available in the Well-Architected Framework for IoT Reliability in your IoT workload.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available IOTH-1 - Device Identities are exported to a secondary region Disaster Recovery High Preview No IOTH-2 - Do not use free tier Availability High Preview Yes IOTH-3 - Use Availability Zones Availability High Preview No IOTH-4 - Use Device Provisioning Service Scalability Critical Preview Yes IOTH-5 - Define Failover Guidelines Availability High Preview No IOTH-6 - Disabled Fallback Route Monitoring Low Preview Yes Definitions of states can be found here Recommendations Details IOTH-1 - Device Identities are exported to a secondary region Category: Disaster Recovery\nImpact: High\nRecommendation\nDevice Identities should be copied to the failover region IoT-Hub for all IoT devices to be able to connect in case of a failover to another IoT Hub.\nManual Failover of IoT Hub to another region is faster (RTO) and can be used for mission critical workload.\nResources\nImport and export IoT Hub device identities in bulk IoT Hub high availability and disaster recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg IOTH-2 - Do not use free tier Category: Availability\nImpact: High\nRecommendation\nIn a production scenario the IoT Hub tier should not be Free, as the Free tier does not offer the necessary SLA.\nResources\nChoose the right IoT Hub tier and size for your solution Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // list all IoT Hubs that are using the Free tier resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; and tostring(sku.tier) =~ \u0026#39;Free\u0026#39; | project recommendationId=\u0026#34;ioth-2\u0026#34;, name, id, tags, param1=strcat(\u0026#34;tier:\u0026#34;, tostring(sku.tier)) IOTH-3 - Use Availability Zones Category: Availability\nImpact: High\nRecommendation\nIn a region that supports Availability Zones for IoT Hub, these Zones should be used to increase availability. Availability Zones are automatically activated for new IoT Hubs in the supported regions.\nResources\nAzure IoT Hub high availability and disaster recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg IOTH-4 - Use Device Provisioning Service Category: System Efficiency\nImpact: High\nRecommendation\nDevice Provisioning Service (DPS) can redistribute IoT devices easily for scaling and availability. Devices will not be bound to specific IoT Hub instances, but can be reassigned with rules.\nEven IoT Hubs that are associated to a Device Provisioning Service need to be checked if their devices use it.\nResources\nIoT Hub Device Provisioning Service (DPS) terminology Best practices for large-scale IoT device deployments IoT Hub Device Provisioning Service high availability and disaster recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // list all IoT Hubs that do not have a linked IoT Hub Device Provisioning Service (DPS) resources | where type =~ \u0026#34;microsoft.devices/iothubs\u0026#34; | project id, iotHubName=tostring(properties.hostName), tags, resourceGroup | join kind=fullouter ( resources | where type == \u0026#34;microsoft.devices/provisioningservices\u0026#34; | mv-expand iotHubs=properties.iotHubs | project iotHubName = tostring(iotHubs.name), dpsName = name, name=iotHubs.name ) on iotHubName | where dpsName == \u0026#39;\u0026#39; | project recommendationId=\u0026#34;ioth-4\u0026#34;, name=iotHubName, id, tags, param1=\u0026#39;DPS:none\u0026#39; IOTH-5 - Define Failover Guidelines Category: Availability\nImpact: High\nRecommendation\nIn case of a regional failure, an IoT Hub can failover to a second region. This failover can be initiated automatically or manually. In both cases certain requirements are necessary for you application to continue working. Review the guidance for a failover\ncheck if the RTO is matched in case of an automatic failover no IP addresses are used by devices to connect to an IoT Hub Resources\nIoT Hub high availability and disaster recovery Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg IOTH-6 - Disabled Fallback Route Category: Monitoring\nImpact: Low\nRecommendation\nIf message routing is used to route messages to custom endpoints, it can happen that messages are not delivered to the custom routes, if the conditions are not meat. A default route will always receive all messages. Disabling it could potentially leave messages undelivered.\nResources\nUse message routing - Fallback route Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // list all IoT Hubs that have the fallback route disabled resources | where type == \u0026#34;microsoft.devices/iothubs\u0026#34; | extend fallbackEnabled=properties.routing.fallbackRoute.isEnabled | where fallbackEnabled == false | project recommendationId=\u0026#34;ioth-6\u0026#34;, name, id, tags, param1=\u0026#39;FallbackRouteEnabled:false\u0026#39; "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/security/key-vault/",
	"title": "Key Vault",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Key Vault and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Key Vault and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available KV-1 - Key vaults should have soft delete enabled Disaster Recovery High Preview Yes KV-2 - Key vaults should have purge protection enabled Disaster Recovery High Preview Yes KV-3 - Enable Azure Private Link Service for Key vault Networking High Preview No KV-4 - Use separate key vaults per application per environment Governance High Preview No KV-5 - Diagnostic logs in Key Vault should be enabled Monitoring Low Preview No Definitions of states can be found here Recommendations Details KV-1 - Key vaults should have soft delete enabled Category: Disaster Recovery\nImpact: High\nGuidance\nKey Vault\u0026rsquo;s soft-delete feature allows recovery of the deleted vaults and deleted key vault objects (for example, keys, secrets, certificates), known as soft-delete.When soft-delete is enabled, resources marked as deleted resources are retained for a specified period (90 days by default). The service further provides a mechanism for recovering the deleted object, essentially undoing the deletion\nResources\nAzure Key Vault soft-delete overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This Resource Graph query will return all Key Vaults that do not have soft delete enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enableSoftDelete) or properties.enableSoftDelete != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;kv-1\u0026#34;, name, id, tags, param1 = \u0026#34;EnableSoftDelete: Disabled\u0026#34; KV-2 - Key vaults should have purge protection enabled Category: Disaster Recovery\nImpact: High\nGuidance\nMalicious deletion of a key vault can lead to permanent data loss. A malicious insider in your organization can potentially delete and purge key vaults. Purge protection protects you from insider attacks by enforcing a mandatory retention period for soft deleted key vaults. No one inside your organization or Microsoft will be able to purge your key vaults during the soft delete retention period.\nResources\nAzure Key Vault purge-protection overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This resource graph query will return all Key Vaults that do not have Purge Protection enabled. resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.enablePurgeProtection) or properties.enablePurgeProtection != \u0026#34;true\u0026#34; | project recommendationId = \u0026#34;kv-2\u0026#34;, name, id, tags, param1 = \u0026#34;EnablePurgeProtection: Disabled\u0026#34; KV-3 - Enable Azure Private Link Service for Key vault Category: Networking\nImpact: High\nGuidance\nAzure Private Link Service enables you to access Azure Key Vault and Azure hosted customer/partner services over a Private Endpoint in your virtual network. An Azure Private Endpoint is a network interface that connects you privately and securely to a service powered by Azure Private Link. The private endpoint uses a private IP address from your VNet, effectively bringing the service into your VNet. All traffic to the service can be routed through the private endpoint, so no gateways, NAT devices, ExpressRoute or VPN connections, or public IP addresses are needed. Traffic between your virtual network and the service traverses over the Microsoft backbone network, eliminating exposure from the public Internet. You can connect to an instance of an Azure resource, giving you the highest level of granularity in access control.\nResources\nAzure Key Vault Private Link Service overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This resource graph query will return all Key Vaults that does not have a Private Endpoint Connection or where a private endpoint exists but public access is enabled resources | where type == \u0026#34;microsoft.keyvault/vaults\u0026#34; | where isnull(properties.privateEndpointConnections) or properties.privateEndpointConnections[0].properties.provisioningState != (\u0026#34;Succeeded\u0026#34;) or (isnull(properties.networkAcls) and properties.publicNetworkAccess == \u0026#39;Enabled\u0026#39;) | extend param1 = strcat(\u0026#39;Private Endpoint: \u0026#39;, iif(isnotnull(properties.privateEndpointConnections),split(properties.privateEndpointConnections[0].properties.privateEndpoint.id,\u0026#39;/\u0026#39;)[8],\u0026#39;No Private Endpoint\u0026#39;)) | extend param2 = strcat(\u0026#39;Access: \u0026#39;, iif(properties.publicNetworkAccess == \u0026#39;Disabled\u0026#39;, \u0026#39;Public Access Disabled\u0026#39;, iif(isnotnull(properties.networkAcls), \u0026#39;NetworkACLs in place\u0026#39;,\u0026#39;Public Access Enabled\u0026#39;))) | project recommendationID = \u0026#34;kv-3\u0026#34;, name, id, tags, param1, param2 KV-4 - Use separate key vaults per application per environment Category: Governance\nImpact: High\nGuidance\nKey vaults define security boundaries for stored secrets. Grouping secrets into the same vault increases the¬†blast radius¬†of a security event because attacks might be able to access secrets across concerns. To mitigate access across concerns, consider what secrets a specific application¬†should¬†have access to, and then separate your key vaults based on this delineation. Separating key vaults by application is the most common boundary. Security boundaries, however, can be more granular for large applications, for example, per group of related services.\nResources\nAzure Key Vault best practices overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development KV-5 - Diagnostic logs in Key Vault should be enabled Category: Monitoring\nImpact: Low\nGuidance\nEnable logs , set up alerts and retain them as per the retention requirement. This enables you to monitor how and when your key vaults are accessed, and by whom.\nResources\nAzure Key Vault logging overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/load-balancer/",
	"title": "Load Balancer",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Load Balancer and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Load Balancer and associated Load Balancer settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Load Balancer and associated resources.\nRecommendation Category Impact State ARG Query Available LB-1 - Use Standard Load Balancer SKU Availability High Preview Yes LB-2 - Ensure the Backend Pool contains at least two instances Availability High Preview Yes LB-3 - Use NAT Gateway instead of Outbound Rules for Production Workloads Availability Medium Preview Yes LB-4 - Ensure Standard Load Balancer is zone-redundant Availability High Preview Yes Definitions of states can be found here Recommendations Details LB-1 - Use Standard Load Balancer SKU Category: Availability\nImpact: High\nGuidance\nSelect Standard SKU Standard Load Balancer provides a dimension of reliability that Basic does not - that of availability zones and zone resiliency. This means when a zone goes down, your zone-redundant Standard Load Balancer will not be impacted. This ensures your deployments can withstand zone failures within a region. In addition, Standard Load Balancer supports global load balancing ensuring your application is not impacted by region failures either. Basic load balancers don\u0026rsquo;t have a Service Level Agreement (SLA).\nResources\nReliability and Azure Load Balancer Resiliency checklist for specific Azure services- Azure Load Balancer Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all LoadBalancers using Basic SKU resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | where sku.name == \u0026#39;Basic\u0026#39; | project recommendationId = \u0026#34;lb-1\u0026#34;, name, id, tags, Param1=strcat(\u0026#34;sku-tier: basic\u0026#34;) LB-2 - Ensure the Backend Pool contains at least two instances Category: Availability\nImpact: High\nGuidance\nDeploy Azure LB with at least two instances in the backend. A single instance could result in a single point of failure. In order to build for scale, you might want to pair LB with Virtual Machine Scale Sets.\nResources\nResiliency checklist for specific Azure services- Azure Load Balancer Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all LoadBalancers which only have 1 backend pool defined or only 1 VM in the backend pool resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend bep = properties.backendAddressPools | extend BackEndPools = array_length(bep) | where BackEndPools == 0 | project recommendationId = \u0026#34;lb-2\u0026#34;, name, id, Param1=BackEndPools, Param2=0, tags | union (resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend bep = properties.backendAddressPools | extend BackEndPools = array_length(bep) | mv-expand bip = properties.backendAddressPools | extend BackendAddresses = array_length(bip.properties.loadBalancerBackendAddresses) | where BackendAddresses \u0026lt;= 1 | project recommendationId = \u0026#34;lb-2\u0026#34;, name, id, tags, Param1=BackEndPools, Param2=BackendAddresses) LB-3 - Use NAT Gateway instead of Outbound Rules for Production Workloads Category: Availability\nImpact: Medium\nGuidance\nOutbound rules for Standard Public Load Balancer requires you to manually allocate fixed amounts of ports to each of your backend pool instances. Because the SNAT port allocation is fixed, outbound rules does not provide the most scalable method for outbound connectivity. For production workloads, we recommend using NAT Gateway instead in order to prevent the risk of connection failures due to SNAT port exhaustion. NAT Gateway scales dynamically and provides secure connectivity to the internet.\nResources\nResiliency checklist for specific Azure services- Azure Load Balancer Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all LoadBalancers with Outbound rules configured resources | where type =~ \u0026#39;Microsoft.Network/loadBalancers\u0026#39; | extend outboundRules = array_length(properties.outboundRules) | where outboundRules \u0026gt; 0 | project recommendationId = \u0026#34;lb-3\u0026#34;, name, id, tags, Param1 = \u0026#34;outboundRules: \u0026gt;=1\u0026#34; LB-4 - Ensure Standard Load Balancer is zone-redundant Category: Availability\nImpact: High\nGuidance\nIn a region with Availability Zones, a Standard Load Balancer can be made zone-redundant by assigning it with a zone-redundant frontend IP address. With a zone-redundant frontend IP, the load balancer will continue to distribute traffic even when one availability zone fails, as long as there are other healthy zones and corresponding healthy backend instances in these zones that can receive traffic.\nResources\nLoad Balancer and Availability Zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all LoadBalancers with with regional or zonal public IP Addresses resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PrivateSubnetId = toupper(feIPconfigs.properties.subnet.id), PrivateIPZones = feIPconfigs.zones, PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PrivateSubnetId) | where isnull(PrivateIPZones) or array_length(PrivateIPZones) \u0026lt; 2 | project name, feConfigName, id | union (resources | where type == \u0026#34;microsoft.network/loadbalancers\u0026#34; | where tolower(sku.name) != \u0026#39;basic\u0026#39; | mv-expand feIPconfigs = properties.frontendIPConfigurations | extend feConfigName = (feIPconfigs.name), PIPid = toupper(feIPconfigs.properties.publicIPAddress.id), JoinID = toupper(id) | where isnotempty(PIPid) | join kind=innerunique ( resources | where type == \u0026#34;microsoft.network/publicipaddresses\u0026#34; | where isnull(zones) or array_length(zones) \u0026lt; 2 | extend LBid = toupper(substring(properties.ipConfiguration.id, 0, indexof(properties.ipConfiguration.id, \u0026#39;/frontendIPConfigurations\u0026#39;))), InnerID = toupper(id) ) on $left.PIPid == $right.InnerID) | project recommendationId = \u0026#34;lb-4\u0026#34;, name, id, tags, param1=\u0026#34;Zones: No Zone or Zonal\u0026#34;, param2=strcat(\u0026#34;Frontend IP Configuration:\u0026#34;, \u0026#34; \u0026#34;, feConfigName) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/monitoring/log-analytics/",
	"title": "Log Analytics",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Log Analytics and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Log Analytics and associated Log Analytics settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Log Analytics and associated resources.\nRecommendation Category Impact State ARG Query Available LOG-1 - Enable Log Analytics data export to GRS or GZRS Disaster Recovery Medium Preview No LOG-2 - Link Log Analytics Workspace to an Availability Zone enabled dedicated cluster Availability Medium Preview No LOG-3 - Configure data collection to send critical data to multiple workspaces in different regions Disaster Recovery Medium Preview No LOG-4 - Create a health status alert rule for your Log Analytics workspace Monitoring Low Preview No LOG-5 - Configure minimal logging and retention of logs Monitoring Low Preview No Definitions of states can be found here Recommendations Details LOG-1 - Enable Log Analytics data export to GRS or GZRS Category: Disaster Recovery\nImpact: Medium\nGuidance\nData export in a Log Analytics workspace lets you continuously export data to an Azure Storage account. Protect your Log Analytics workspace data from the unlikely event of a regional failure by continuously exporting to a geo-redundant storage (GRS) or geo-zone-redundant storage (GZRS) account.\nResources\nLog Analytics workspace data export in Azure Monitor Azure Monitor configuration recommendations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development LOG-2 - Link Log Analytics Workspace to an Availability Zone enabled dedicated cluster Category: Availability\nImpact: Medium\nGuidance\nLink your Log Analytics workspace to an availability zone enabled dedicated cluster to increase the resilience of Azure Monitor features that rely on your Log Analytics workspace and to protect your Log Analytics data against the unlikely event of a datacenter failure.\nResources\nEnhance data and service resilience in Azure Monitor Logs with availability zones Create and manage a dedicated cluster in Azure Monitor Logs Azure Monitor configuration recommendations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg LOG-3 - Configure data collection to send critical data to multiple workspaces in different regions Category: Disaster Recovery\nImpact: Medium\nGuidance\nIf you require a workspace to be available in the unlikely scenario of a regional failure then configure data collection to send critical data to multiple workspaces in different regions.\nResources\nAzure Monitor configuration recommendations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development LOG-4 - Create a health status alert rule for your Log Analytics workspace Category: Monitoring\nImpact: Low\nGuidance\nA health status alert will proactively notify you if a workspace becomes unavailable because of a datacenter or regional failure.\nResources\nMonitor Log Analytics workspace health Azure Monitor configuration recommendations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development LOG-5 - Configure minimal logging and retention of logs Category: Monitoring\nImpact: Low\nGuidance\nAzure Monitor Logs automatically retains log data for a specific period of time depending on the data type (for example, 31 days for platform logs and metrics). However, you may need to retain your data for longer periods for compliance or business reasons. You can configure the data retention settings based on your requirements.\nFor long-term storage, it might be necessary to move logs from Azure Monitor to a more cost-effective storage solution, such as Azure Blob Storage. This allows you to keep logs for an extended period of time without incurring high costs.\nResources\nData retention and archive in Azure Monitor Logs Run search jobs in Azure Monitor Restore logs in Azure Monitor Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/management/management-group/",
	"title": "Management Groups",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Management Groups and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Management Groups and its associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available MG-1 - Subscriptions should not be placed under the Tenant Root Management Group Governance Medium Preview Yes Definitions of states can be found here Recommendations Details MG-1 - Subscriptions should not be placed under the Tenant Root Management Group Category: Governance\nImpact: Medium\nGuidance\nThe root management group is built into the hierarchy to have all management groups and subscriptions fold up to it. Create management groups under your root-level management group to represent the types of workloads that you\u0026rsquo;ll host.\nThese groups are based on the security, compliance, connectivity, and feature needs of the workloads. With this grouping structure, you can have a set of Azure policies applied at the management group level. This grouping structure is for all workloads that require the same security, compliance, connectivity, and feature settings.\nResources\nManagement group recommendations Root management group for each directory Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure Subscriptions that are placed under the Tenant Root Management Group resourcecontainers | where type == \u0026#39;microsoft.resources/subscriptions\u0026#39; | extend mgParentSize = array_length(properties.managementGroupAncestorsChain) | where mgParentSize == 1 | project recommendationId=\u0026#34;mg-1\u0026#34;, name, id, tags "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/network-security-group/",
	"title": "Network Security Group",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Network Security Group and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Network Security Group and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available NSG-1 - Configure Diagnostic Settings for all network security groups Monitoring Medium Preview No NSG-2 - Monitor changes in Network Security Groups with Azure Monitor Monitoring Low Preview Yes NSG-3 - Configure locks for Network Security Groups to avoid accidental changes and/or deletion Governance Low Preview No NSG-4 - Configure NSG Flow Logs Monitoring Medium Preview Yes NSG-5 - The NSG only has Default Security Rules, make sure to configure the necessary rules Access \u0026amp; Security Medium Preview Yes Definitions of states can be found here Recommendations Details NSG-1 - Configure Diagnostic Settings for all network security groups Category: Monitoring\nImpact: Medium\nGuidance\nResource Logs are not collected and stored until you create a diagnostic setting and route them to one or more locations.\nResources\nDiagnostic settings in Azure Monitor Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development Show/Hide Query/Script Copy # Azure PowerShell Script # Find all Network Security Groups without diagnostic settings configured. Get-AzNetworkSecurityGroup | Where-Object -FilterScript { (Get-AzDiagnosticSetting -ResourceId $_.Id) -eq $null } | ForEach-Object -Process { $nsg = $_ [PSCustomObject] @{ recommendationId = \u0026#39;nsg-1\u0026#39; name = $nsg.Name id = $nsg.Id tags = if ($nsg.Tag) { ($nsg.Tag.GetEnumerator() | ForEach-Object -Process { \u0026#34;{\u0026#34;\u0026#34;$($_.Key)\u0026#34;\u0026#34;:\u0026#34;\u0026#34;$($_.Value)\u0026#34;\u0026#34;}\u0026#34; }) -join \u0026#39;,\u0026#39; } else { \u0026#39;\u0026#39; } param1 = \u0026#39;DiagnosticSetting: Disabled\u0026#39; } } NSG-2 - Monitor changes in Network Security Groups with Azure Monitor Category: Monitoring\nImpact: Low\nGuidance\nCreate Alerts for administrative operations such as Create or Update Network Security Group rules with Azure Monitor to detect unauthorized/undesired changes to production resources, this alert can help identify undesired changes in the default security, such as attempts to by-pass firewalls or from accessing resources externally.\nResources\nAzure Monitor activity log Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Network Security Groups without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project name, id, tags, lowerCaseNsgId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Network Security Group (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39;) or // All administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/networkSecurityGroups/join/action\u0026#34;\u0026#39;) ) | project lowerCaseNsgIdOfScope = tolower(scope) ) on $left.lowerCaseNsgId == $right.lowerCaseNsgIdOfScope | where isempty(lowerCaseNsgIdOfScope) | project recommendationId = \u0026#34;nsg-2\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; NSG-3 - Configure locks for Network Security Groups to avoid accidental changes and/or deletion Category: Governance\nImpact: Medium\nGuidance\nAs an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental user deletions and modifications. The lock overrides any user permissions. You can set locks that prevent either deletions or modifications. In the portal, these locks are called Delete and Read-only.\nResources\nLock your resources to protect your infrastructure Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development Show/Hide Query/Script Copy # Azure PowerShell Script # Find all Network Security Groups without resource locks configured. $resourceLockScopes = Get-AzResourceLock | Where-Object { ($_.ResourceType -eq \u0026#39;Microsoft.Network/networkSecurityGroups\u0026#39;) -or # Lock for Network Security Group ($_.ResourceType -eq \u0026#39;Microsoft.Authorization/locks\u0026#39;) # Lock for Resource Group } | Select-Object -ExpandProperty \u0026#39;ResourceId\u0026#39; | ForEach-Object -Process { $_.Remove($_.LastIndexOf(\u0026#39;/providers/Microsoft.Authorization/locks\u0026#39;)) } Get-AzNetworkSecurityGroup | ForEach-Object -Process { $nsg = $_ $nsgHasLock = $false foreach ($scope in $resourceLockScopes) { $nsgHasLock = ($nsg.Id -eq $scope) -or $nsg.Id.StartsWith($scope) if ($nsgHasLock) { break } } if (-not $nsgHasLock) { [PSCustomObject] @{ recommendationId = \u0026#39;nsg-3\u0026#39; name = $nsg.Name id = $nsg.Id tags = if ($nsg.Tag) { ($nsg.Tag.GetEnumerator() | ForEach-Object -Process { \u0026#34;{\u0026#34;\u0026#34;$($_.Key)\u0026#34;\u0026#34;:\u0026#34;\u0026#34;$($_.Value)\u0026#34;\u0026#34;}\u0026#34; }) -join \u0026#39;,\u0026#39; } else { \u0026#39;\u0026#39; } param1 = \u0026#39;ResourceLock: Not configured\u0026#39; } } } NSG-4 - Configure NSG Flow Logs Category: Monitoring\nImpact: Medium\nGuidance\nIt\u0026rsquo;s vital to monitor, manage, and know your own network so that you can protect and optimize it. You need to know the current state of the network, who\u0026rsquo;s connecting, and where users are connecting from. You also need to know which ports are open to the internet, what network behavior is expected, what network behavior is irregular, and when sudden rises in traffic happen.\nFlow logs are the source of truth for all network activity in your cloud environment. Whether you\u0026rsquo;re in a startup that\u0026rsquo;s trying to optimize resources or a large enterprise that\u0026rsquo;s trying to detect intrusion, flow logs can help. You can use them for optimizing network flows, monitoring throughput, verifying compliance, detecting intrusions, and more.\nResources\nFlow logging for network security groups Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Network Security Groups without NSG Flow logs configured or disabled. resources | where type =~ \u0026#34;Microsoft.Network/networkSecurityGroups\u0026#34; | project name, id, tags, lowerCaseNsgId = tolower(id) | join kind = leftouter ( resources | where type == \u0026#34;microsoft.network/networkwatchers/flowlogs\u0026#34; and properties.enabled == true | project flowLogName = name, lowerCaseTargetNsgId = tolower(properties.targetResourceId) ) on $left.lowerCaseNsgId == $right.lowerCaseTargetNsgId | where isempty(lowerCaseTargetNsgId) | project recommendationId = \u0026#34;nsg-4\u0026#34;, name, id, tags, param1 = \u0026#34;NSGFlowLog: Not configured/Disabled\u0026#34; NSG-5 - The NSG only has Default Security Rules, make sure to configure the necessary rules Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nYou can use an Azure network security group to filter network traffic between Azure resources in an Azure virtual network. A network security group contains security rules that allow or deny inbound network traffic to, or outbound network traffic from, several types of Azure resources. For each rule, you can specify source and destination, port, and protocol.\nResources\nSecurity rules Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all NSGs that have NO security rules resources | where type =~ \u0026#34;microsoft.network/networksecuritygroups\u0026#34; | extend sr = string_size(properties.securityRules) | where sr \u0026lt;=2 or isnull(properties.securityRules) | project recommendationId = \u0026#34;nsg-5\u0026#34;, name, id "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/network-watcher/",
	"title": "Network Watcher",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Network Watcher and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Network Watcher and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available NW-1 - Deploy Network Watcher in all regions where you have networking services Monitoring Low Preview Yes NW-2 - Fix Flow Log configurations in Failed state or Disabled Status Monitoring Low Preview Yes Definitions of states can be found here Recommendations Details NW-1 - Deploy Network Watcher in all regions where you have networking services Category: Monitoring\nImpact: Low\nGuidance\nAzure Network Watcher provides a suite of tools to monitor, diagnose, view metrics, and enable or disable logs for Azure IaaS (Infrastructure-as-a-Service) resources. Network Watcher enables you to monitor and repair the network health of IaaS products like virtual machines (VMs), virtual networks (VNets), application gateways, load balancers, etc. Network Watcher isn\u0026rsquo;t designed or intended for PaaS monitoring or Web analytics.\nResources\nWhat is Azure Network Watcher? Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all locations that do not have a Network Watcher deployed resources | where location != \u0026#34;global\u0026#34; | union (Resources | where type =~ \u0026#34;microsoft.network/networkwatchers\u0026#34;) | summarize NetworkWatcherCount = countif(type =~ \u0026#39;Microsoft.Network/networkWatchers\u0026#39;) by location | where NetworkWatcherCount == 0 | project recommendationId = \u0026#34;nw-1\u0026#34;, name=location, id=\u0026#34;n/a\u0026#34;, tags, param1 = strcat(\u0026#34;LocationMisingNetworkWatcher:\u0026#34;, location) NW-2 - Fix Flow Log configurations in Failed state or Disabled Status Category: Monitoring\nImpact: Low\nGuidance\nNetwork security group flow logging is a feature of Azure Network Watcher that allows you to log information about IP traffic flowing through a network security group. If the flow log is in Failed state, the monitoring data from the associated resource is not being collected.\nResources\nManage NSG flow logs using the Azure portal Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all Network Watcher Flow Logs that are not enabled or in a succeeded state resources | where type =~ \u0026#34;microsoft.network/networkwatchers/flowlogs\u0026#34; and isnotnull(properties) | extend targetResourceId = tostring(properties.targetResourceId) | extend status = iff(properties.enabled =~ \u0026#39;true\u0026#39;, \u0026#34;Enabled\u0026#34;, \u0026#34;Disabled\u0026#34;) | extend provisioningState = tostring(properties.provisioningState) | extend flowLogType = iff(properties.targetResourceId contains \u0026#34;Microsoft.Network/virtualNetworks\u0026#34;, \u0026#39;Virtual network\u0026#39;, \u0026#39;Network security group\u0026#39;) | where provisioningState != \u0026#34;Succeeded\u0026#34; or status != \u0026#34;Enabled\u0026#34; | project recommendationId = \u0026#34;nw-2\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState:\u0026#34;, provisioningState), param2=strcat(\u0026#34;Status:\u0026#34;, status), param3=strcat(\u0026#34;targetResourceId:\u0026#34;,targetResourceId), param4=strcat(\u0026#34;flowLogType:\u0026#34;,flowLogType) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/private-dns-zones/",
	"title": "Private DNS Zones",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Private DNS Zones and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Private DNS Zones and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available PVDNSZ-1 - Protect private DNS zones and records Access \u0026amp; Security Medium Preview No PVDNSZ-2 - Monitor Private DNS Zones health and set up alerts Monitoring Low Preview No PVDNSZ-3 - Make sure Production and DR zones have equivalent entries for workloads and resources that will be failed over Governance Medium Preview No Definitions of states can be found here Recommendations Details PVDNSZ-1 - Protect private DNS zones and records Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nPrivate DNS zones and records are critical resources. Deleting a DNS zone or a single DNS record can result in a service outage. It\u0026rsquo;s important that DNS zones and records are protected against unauthorized or accidental changes. The Private DNS Zone Contributor role is a built-in role for managing private DNS resources. This role applied to a user or group enables them to manage private DNS resources.\nResources\nProtecting private DNS Zones and Records - Azure DNS Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development PVDNSZ-2 - Monitor Private DNS Zones health and set up alerts Category: Monitoring\nImpact: Low\nGuidance\nThe records contained in a private DNS zone aren\u0026rsquo;t resolvable from the Internet. DNS resolution against a private DNS zone works only from virtual networks that are linked to it. You can link a private DNS zone to one or more virtual networks by creating virtual network links. You can also enable the autoregistration feature to automatically manage the life cycle of the DNS records for the virtual machines that get deployed in a virtual network.\nResources\nScenarios for Azure Private DNS zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development PVDNSZ-3 - Make sure Production and DR zones have equivalent entries for workloads and resources that will be failed over Category: Governance\nImpact: Medium\nGuidance\nAzure Private DNS provides a reliable, secure DNS service to manage and resolve domain names in a virtual network without the need to add a custom DNS solution. By using private DNS zones, you can use your own custom domain names rather than the Azure-provided names available today. The records contained in a private DNS zone aren\u0026rsquo;t resolvable from the Internet. DNS resolution against a private DNS zone works only from virtual networks that are linked to it. You can link a private DNS zone to one or more virtual networks by creating virtual network links. You can also enable the autoregistration feature to automatically manage the life cycle of the DNS records for the virtual machines that get deployed in a virtual network.\nResources\nScenarios for Azure Private DNS zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/private-endpoints/",
	"title": "Private Endpoints",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Private Endpoints and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Private Endpoints and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available PEP-1 - Resolve issues with Private Endpoints in non Succeeded connection state Networking Medium Preview Yes Definitions of states can be found here Recommendations Details PEP-1 - Resolve issues with Private Endpoints in non Succeeded connection state Category: Networking\nImpact: Medium\nGuidance\nA private endpoint has two custom properties, static IP address and the network interface name. These properties must be set when the private endpoint is created. I the state is not in Succeeded state, there might be a problem with the private endpoint or with the associated resource.\nResources\nPrivate endpoint connections Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all Private Endpoints that are not in a Succeeded state resources | where type =~ \u0026#34;microsoft.network/privateendpoints\u0026#34; | where properties.provisioningState != \u0026#34;Succeeded\u0026#34; or properties.privateLinkServiceConnections[0].properties.provisioningState != \u0026#34;Succeeded\u0026#34; | project recommendationId = \u0026#34;pep-1\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.provisioningState)), param2 = strcat(\u0026#34;provisioningState: \u0026#34;, tostring(properties.privateLinkServiceConnections[0].properties.provisioningState)) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/public-ip/",
	"title": "Public Ip",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Public Ip and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Public Ip and associated Public Ip settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Public Ip and associated resources.\nRecommendation Category Impact State ARG Query Available PIP-1 - Use Standard SKU and Zone-Redundant IPs when applicable Availability High Preview Yes PIP-2 - Use NAT gateway for outbound connectivity to avoid SNAT Exhaustion Availability Medium Preview Yes Definitions of states can be found here Recommendations Details PIP-1 - Use Standard SKU and Zone-Redundant IPs when applicable Category: Availability\nImpact: High\nGuidance\nPublic IP addresses with a standard SKU can be created as non-zonal, zonal, or zone-redundant in regions that support availability zones. A zone-redundant IP is created in all zones for a region and can survive any single zone failure. A zonal IP is tied to a specific availability zone, and shares fate with the health of the zone. A \u0026ldquo;non-zonal\u0026rdquo; public IP address is placed into a zone for you by Azure and doesn\u0026rsquo;t give a guarantee of redundancy. When utilizing a Public IP with resources that support zone resiliency (such as an Azure Load Balancer or Azure Firewall), it is recommended to use zone-redundant IPs in most cases.\nResources\nPublic IP addresses - Availability Zones Upgrading a basic public IP address to Standard SKU Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph query // Lists VMs with PIPs that are not Standard SKU resources | where type =~ \u0026#39;Microsoft.Network/publicIPAddresses\u0026#39; | extend sku = tostring(sku.name) | where sku != \u0026#39;Standard\u0026#39; | project recommendationid=\u0026#34;pip-1\u0026#34;, name, id, param1=strcat(\u0026#34;sku=\u0026#34;,sku) PIP-2 - Use NAT gateway for outbound connectivity to avoid SNAT Exhaustion Category: Availability\nImpact: Medium\nGuidance\nPrevent risk of connectivity failures due to SNAT port exhaustion by using NAT gateway for outbound traffic from your virtual networks. NAT gateway scales dynamically and provides secure connections for traffic headed to the internet.\nResources\nUse NAT GW for outbound connectivity TCP and SNAT Ports Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph query // Lists VMs with PIPs resources | where type =~ \u0026#39;Microsoft.Network/publicIPAddresses\u0026#39; | where tostring(properties.ipConfiguration.id) contains \u0026#34;microsoft.network/networkinterfaces\u0026#34; | project recommendationid=\u0026#34;pip-2\u0026#34;, name, id, tags, param1=strcat(\u0026#34;Migrate from instance IP to NAT Gateway\u0026#34;) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/database/redis-cache/",
	"title": "Redis Cache",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Redis Cache and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Redis Cache and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available REDIS-1 - Enable zone redundancy for Azure Cache for Redis High Availability High Preview Yes Definitions of states can be found here Recommendations Details REDIS-1 - Enable zone redundancy for Azure Cache for Redis Category: Availability\nImpact: High\nRecommendation/Guidance\nAzure Cache for Redis supports zone redundancy in its Premium and Enterprise tiers. A zone-redundant cache runs on VMs spread across multiple Availability Zones. Zone redundancy provides higher resilience and availability.\nResources\nEnable zone redundancy for Azure Cache for Redis Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Cache for Redis instances with one or no Zones selected resources | where type == \u0026#34;microsoft.cache/redis\u0026#34; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;redis-1\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/management/resource-group/",
	"title": "Resource Groups",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Resource Groups and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Resource Groups and its associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available RG-1 - Ensure Resource Group and its Resources are located in the same Region Disaster Recovery High Preview Yes Definitions of states can be found here Recommendations Details RG-1 - Ensure Resource Group and its Resources are located in the same Region Category: Disaster Recovery\nImpact: High\nGuidance\nEnsure your resource locations match that of the containing resource group. This ensures that, in the event of a regional outage, you will still be able to manage your resource. ARM stores resource data for resources in a resource group and, if the region is unavailable, updates to this data could fail, making the resource effectively read-only.\nResources\nAzure Resource Manager Overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of Azure Resource Groups that have resources deployed in a region different than the Resource Group region resources | project id, name, tags, resourceGroup, location | where location != \u0026#34;global\u0026#34; // exclude global resources | where resourceGroup != \u0026#34;networkwatcherrg\u0026#34; // exclude networkwatcherrg | where split(id, \u0026#34;/\u0026#34;, 3)[0] =~ \u0026#34;resourceGroups\u0026#34; // resource is in a resource group | extend resourceGroupId = strcat_array(array_slice(split(id, \u0026#34;/\u0026#34;),0,4), \u0026#34;/\u0026#34;) // create resource group resource id | join (resourcecontainers | project containerid=id, containerlocation=location ) on $left.resourceGroupId == $right.[\u0026#39;containerid\u0026#39;] // join to resourcecontainers table | where location != containerlocation | project recommendationId=\u0026#34;rg-1\u0026#34;, name, id, tags | order by id asc "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/monitoring/resource-health-alerts/",
	"title": "Resource Health Alerts",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Resources Health and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Resources Health Alerts and associated resources and settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Resources Health Alerts and associated resources.\nRecommendation Category Impact State ARG Query Available MSR-1 - Configure Resource Health Alerts Monitoring Low Preview No Definitions of states can be found here Recommendations Details MSR-1 - Configure Resource Health Alerts Category: Monitoring\nImpact: Low\nRecommendation\nConfigure Resource Health Alerts for all applicable resources. Azure Resource Health alerts keep you informed about the current and historical health status of your Azure resources. Azure Resource Health alerts can notify you when these resources have a change in their health status.\nResources\nResource Health Configure Resource Health alerts in the Azure portal Alerts Health Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/route-table/",
	"title": "Route Table",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Route Table and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Route Table and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available RT-1 - Monitor changes in Route Tables with Azure Monitor Monitoring Low Preview Yes RT-2 - Configure locks for Route Tables to avoid accidental changes or deletion Governance Low Preview No Definitions of states can be found here Recommendations Details RT-1 - Monitor changes in Route Tables with Azure Monitor Category: Monitoring\nImpact: Low\nGuidance\nCreate Alerts for administrative operations such as Create or Update Route Table with Azure Monitor to detect unauthorized/undesired changes to production resources, this alert can help identify undesired changes in routing, such as attempts to by-pass firewalls or from accessing resources externally.\nResources\nAzure activity log - Azure Monitor | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Route Tables without alerts for modification configured. resources | where type =~ \u0026#34;Microsoft.Network/routeTables\u0026#34; | project name, id, tags, lowerCaseRouteTableId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Insights/activityLogAlerts\u0026#34; and properties.enabled == true | mv-expand scope = properties.scopes | where scope has \u0026#34;Microsoft.Network/routeTables\u0026#34; | project alertName = name, conditionJson = dynamic_to_json(properties.condition.allOf), scope | where conditionJson has \u0026#39;\u0026#34;Administrative\u0026#34;\u0026#39; and ( // Create or Update Route Table (conditionJson has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39;) or // All Administrative operations (conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/write\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/delete\u0026#34;\u0026#39; and conditionJson !has \u0026#39;\u0026#34;Microsoft.Network/routeTables/join/action\u0026#34;\u0026#39;) ) | project lowerCaseRouteTableIdOfScope = tolower(scope) ) on $left.lowerCaseRouteTableId == $right.lowerCaseRouteTableIdOfScope | where isempty(lowerCaseRouteTableIdOfScope) | project recommendationId = \u0026#34;rt-1\u0026#34;, name, id, tags, param1 = \u0026#34;ModificationAlert: Not configured/Disabled\u0026#34; RT-2 - Configure locks for Route Tables to avoid accidental changes or deletion Category: Governance\nImpact: Low\nGuidance\nAs an administrator, you can lock an Azure subscription, resource group, or resource to protect them from accidental user deletions and modifications. The lock overrides any user permissions. You can set locks that prevent either deletions or modifications. In the portal, these locks are called Delete and Read-only.\nResources\nProtect your Azure resources with a lock - Azure Resource Manager | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy #Pulls a list of all Route Tables without a resource lock configured. $NeedsResourceLock = @() $subscriptions = Get-azsubscription foreach ($subscription in $subscriptions){ set-azcontext $subscription | Out-Null $RouteTables= Get-AzRouteTable $ResourceLocks = Get-AzResourceLock $RouteTableLocks = $ResourceLocks | where{$_.resourcetype -eq \u0026#34;Microsoft.Network/routeTables\u0026#34;} $ResourceGroupLocks = $ResourceLocks | where{$_.resourcetype -eq \u0026#34;Microsoft.Authorization/locks\u0026#34;} foreach ($resource in $RouteTables){ If ($routetablelocks.resourcename -notcontains $resource.name -and $ResourceGroupLocks.ResourceGroupName -notcontains $resource.ResourceGroupName){$NeedsResourceLock += $resource} } } $NeedsResourceLock | select Name, ResourceType, ResourceGroupName, Location, ID | format-table "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/specialized-workloads/sap-on-azure/",
	"title": "SAP on Azure",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Sap Solution and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Azure Sap Solution and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available SAP-1 - Ensure SAP production systems are designed for high availability. Availability High Published No SAP-2 - Run SAP application servers on two or more VMS. Availability High Published No SAP-3 - When using Virtual Machines Scale Set (VMSS), review recommendations for SAP workload. Availability High Published No SAP-5 - In a zonal high availability setup if we can\u0026rsquo;t use VMSS, check use if availability zone and proximity placement group. Availability High Published No SAP-6 - Avoid placing application server and database in one Proximity Placement Group. Availability High Published No SAP-7 - Avoid placing VMs from multiple SAP systems in a single Proximity Placement Group. Availability High Published No SAP-8 - When creating availability sets, enable fault domains. Availability High Published No SAP-9 - If using single-instance VMs, all OS and data disks must be Premium SSD or Ultra Disk. Availability High Published No SAP-14 - Ensure that the data is replicated synchronously (SYNC mode) between the primary and secondary database hosting VM nodes. Availability High Published No SAP-15 - Ensure that the SAP shared files systems are made highly available. Availability High Published No SAP-16 - Test all HA solutions end to end. Availability High Published No SAP-20 - In zonal SAP deployment, ensure all components and Azure services are deployed with zone redundancy. Availability High Published No SAP-22 - Ensure that the SAP production workloads are protected by a cross-region DR solution. Disaster Recovery High Published No SAP-23 - If using Zonal DR, ensure that SAP production workloads are protected by cross-zone DR solution. Disaster Recovery High Published No SAP-24 - Implementing an offsite backup strategy by utilizing the second Azure region for our backups. Disaster Recovery High Published No SAP-26 - Consider On-demand Capacity Reservation to reserve DR compute capacity. Disaster Recovery Medium Published No SAP-27 - Ensure that the production databases are replicated (ASYNC) to DR location, use database vendor\u0026rsquo;s replication. Disaster Recovery High Published No SAP-28 - SAP components are backed up to DR location using an appropriate backup tool or ASR. Disaster Recovery High Published No SAP-29 - SAP shared files systems and any other critical to DR are replicated or backed up to DR location. Disaster Recovery High Published No SAP-30 - Ensure Cross Region Restore of Recovery Services Vaults has been enabled. Disaster Recovery Medium Published No SAP-31 - Conduct backup testing, all the systems are backed up and restore is working within an expected time frame. Disaster Recovery Medium Published No SAP-32 - Automate DR infrastructure build or pre-deploy DR resources. Disaster Recovery Medium Published No SAP-33 - Document and test DR procedure, ensure it meets RPO and RTO targets. Disaster Recovery Medium Published No SAP-36 - Configure scheduled events notification. Monitoring High Published No SAP-37 - Defined a procedure on how to react to Scheduled events. Monitoring High Published No SAP-39 - Setup Service Health alerts for all critical subscriptions. Monitoring High Published No SAP-40 - Defined a procedure on how to react to Service Heath Alerts. Monitoring High Published No SAP-42 - ASCS-Pacemaker (Central Server Instance) Ensure Pacemaker cluster has been setup for SAP ASCS high availability. Automation High Published No SAP-43 - ASCS-Pacemaker-SLES (Central Server Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability. Availability High Published No SAP-44 - ASCS-Pacemaker-RH (Central Server Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability. Availability High Published No SAP-45 - ASCS-LB (Central Server Instance) Ensure the load balancer is configured correctly for SAP ASCS High availability. Availability High Published No SAP-46 - DBHANA-Pacemaker (Database Instance) Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability. Availability High Published No SAP-47 - DBHANA-Pacemaker-SLES (Database Instance) Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability. Availability High Published No SAP-48 - DBHANA-Pacemaker-RH (Database Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability. Availability High Published No SAP-49 - DBHANA-LB (Database Instance) Ensure the load balancer is configured correctly for SAP HANA DB High availability. Availability High Published No Definitions of states can be found here Recommendations Details SAP-1 - Ensure SAP production systems are designed for high availability Category: Availability\nImpact: High\nGuidance\nEnsure SAP production systems are designed for high availability using availability zones.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-2 - Run SAP application servers on two or more VMS Category: Availability\nImpact: High\nGuidance\nDeploy SAP application servers on two or more virtual machines (VMs) using VMSS Flex.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-3 - When using Virtual Machines Scale Set review recommendations for SAP workload Category: Availability\nImpact: High\nGuidance\nIf utilizing Virtual Machine Scale Sets (VMSS), adhere to our guidelines for SAP workloads, ensuring you select the appropriate mode and configure the correct settings.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-5 - In a zonal high availability setup if we can\u0026rsquo;t use VMSS check use if availability zone and proximity placement group Category: Availability\nImpact: High\nGuidance\nIn a zonal high availability setup if we can\u0026rsquo;t use VMSS, then ensure the SAP application server VMs of each zone are placed in an availability set using a proximity placement group so that VMs are distributed across multiple fault domains and update domains within each zone.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-6 - Avoid placing application server and database in one Proximity Placement Group Category: Availability\nImpact: High\nGuidance\nEnsure that you do not colocate application server and database virtual machines (VMs) within the same Proximity Placement Group.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-7 - Avoid placing VMs from multiple SAP systems in a single Proximity Placement Group Category: Availability\nImpact: High\nGuidance\nEnsure that VMs from different SAP systems are not colocated within a single Proximity Placement Group\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-8 - When creating availability sets enable fault domains Category: Availability\nImpact: High\nGuidance\nWhen creating availability sets, ensure you utilize the maximum number of fault domains available and a sufficient number of update domains. Additionally, conduct regular audits of VMs to prevent unexpected deviations.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-9 - If using single-instance VMs all OS and data disks must be Premium SSD or Ultra Disk Category: Availability\nImpact: High\nGuidance\nFor single-instance VMs, both OS and data disks must be either Premium SSD or Ultra Disk to achieve the single-instance SLA of 99.9% availability.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-14 - Ensure that the data is replicated synchronously (SYNC mode) between the primary and secondary database hosting VM nodes Category: Availability\nImpact: High\nGuidance\nIn the case of databases, ensure that data is replicated synchronously (SYNC mode) between the primary and secondary database hosting VM nodes.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-15 - Ensure that the SAP shared files systems are made highly available Category: Availability\nImpact: High\nGuidance\nMake sure that SAP shared file systems, such as /sapmnt, /usr/trans and /interfaces are highly available. In zonal deployments, replicate them to another zone.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-16 - Test all HA solutions end to end Category: Availability\nImpact: High\nGuidance\nThoroughly test all high-availability (HA) solutions, including scenarios like kernel panic in Linux VMs and fail-back procedures. Failovers should be smooth and meet the expected failover times. Failback can be either automatic or manual.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-20 - In zonal SAP deployment, ensure all components and Azure services are deployed with zone redundancy Category: Availability\nImpact: High\nGuidance\nIn zonal SAP deployments, deploy all components and Azure services with zone redundancy. Examples include ER GW, Azure LB, AppGW, Reverse proxy, IP addresses, firewalls, ANF and VMSS running shared services like firewalls and backup infrastructure.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-22 - Ensure that the SAP production workloads are protected by a cross-region DR solution Category: Disaster Recovery\nImpact: High\nGuidance\nMake sure that SAP production workloads have a disaster recovery (DR) solution spanning across multiple regions.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-23 - If using Zonal DR, ensure that SAP production workloads are protected by cross-zone DR solution Category: Disaster Recovery\nImpact: High\nGuidance\nWhen implementing Zonal Disaster Recovery (DR), make sure that SAP production workloads are safeguarded by a DR solution spanning across different zones.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-24 - Implementing an offsite backup strategy by utilizing the second Azure region for our backups Category: Disaster Recovery\nImpact: High\nGuidance\nCreate an offsite backup plan by leveraging the second Azure region for storing backups.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-26 - Consider On-demand Capacity Reservation to reserve DR compute capacity Category: Disaster Recovery\nImpact: Medium\nGuidance\nOn-demand Capacity Reservation is recommended for disaster recovery (DR) needs.‚Äù\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy SAP-27 - Ensure that the production databases are replicated (ASYNC) to DR location, use database vendor\u0026rsquo;s replication Category: Disaster Recovery\nImpact: High\nGuidance\nReplicate production databases (ASYNC) to the DR location using the database vendor‚Äôs replication technology.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-28 - SAP components are backed up to DR location using an appropriate backup tool or ASR Category: Disaster Recovery\nImpact: High\nGuidance\nBack up SAP components such as (A)SCS, application servers, and WebDispatchers to the DR location using an appropriate backup tool or Azure Site Recovery (ASR).\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-29 - SAP shared files systems and any other critical to DR are replicated or backed up to DR location Category: Disaster Recovery\nImpact: High\nGuidance\nEnsure that critical SAP shared file systems, such as /sapmnt, /usr/trans and /interfaces are either replicated or backed up for disaster recovery purposes.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-30 - Ensure Cross Region Restore of Recovery Services Vaults has been enabled Category: Disaster Recovery\nImpact: Medium\nGuidance\nEnable Cross Region Restore for Geo-redundant Recovery Services Vaults. This allows restoring backed-up data in the secondary region even when the primary region is still available.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-31 - Conduct backup testing, all the systems are backed up and restore is working within an expected time frame Category: Disaster Recovery\nImpact: Medium\nGuidance\nConduct backup testing to verify that all production systems can be backed up simultaneously (or as needed) and that the restore process works within the expected time frame.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-32 - Automate DR infrastructure build or pre-deploy DR resources Category: Disaster Recovery\nImpact: Medium\nGuidance\nAutomate the build of disaster recovery (DR) infrastructure (or pre-deploy DR resources) and streamline SAP service recovery as much as possible.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-33 - Document and test DR procedure, ensure it meets RPO and RTO targets Category: Disaster Recovery\nImpact: Medium\nGuidance\nDocument and tes disaster recovery (DR) procedure to ensure it meets your Recovery Point Objective (RPO) and Recovery Time Objective (RTO) targets.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-36 - Configure scheduled events notification Category: Monitoring\nImpact: High\nGuidance\nConfigure scheduled events to receive notifications about upcoming maintenance events, such as reboots. The resource agent ‚Äòazure-events‚Äô can be integrated with Pacemaker clusters.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-37 - Defined a procedure on how to react to Scheduled events Category: Monitoring\nImpact: High\nGuidance\nDefine a procedure for reacting to scheduled events effectively.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-39 - Setup Service Health alerts for all critical subscriptions Category: Monitoring\nImpact: High\nGuidance\nSet up Service Health alerts for all critical subscriptions, this will allow quicker response to incidents.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-40 - Defined a procedure on how to react to Service Heath Alerts Category: Monitoring\nImpact: High\nGuidance\nDefine a procedure for reacting to Service Health Alerts, ensuring that SAP applications can automatically start in the correct sequence.\nResources\nSAP ACSS checks OpenSource Quality checks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-42 - ASCS-Pacemaker (Central Server Instance) Ensure Pacemaker cluster has been setup for SAP ASCS high availability Category: Availability\nImpact: High\nGuidance\nFor the ASCS-Pacemaker (Central Server Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability.\nResources\nSAP ACSS checks OpenSource Quality checks ASCS-Pacemaker - Central Server Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-43 - ASCS-Pacemaker-SLES (Central Server Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability Category: Availability\nImpact: High\nGuidance\nFor the ASCS-Pacemaker-SLES (Central Server Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability when running on SLES.\nResources\nASCS-Pacemaker-SLESCentral Server Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-44 - ASCS-Pacemaker-RH (Central Server Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability Category: Availability\nImpact: High\nGuidance\nFor the ASCS-Pacemaker-RH (Central Server Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability when running on Red Hat.\nResources\nASCS-Pacemaker-RH Central Server Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-45 - ASCS-LB (Central Server Instance) Ensure the load balancer is configured correctly for SAP ASCS High availability Category: Availability\nImpact: High\nGuidance\nFor the ASCS-LB (Central Server Instance), ensure that the load balancer is configured correctly for SAP ASCS high availability.\nResources\nASCS-LB - Central Server Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-46 - DBHANA-Pacemaker (Database Instance) Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability Category: Availability\nImpact: High\nGuidance\nFor the DBHANA-Pacemaker (Database Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP HANA DB high availability.\nResources\nDBHANA-Pacemaker - Database Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-47 - DBHANA-Pacemaker-SLES (Database Instance) Ensure the Pacemaker cluster has been setup for SAP HANA DB high availability Category: Availability\nImpact: High\nGuidance\nFor the DBHANA-Pacemaker-SLES (Database Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP HANA DB high availability when running on SLES.\nResources\nDBHANA-Pacemaker-SLES- Database Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-48 - DBHANA-Pacemaker-RH (Database Instance) Ensure the Pacemaker cluster has been setup for SAP ASCS high availability Category: Availability\nImpact: High\nGuidance\nFor the DBHANA-Pacemaker-RH (Database Instance), ensure that the Pacemaker cluster configuration parameters are correctly set up for SAP ASCS high availability when running on Red Hat.\nResources\nDBHANA-Pacemaker-RH- Database Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development SAP-49 - DBHANA-LB (Database Instance) Ensure the load balancer is configured correctly for SAP HANA DB High availability Category: Availability\nImpact: High\nGuidance\nFor the DBHANA-LB (Database Instance), make sure the load balancer is configured correctly for SAP HANA DB high availability.\nResources\nDBHANA-LB- Database Instance Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/integration/service-bus/",
	"title": "Service Bus",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Service Bus and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Service Bus and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available SBNS-1 - Enable Availability Zones for Service Bus namespaces Availability High Preview Yes Definitions of states can be found here Recommendations Details SBNS-1 - Enable Availability Zones for Service Bus namespaces Category: Availability\nImpact: High\nGuidance\nUse Service Bus with zone redundancy for production workloads. The Service Bus Premium SKU supports availability zones, providing fault-isolated locations within the same Azure region. Service Bus manages three copies of the messaging store (1 primary and 2 secondary). Service Bus keeps all three copies in sync for data and management operations. If the primary copy fails, one of the secondary copies is promoted to primary with no perceived downtime. If the applications see transient disconnects from Service Bus, the retry logic in the SDK will automatically reconnect to Service Bus.\nResources\nService Bus and reliability Azure Service Bus Geo-disaster recovery Insulate Azure Service Bus applications against outages and disasters Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Returns Service Bus namespaces that do not have any availability zones enabled resources | where type =~ \u0026#39;Microsoft.ServiceBus/namespaces\u0026#39; | where properties.zoneRedundant == \u0026#39;false\u0026#39; | project recommendationId = \u0026#34;sbns-1\u0026#34;, name, id, tags, param1=strcat(\u0026#34;zoneRedundant: \u0026#34;, properties.zoneRedundant), param2=strcat(\u0026#34;SKU: \u0026#34;, sku.name), param3=iff(tolower(sku.name) == \u0026#39;premium\u0026#39;, \u0026#39;Move Service Bus namespace to a region that supports Availability Zones\u0026#39;, \u0026#39;Migrate to Premium SKU in a region that supports Availability Zones\u0026#39;) "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/monitoring/service-health-alerts/",
	"title": "Service Health Alerts",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Service Health Alerts and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include Service Health Alerts and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available ALA-1 - Configure Service Health Alerts Monitoring High Preview No Definitions of states can be found here Recommendations Details ALA-1 - Configure Service Health Alerts Category: Monitoring\nImpact: High\nGuidance\nService health provides a personalized view of the health of the Azure services and regions you\u0026rsquo;re using. This is the best place to look for service impacting communications about outages, planned maintenance activities, and other health advisories because the authenticated Service Health experience knows which services and resources you currently use. The best way to use Service Health is to set up Service Health alerts to notify you via your preferred communication channels when service issues, planned maintenance, or other changes may affect the Azure services and regions you use.\nResources\nWhat is Azure Service Health? Configure alerts for service health events Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/web/signalr/",
	"title": "SignalR",
	"tags": null,
	"description": "Best practices and resiliency recommendations for SignalR and associated resources and settings.",
	"content": "The presented resiliency recommendations in this guidance include SignalR and associated resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available SIGR-1 - Enable zone redundancy for SignalR High Availability High Preview Yes Definitions of states can be found here Recommendations Details SIGR-1 - Enable zone redundancy for SignalR Category: Availability\nImpact: High\nRecommendation/Guidance\nUse SignalR with zone redundancy for production workloads. Zone redundancy is a Premium tier feature. It is implicitly enabled when you create or upgrade to a Premium tier resource. Standard tier resources can be upgraded to Premium tier without downtime.\nResources\nAvailability zones support in Azure SignalR Service Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find SignalR instances that are not configured with the Premium tier resources | where type == \u0026#34;microsoft.signalrservice/signalr\u0026#34; | where sku.tier != \u0026#34;Premium\u0026#34; | project recommendationId = \u0026#34;sigr-1\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/storage/storage-account/",
	"title": "Storage Account",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Storage Account and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Storage Account and associated settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Storage Account and associated resources.\nRecommendation Category Impact State ARG Query Available ST-1 - Ensure that Storage Account configuration is at least Zone redundant Availability High Preview Yes ST-2 - Do not use classic storage account Governance High Preview Yes ST-3 - Ensure Performance tier is set as per workload System Efficiency Medium Preview Yes ST-4 - Choose right storage account kind for workload System Efficiency Medium Preview No ST-5 - Enable soft delete for recovery of data Disaster Recovery Medium Preview No ST-6 - Enable version for accidental modification and keep the number of versions below 1000 Disaster Recovery Medium Preview No ST-7 - Enable point and time restore for containers for recovery Disaster Recovery Low Preview No ST-8 - Configure Diagnostic Settings for all storage accounts Monitoring Low Preview No Definitions of states can be found here Recommendations Details ST-1 - Ensure that Storage Account configuration is at least Zone redundant Category: Availability\nImpact: High\nGuidance\nData in an Azure Storage account is always replicated three times in the primary region. Azure Storage offers other options for how your data is replicated in the primary or paired region:\nLRS synchronously replicates data 3 times in single physical location. It is least expensive replication but not recommended for apps with high availability and durability. LRS provides eleven 9 durability. ZRS copies data synchronously across 3 availability zone in primary region. ZRS is recommended for apps requiring high availability across zones. ZRS provides twelve 9s durability. GRS replicate additional 3 copies to secondary region and provides sixteen 9s availability. GZRS provides both high availability and redundancy across geo replication. It provides sixteen 9s durability over a given year. Resources\nAzure Storage redundancy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will return all storage accounts that are not using at least Zone replication Resources | where type =~\u0026#39;microsoft.storage/storageaccounts\u0026#39; | where sku.name =~\u0026#39;Standard_LRS\u0026#39; | project recommendationId = \u0026#39;st-1\u0026#39;, name, id, tags, param1=sku.name ST-2 - Do not use classic Storage Account Category: Governance\nImpact: High\nGuidance\nAzure classic Storage Account will retire 31 august 2024. So migrate all workload from classic storage accounts to Azure Resource Manager storage accounts.\nResources\nAzure classic storage accounts retirement announcement Migrate your classic storage accounts to Azure Resource Manager Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Azure classic Storage Account resources | where type =~ \u0026#39;microsoft.classicstorage/storageaccounts\u0026#39; | project recommendationId = \u0026#39;st-2\u0026#39;, name, id, tags, param1=type ST-3 - Ensure Performance tier is set as per workload Category: System Efficiency\nImpact: Medium\nGuidance\nConsider using appropriate storage performance tier for standard storage / block blob / append blob / file-share and page blob. Each workload scenario requires appropriate Performance tier and its important that based on the type of transaction and blob type/file type appropriate performance tier is selected. Failing to do so will create performance bottleneck.\nResources\nPerformance Tier Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Azure Storage Accounts, that do not have an access tier set resources | where type =~\u0026#39;microsoft.storage/storageaccounts\u0026#39; | where isnull(properties.accessTier) | project recommendationId = \u0026#39;st-3\u0026#39;, name, id, tags, param1=\u0026#34;not defined - GeneralPurpose V1\u0026#34; ST-4 - Choose right storage account kind for workload Category: System Efficiency\nImpact: Medium\nGuidance\nBlock blobs are optimized for uploading large amounts of data efficiently. Block blobs are composed of blocks, each of which is identified by a block ID. A block blob can include up to 50,000 blocks\nResources\nStorage Account Kind docs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development ST-5 - Enable soft delete for recovery of data Category: Disaster Recovery\nImpact: Medium\nGuidance\nSoft delete option allow for recovering data if its deleted by mistaken. Moreover Lock will prevent accidentally deleting storage account.\nResources\nSoft delete detail docs Script\nShow/Hide Query/Script Copy # Powershell # Verifies the current ShareDeleteRetentionPolicy setting for a storage account # Set variable values to approroriate storage account and resource group $storageAccount = \u0026#34;StorageAccountName\u0026#34; $resourceGroupName = \u0026#34;ResourceGroupName\u0026#34; Get-AzStorageFileServiceProperty -ResourceGroupName $resourceGroupName -AccountName $storageAccount | Select-Object ShareDeleteRetentionPolicy | Format-Custom ST-6 - Enable version for accidental modification and keep the number of versions below 1000 Category: Disaster Recovery\nImpact: Medium\nGuidance\nTo recover data from accidental modification or deletion enable versioning. Having a large number of versions per blob can increase the latency for blob listing operations. Microsoft recommends maintaining fewer than 1000 versions per blob. You can use lifecycle management to automatically delete old versions.\nResources\nBlob versioning Script\nShow/Hide Query/Script Copy # Powershell # Verifies if versioning is enabled on a storage account # Set the Subscription ID for the variable $subid login-azaccount $subid = \u0026#34;\u0026#34; select-AzSubscription -Subscription $subid $stgs = Get-AzStorageAccount foreach ($st in $stgs){ $ResourceGroupName = $st.ResourceGroupName $StorageAccountNameName = $st.StorageAccountName $IsVersioningEnabled = (Get-AzStorageBlobServiceProperty -ResourceGroupName $st.ResourceGroupName -AccountName $st.StorageAccountName).IsVersioningEnabled if ($IsVersioningEnabled -eq $null){ Write-Output \u0026#34;---------------------------------------------------------\u0026#34; Write-Output (\u0026#34;st-6;\u0026#34; + $StorageAccountNameName + \u0026#34;;\u0026#34; + $st.id + \u0026#34;;IsVersioningEnabled: Null\u0026#34;) } } ST-7 - Enable point and time restore for containers for recovery Category: Disaster Recovery\nImpact: Low\nGuidance\nYou can use point-in-time restore to restore one or more sets of block blobs to a previous state Point and time restore support general purpose v2 account in standard performance tier. Its a mechanism to protect data\nResources\nRestore overview Script\nShow/Hide Query/Script Copy # Powershell # Verifies if DeleteRetentionPolicy is enabled on a storage account # Set the Subscription ID for the variable $subid login-azaccount $subid = \u0026#34;\u0026#34; select-AzSubscription -Subscription $subid $stgs = Get-AzStorageAccount foreach ($st in $stgs){ $ResourceGroupName = $st.ResourceGroupName $StorageAccountNameName = $st.StorageAccountName $DeleteRetentionPolicy = (Get-AzStorageBlobServiceProperty -ResourceGroupName $st.ResourceGroupName -StorageAccountName $st.StorageAccountName).DeleteRetentionPolicy.Enabled if ($DeleteRetentionPolicy -eq $false -or $DeleteRetentionPolicy -eq $null){ Write-Output \u0026#34;---------------------------------------------------------\u0026#34; Write-Output (\u0026#34;st-7;\u0026#34; + $StorageAccountNameName + \u0026#34;;\u0026#34; + $st.id + \u0026#34;;DeleteRetentionPolicy: False\u0026#34;) } } ST-8 - Configure Diagnostic Settings for all storage accounts Category: Monitoring\nImpact: Low\nGuidance\nEnabling diagnostic settings allow you to capture and view diagnostic information so that you can troubleshoot any failures.\nResources\nDiagnostic Setting for Storage Account Script\nShow/Hide Query/Script Copy # Powershell # Verifies if DiagnosticSettings is enabled on a storage account # Set the Subscription ID for the variable $subid login-azaccount $subid = \u0026#34;\u0026#34; select-AzSubscription -Subscription $subid $stgs = Get-AzStorageAccount foreach ($st in $stgs){ $ResourceGroupName = $st.ResourceGroupName $StorageAccountNameName = $st.StorageAccountName $diag = (Get-AzDiagnosticSetting -ResourceId \u0026#34;/subscriptions/$subid/resourceGroups/$ResourceGroupName/providers/Microsoft.Storage/storageAccounts/$StorageAccountNameName\u0026#34;).Id if ($diag -eq $null){ Write-Output \u0026#34;---------------------------------------------------------\u0026#34; Write-Output (\u0026#34;st-9;\u0026#34; + $StorageAccountNameName + \u0026#34;;\u0026#34; + $st.id + \u0026#34;;DiagnosticSettings: Null\u0026#34;) } } "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/tags/",
	"title": "Tags",
	"tags": null,
	"description": "",
	"content": ""
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/traffic-manager/",
	"title": "Traffic Manager",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Azure Traffic Manager.",
	"content": "The presented resiliency recommendations in this guidance include Azure Traffic Manager and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available TRAF-1 - Traffic Manager Monitor Status Should be Online Availability High Preview No TRAF-2 - Traffic manager profiles should have more than one endpoint Availability High Preview No TRAF-3 - Configure at least one endpoint within a another region Disaster Recovery Medium Preview No TRAF-4 - TTL value of user profiles should be in 60 Seconds System Efficiency Medium Preview No TRAF-5 - Ensure endpoint configured to (All World) for geographic profiles Disaster Recovery Medium Preview Yes Definitions of states can be found here Recommendations Details TRAF-1 - Traffic Manager Monitor Status Should be Online Category: Availability\nImpact: High\nGuidance\nMonitor status should be online to provide the failover for application workload. If the health of your Traffic Manager displays a Degraded status, then the status of one or more endpoints may be Degraded.\nResources\nAzure Traffic Manager endpoint monitoring Enable or disable health checks Troubleshooting degraded state on Azure Traffic Manager Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development TRAF-2 - Traffic manager profiles should have more than one endpoint Category: Availability\nImpact: High\nGuidance\nWhen configuring the Azure traffic manager, you should provision minimum of two endpoints to fail-over the workload to a another instance.\nResources\nTraffic Manager Endpoint Types Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development TRAF-3 - Configure at least one endpoint within a another region Category: Disaster Recovery\nImpact: Medium\nGuidance\nProfiles should have more than one endpoint to ensure availability if one of the endpoints fails. It is also recommended that endpoints be in different regions.\nResources\nReliability recommendations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development TRAF-4 - TTL value of user profiles should be in 60 Seconds Category: System Efficiency\nImpact: Medium\nGuidance\nTime to Live (TTL) affects how recent of a response a client will get when it makes a request to Azure Traffic Manager. Reducing the TTL value means that the client will be routed to a functioning endpoint faster in the case of a failover. Configure your TTL to 60 seconds to route traffic to a health endpoint as quickly as possible.\nResources\nConfigure DNS Time to Live to 60 seconds). Traffic Manager profile - ProfileTTL (Configure DNS Time to Live to 60 seconds). Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development TRAF-5 - Ensure endpoint configured to (All World) for geographic profiles Category: Disaster Recovery\nImpact: Medium\nGuidance\nFor geographic routing, traffic is routed to endpoints based on defined regions. When a region fails, there is no pre-defined failover. Having an endpoint where the Regional Grouping is configured to \u0026ldquo;All (World)\u0026rdquo; for geographic profiles will avoid traffic black holing and guarantee service remains available.\nResources\nAdd an endpoint configured to \u0026ldquo;All (World)\u0026rdquo; Traffic Manager profile - GeographicProfile (Add an endpoint configured to \u0026ldquo;\u0026ldquo;All (World)\u0026rdquo;\u0026rdquo;). Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/virtual-machine-scale-sets/",
	"title": "Virtual Machine Scale Sets",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Virtual Machine Scale Sets and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Virtual Machine Scale Sets, and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available VMSS-1 - Deploy VMSS with Flex orchestration mode instead of Uniform System Efficiency Medium Preview Yes VMSS-2 - Enable VMSS application health monitoring Monitoring Medium Preview Yes VMSS-3 - Enable Automatic Repair policy Automation High Preview Yes VMSS-4 - Configure VMSS autoscale to custom and configure the scaling metrics System Efficiency High Preview Yes VMSS-5 - Enable Predictive Autoscale and configure at least for Forecast Only System Efficiency Low Preview Yes VMSS-6 - Disable Force strictly even balance across zones to avoid scale in and out fail attempts Availability High Preview Yes VMSS-7 - Configure Allocation Policy Spreading algorithm to Max Spreading System Efficiency Medium Preview Yes VMSS-8 - Deploy VMSS across availability zones with VMSS Flex Availability High Preview Yes VMSS-9 - Set Patch orchestration options to Azure-orchestrated Automation Low Preview Yes VMSS-10 - Upgrade VMSS Image versions scheduled to be deprecated or already retired Governance High Preview Yes VMSS-11 - Production VMSS instances should be using SSD disks System Efficiency High Preview Yes Definitions of states can be found here Recommendations Details VMSS-1 - Deploy VMSS with Flex orchestration mode instead of Uniform Category: System Efficiency\nImpact: Medium\nGuidance\nEven single instance VMs should be deployed into a scale set using the Flexible orchestration mode to future-proof your application for scaling and availability. Flexible orchestration offers high availability guarantees (up to 1000 VMs) by spreading VMs across fault domains in a region or within an Availability Zone.\nResources\nWhen to use VMSS instead of VMs Azure Well-Architected Framework review - Virtual Machines and Scale Sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all zonal VMs that are NOT deployed with Flex orchestration mode resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode != \u0026#34;Flexible\u0026#34; | project recommendationId = \u0026#34;vmss-1\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;orchestrationMode: \u0026#34;, tostring(properties.orchestrationMode)) VMSS-2 - Enable VMSS application health monitoring Category: Monitoring\nImpact: Medium\nGuidance\nMonitoring your application health is an important signal for managing and upgrading your deployment. Azure Virtual Machine Scale Sets provide support for Rolling Upgrades including Automatic OS-Image Upgrades and Automatic VM Guest Patching, which rely on health monitoring of the individual instances to upgrade your deployment. You can also use Application Health Extension to monitor the application health of each instance in your scale set and perform instance repairs using Automatic Instance Repairs.\nResources\nUsing Application Health extension with Virtual Machine Scale Sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that do NOT have health monitoring enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=leftouter ( resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | mv-expand extension=properties.virtualMachineProfile.extensionProfile.extensions | where extension.properties.type in ( \u0026#34;ApplicationHealthWindows\u0026#34;, \u0026#34;ApplicationHealthLinux\u0026#34; ) | project id ) on id | where id1 == \u0026#34;\u0026#34; | project recommendationId = \u0026#34;vmss-2\u0026#34;, name, id, tags, param1 = \u0026#34;extension: null\u0026#34; VMSS-3 - Enable Automatic Repair policy Category: Automation\nImpact: High\nGuidance\nEnabling automatic instance repairs for Azure Virtual Machine Scale Sets helps achieve high availability for applications by maintaining a set of healthy instances. The Application Health extension or Load balancer health probes may find that an instance is unhealthy. Automatic instance repairs will automatically perform instance repairs by deleting the unhealthy instance and creating a new one to replace it.\nGrace period is specified in minutes in ISO 8601 format and can be set using the property automaticRepairsPolicy.gracePeriod. Grace period can range between 10 minutes and 90 minutes, and has a default value of 30 minutes.\nResources\nAutomatic instance repairs for Azure Virtual Machine Scale Sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that do NOT have automatic repair policy enabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.automaticRepairsPolicy.enabled == false | project recommendationId = \u0026#34;vmss-3\u0026#34;, name, id, tags, param1 = \u0026#34;automaticRepairsPolicy: Disabled\u0026#34; VMSS-4 - Configure VMSS Autoscale to custom and configure the scaling metrics Category: System Efficiency\nImpact: High\nRecommendation\nUse Custom autoscale based on metrics and schedules.\nAutoscale is a built-in feature that helps applications perform their best when demand changes. You can choose to scale your resource manually to a specific instance count, or via a custom Autoscale policy that scales based on metric(s) thresholds, or schedule instance count which scales during designated time windows. Autoscale enables your resource to be performant and cost effective by adding and removing instances based on demand.\nResources\nGet started with autoscale in Azure Overview of autoscale in Azure Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when autoscale is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where isnull(autoscalesettings) or autoscalesettings.enabled == \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;vmss-4\u0026#34;, name, id, tags, param1 = \u0026#34;autoscalesettings: Disabled\u0026#34; | order by id asc VMSS-5 - Enable Predictive autoscale and configure at least for Forecast Only Category: System Efficiency\nImpact: Low\nGuidance\nPredictive autoscale uses machine learning to help manage and scale Azure Virtual Machine Scale Sets with cyclical workload patterns. It forecasts the overall CPU load to your virtual machine scale set, based on your historical CPU usage patterns. It predicts the overall CPU load by observing and learning from historical usage. This process ensures that scale-out occurs in time to meet the demand.\nResources\nUse predictive autoscale to scale out before load demands in virtual machine scale sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMSS instances associated with autoscale settings when predictiveAutoscalePolicy_scaleMode is disabled resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | project name, id, tags | join kind=leftouter ( resources | where type == \u0026#34;microsoft.insights/autoscalesettings\u0026#34; | where tostring(properties.targetResourceUri) contains \u0026#34;Microsoft.Compute/virtualMachineScaleSets\u0026#34; | project id = tostring(properties.targetResourceUri), autoscalesettings = properties ) on id | where autoscalesettings.enabled == \u0026#34;true\u0026#34; and autoscalesettings.predictiveAutoscalePolicy.scaleMode == \u0026#34;Disabled\u0026#34; | project recommendationId = \u0026#34;vmss-5\u0026#34;, name, id, tags, param1 = \u0026#34;predictiveAutoscalePolicy_scaleMode: Disabled\u0026#34; | order by id asc VMSS-6 - Disable Force strictly even balance across zones to avoid scale in and out fail attempts Category: Availability\nImpact: High\nGuidance\nMicrosoft recommends disabling the setting that enforces strictly even distribution of VM instances across Availability Zones within a region in your VMSS configuration. In other words, you should allow Azure to distribute VM instances unevenly across Availability Zones.\nForce strictly even balance across zones: Azure provides the option to distribute VM instances in a VMSS evenly across Availability Zones within a region. An Availability Zone is a physically separate data center within an Azure region with independent power, cooling, and networking. This configuration enhances the availability and fault tolerance of your applications.\nScale in and out fail attempts: In the context of VMSS, \u0026ldquo;scaling in\u0026rdquo; refers to reducing the number of VM instances when demand decreases, while \u0026ldquo;scaling out\u0026rdquo; refers to increasing the number of instances when demand increases. Scaling is an important feature of VMSS, and it can be automatic based on various scaling rules and metrics.\nWhile Azure VMSS provides the option to enforce even distribution of VM instances across Availability Zones for increased resilience, there may be scenarios where disabling this option makes sense to better align with your application\u0026rsquo;s load distribution and scaling requirements.\nResources\nUse scale-in policies with Azure Virtual Machine Scale Sets Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMSS instances where strictly zoneBalance is set to True resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode == \u0026#34;Uniform\u0026#34; and properties.zoneBalance == true | project recommendationId = \u0026#34;vmss-6\u0026#34;, name, id, tags, param1 = \u0026#34;strictly zoneBalance: Enabled\u0026#34; | order by id asc VMSS-7 - Configure Allocation Policy Spreading algorithm to Max Spreading Category: System Efficiency\nImpact: Medium\nGuidance\nWith max spreading, the scale set spreads your VMs across as many fault domains as possible within each zone. This spreading could be across greater or fewer than five fault domains per zone. With static fixed spreading, the scale set spreads your VMs across exactly five fault domains per zone. If the scale set cannot find five distinct fault domains per zone to satisfy the allocation request, the request fails.\nResources\nAvailability Considerations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMSS instances where Spreading algorithm is set to Static resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.platformFaultDomainCount \u0026gt; 1 | project recommendationId = \u0026#34;vmss-7\u0026#34;, name, id, tags, param1 = \u0026#34;platformFaultDomainCount: Static\u0026#34; | order by id asc VMSS-8 - Deploy VMSS across availability zones with VMSS Flex Category: Availability\nImpact: High\nGuidance\nWhen you create your VMSS, use availability zones to protect your applications and data against unlikely datacenter failure.\nResources\nCreate a Virtual Machine Scale Set that uses Availability Zones Update scale set to add availability zones Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMSS instances with one or no Zones selected resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where array_length(zones) \u0026lt;= 1 or isnull(zones) | project recommendationId = \u0026#34;vmss-8\u0026#34;, name, id, tags, param1 = \u0026#34;AvailabilityZones: Single Zone\u0026#34; | order by id asc VMSS-9 - Set Patch orchestration options to Azure-orchestrated Category: Automation\nImpact: Low\nGuidance\nEnabling automatic VM guest patching for your Azure VMs helps ease update management by safely and automatically patching virtual machines to maintain security compliance, while limiting the blast radius of VMs. Note that the KQL below will not return Virtual Machine Scale Sets using Uniform orchestration.\nResources\nAutomatic VM Guest Patching for Azure VMs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=inner ( resources | where type == \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties ) on id | extend recommendationId = \u0026#34;vmss-9\u0026#34;, param1 = \u0026#34;patchMode: Manual\u0026#34;, vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode | where isnotnull(vmproperties.osProfile.linuxConfiguration) and vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode !in (\u0026#34;AutomaticByPlatform\u0026#34;, \u0026#34;AutomaticByOS\u0026#34;) | distinct recommendationId, name, id, param1 | union (resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | join kind=inner ( resources | where type == \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project id = tostring(properties.virtualMachineScaleSet.id), vmproperties = properties ) on id | extend recommendationId = \u0026#34;vmss-9\u0026#34;, param1 = \u0026#34;patchMode: Manual\u0026#34;, vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode | where isnotnull(vmproperties.osProfile.windowsConfiguration) and vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode !in (\u0026#34;AutomaticByPlatform\u0026#34;, \u0026#34;AutomaticByOS\u0026#34;) | distinct recommendationId, name, id, param1) VMSS-10 - Upgrade VMSS Image versions scheduled to be deprecated or already retired Category: Governance\nImpact: High\nGuidance\nEnsure current versions of images are in use to avoid disruption after image deprecation. This ensures that if these images are deprecated that you will not be impacted as you will no longer be able to deploy any additional VMs or VMSS once the image has been deprecated.\nResources\nDeprecated Azure Marketplace images Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // This query will check if the VMSS are currently using the latest image. If not the Image reference will be empty resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | extend VMSSName = name | extend ImageReference = tostring(properties.virtualMachineProfile.storageProfile.imageReference.version) | project recommendationId=\u0026#34;vmss-10\u0026#34;,name,id, tags, param1=\u0026#34;ImageReference\u0026#34; VMSS-11 - Production VMSS instances should be using SSD disks Category: System Efficiency\nImpact: High\nGuidance\nIt is advised that you use SSD disks for Production workloads. Using HDD could impact your resources as it should only be used for non-critical resources and for resources that require infrequent access.\nResources\nDisk Comparison Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMSSs Uniform not using SSD storage resources | where type == \u0026#34;microsoft.compute/virtualmachinescalesets\u0026#34; | where properties.orchestrationMode != \u0026#34;Flexible\u0026#34; | where properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType == \u0026#39;Standard_LRS\u0026#39; | project recommendationId = \u0026#34;vmss-11\u0026#34;, name, id, tags "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/virtual-machines/",
	"title": "Virtual Machines",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Virtual Machines and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Virtual Machines and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available VM-1 - Run production workloads on two or more VMs using VMSS Flex Availability High Verified Yes VM-2 - Deploy VMs across Availability Zones Availability High Verified Yes VM-3 - Migrate VMs using availability sets to VMSS Flex Availability High Verified Yes VM-4 - Replicate VMs using Azure Site Recovery Disaster Recovery Medium Verified Yes VM-5 - Use Managed Disks for Virtual Machine disks Availability High Verified Yes VM-6 - Host application or database data on a data disk System Efficiency Low Verified Yes VM-7 - Enable Backups on your VMs Disaster Recovery Medium Verified Yes VM-8 - Production VMs should be using SSD disks System Efficiency High Verified Yes VM-9 - There are VMs in Stopped state Governance Low Verified Yes VM-10 - Accelerated Networking is not enabled System Efficiency Medium Verified Yes VM-11 - Accelerated Networking is enabled, make sure you update the GuestOS NIC driver every 6 months Governance Low Verified No VM-12 - VMs should not have a Public IP directly associated Access \u0026amp; Security Medium Verified Yes VM-13 - VM network interfaces and associated subnets both have a Network Security Group (NSG) associated Access \u0026amp; Security Low Verified No VM-14 - IP Forwarding should only be enabled for Network Virtual Appliances Access \u0026amp; Security Medium Verified Yes VM-15 - Customer DNS Servers should be configured in the Virtual Network level Networking Low Verified Yes VM-16 - Shared disks should only be enabled in Clustered servers Storage Medium Verified Yes VM-17 - The Network access to the VM disk is set to Enable Public access from all networks Access \u0026amp; Security Low Verified Yes VM-18 - Virtual Machine is not compliant with Azure Policies Governance Low Verified Yes VM-19 - Enable disk encryption, Enable data at rest encryption by default Access \u0026amp; Security Medium Verified Yes VM-20 - Enable Insights to get more visibility into the health and performance of your virtual machine Monitoring Low Verified Yes VM-21 - Configure diagnostic settings for all Azure Virtual Machines Monitoring Low Preview Yes VM-22 - Use maintenance configurations for the Virtual Machine Governance High Preview Yes VM-23 - Avoid using A or B-Series VM Sku for production VMs that need the full performance of the CPU continuously System Efficiency High Preview Yes VM-24 - Mission Critical Workloads should be using Premium or Ultra Disks System Efficiency High Preview Yes VM-25 - Do not create more than 2500 Citrix VDA servers per subscription Application Resiliency High Preview Yes VM-26 - Ensure all VMs part of a SQL Always-on cluster have the same specifications and configurations Application Resiliency High Preview No VM-27 - Use Azure Boost VMs for Maintenance sensitive workload Availability Medium Preview No VM-28 - Enable Scheduled Events for Maintenance sensitive workload VMs Availability Medium Preview No Definitions of states can be found here Recommendations Details VM-1 - Run production workloads on two or more VMs using VMSS Flex Category: Availability\nImpact: High\nGuidance\nProduction VM workloads should be deployed on multiple VMs and grouped together in a VMSS Flex instance. VMSS Flex intelligently distributes VMs across the platform to minimize the impact of platform faults and platform updates on a workload. A workload running on single instance VMs, even when those instances are spread across availability zones, cannot receive the same protection because the platform has no way of knowing the VMs are related to each other.\nResources\nWhat has changed with Flexible orchestration mode Attach or detach a Virtual Machine to or from a Virtual Machine Scale Set Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that are not associated with a VMSS Flex instance resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.virtualMachineScaleSet) | project recommendationId=\u0026#34;vm-1\u0026#34;, name, id, tags VM-2 - Deploy VMs across Availability Zones Category: Availability\nImpact: High\nGuidance\nAzure Availability Zones are physically separate locations within each Azure region that are tolerant to local failures. Use availability zones to protect your applications and data against unlikely datacenter failures.\nResources\nCreate virtual machines in an availability zone using the Azure portal Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that are not assigned to a Zone Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(zones) | project recommendationId=\u0026#34;vm-2\u0026#34;, name, id, tags, param1=\u0026#34;No Zone\u0026#34; VM-3 - Migrate VMs using availability sets to VMSS Flex Category: Availability\nImpact: High\nGuidance\nAvailability sets will be retired in the near future. Modernize your workloads by migrating them from VMs to VMSS Flex. With VMSS Flex, you can deploy your VMs in one of two ways:\n. Across zones . In the same zone, but across fault domains (FDs) and update domains (UD) automatically.\nIn an N-tier application, it\u0026rsquo;s recommended that you place each application tier into its own VMSS Flex.\nResources\nResiliency checklist for Virtual Machines Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs using Availability Sets resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.availabilitySet) | project recommendationId = \u0026#34;vm-3\u0026#34;, name, id, tags, param1=strcat(\u0026#34;availabilitySet: \u0026#34;,properties.availabilitySet.id) VM-4 - Replicate VMs using Azure Site Recovery Category: Disaster Recovery\nImpact: Medium\nGuidance\nWhen you replicate Azure VMs using Site Recovery, all the VM disks are continuously replicated to the target region asynchronously. The recovery points are created every few minutes. This gives you a Recovery Point Objective (RPO) in the order of minutes. You can conduct disaster recovery drills as many times as you want, without affecting the production application or the ongoing replication.\nResources\nResiliency checklist for Virtual Machines Run a test failover (disaster recovery drill) to Azure Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that do NOT have replication with ASR enabled // Run query to see results. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project name, id, tags | join kind=leftouter ( recoveryservicesresources | where type =~ \u0026#39;Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectedItems\u0026#39; | where properties.providerSpecificDetails.dataSourceInfo.datasourceType =~ \u0026#39;AzureVm\u0026#39; | project id=properties.providerSpecificDetails.dataSourceInfo.resourceId | extend name=strcat_array(array_slice(split(id, \u0026#39;/\u0026#39;), 8, -1), \u0026#39;/\u0026#39;) ) on name | where isnull(id1) | project-away id1 | project-away name1 | project recommendationId = \u0026#34;vm-4\u0026#34;, name, id, tags | order by id asc VM-5 - Use Managed Disks for VM disks Category: Availability\nImpact: High\nGuidance\nManaged disks provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure. Also, managed disks aren\u0026rsquo;t subject to the IOPS limits of VHDs created in a storage account.\nResources\nResiliency checklist for Virtual Machines Availability options for Azure Virtual Machines Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that are not using Managed Disks Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnull(properties.storageProfile.osDisk.managedDisk) | project recommendationId = \u0026#34;vm-5\u0026#34;, name, id, tags VM-6 - Host application or database data on a data disk Category: System Efficiency\nImpact: Low\nGuidance\nA data disk is a managed disk that\u0026rsquo;s attached to a virtual machine to store application data, or other data you need to keep. Data disks are registered as SCSI drives and are labeled with a letter that you choose. Hosting you data on a data disk also helps with flexibility when backuping or restoring data, as well as migrating the disk without having to migrate the entire Virtual Machine and Operating System. You will be able to also select a different disk sku, with different type, size, and performance that meet your requirements.\nResources\nIntroduction to Azure managed disks - Data disks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that only have a single Disk Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where array_length(properties.storageProfile.dataDisks) \u0026lt; 1 | project recommendationId = \u0026#34;vm-6\u0026#34;, name, id, tags VM-7 - Backup VMs with Azure Backup service Category: Disaster Recovery\nImpact: Medium\nGuidance\nEnable backups for your virtual machines to secure and quickly recover your data. The Azure Backup service provides simple, secure, and cost-effective solutions to back up your data and recover it from the Microsoft Azure cloud.\nResources\nWhat is the Azure Backup service? Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that do NOT have Backup enabled // Run query to see results. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project name, id, tags | join kind=leftouter ( recoveryservicesresources | where type =~ \u0026#39;Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\u0026#39; | where properties.dataSourceInfo.datasourceType =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project idBackupEnabled=properties.sourceResourceId | extend name=strcat_array(array_slice(split(idBackupEnabled, \u0026#39;/\u0026#39;), 8, -1), \u0026#39;/\u0026#39;) ) on name | where isnull(idBackupEnabled) | project-away idBackupEnabled | project-away name1 | project recommendationId = \u0026#34;vm-7\u0026#34;, name, id, tags | order by id asc VM-8 - Production VMs should be using SSD disks Category: System Efficiency\nImpact: High\nGuidance\nPremium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. Standard SSD Disks are a cost-effective storage option optimized for workloads that need consistent performance at lower IOPS levels.\nIt is recommended that you:\nUse Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost. Use Premium SSD disks instead of Standard HDD disks with your premium-capable VMs. For any Single Instance VM using premium storage for all Operating System Disks and Data Disks, Azure guarantees VM connectivity of at least 99.9%. If you want to upgrade from Standard HDD to Premium SSD disks, consider the following issues:\nUpgrading requires a VM reboot and this process takes 3-5 minutes to complete. If VMs are mission-critical production VMs, evaluate the improved availability against the cost of premium disks. Resources\nAzure managed disk types Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all disks with StandardHDD sku attached to VMs Resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where sku.name == \u0026#39;Standard_LRS\u0026#39; and sku.tier == \u0026#39;Standard\u0026#39; | where managedBy != \u0026#34;\u0026#34; | project recommendationId = \u0026#34;vm-8\u0026#34;, name, id, tags, param1=strcat(\u0026#34;managedBy: \u0026#34;, managedBy) VM-9 - Review VMs in stopped state Category: Governance\nImpact: Low\nGuidance\nAzure Virtual Machines (VM) instances go through different states. There are provisioning and power states. If a Virtual Machine is not running that indicates the Virtual Machine might facing an issue or is no longer necessary and could be removed helping to reduce costs.\nResources\nStates and billing status of Azure Virtual Machines Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that are NOT running Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where properties.extended.instanceView.powerState.displayStatus != \u0026#39;VM running\u0026#39; | project recommendationId = \u0026#34;vm-9\u0026#34;, name, id, tags VM-10 - Enable Accelerated Networking (AccelNet) Category: System Efficiency\nImpact: Medium\nGuidance\nAccelerated networking enables single root I/O virtualization (SR-IOV) to a VM, greatly improving its networking performance. This high-performance path bypasses the host from the data path, which reduces latency, jitter, and CPU utilization for the most demanding network workloads on supported VM types.\nThis configuration is not always required, evaluate this option according to the workload requirements.\nResources\nAccelerated Networking (AccelNet) overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VM NICs that do not have Accelerated Networking enabled resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand nic = properties.networkProfile.networkInterfaces | project name, id, tags, lowerCaseNicId = tolower(nic.id), vmSize = tostring(properties.hardwareProfile.vmSize) | join kind = inner ( resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableAcceleratedNetworking == false | project nicName = split(id, \u0026#34;/\u0026#34;)[8], lowerCaseNicId = tolower(id) ) on lowerCaseNicId | summarize nicNames = make_set(nicName) by name, id, tostring(tags), vmSize | extend param1 = strcat(\u0026#34;NicName: \u0026#34;, strcat_array(nicNames, \u0026#34;, \u0026#34;)), param2 = strcat(\u0026#34;VMSize: \u0026#34;, vmSize) | project recommendationId = \u0026#34;vm-10\u0026#34;, name, id, tags, param1, param2 | order by id asc VM-11 - When AccelNet is enabled, you must manually update the GuestOS NIC driver Category: Governance\nImpact: Low\nGuidance\nWhen Accelerated Networking is enabled the default Azure Virtual Network interface in the GuestOS is replaced for a Mellanox and consecutively its driver is provided from a 3rd party vendor. Marketplace images maintained by Microsoft are offered with the latest version of Mellanox drivers, however, once the Virtual Machine is deployed, the customer is responsible for maintaining the driver up to date.\nResources\nAccelerated Networking (AccelNet) overview Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg VM-12 - VMs should not have a Public IP directly associated Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nIf a Virtual Machine requires outbound internet connectivity we recommend the use of NAT Gateway or Azure Firewall, this will help to increase security and resiliency of the service as both services have much higher availability and SNAT ports. For inbound internet connectivity we recommend using a load balancing solution such as Azure Load Balancer and Application Gateway.\nResources\nUse Source Network Address Translation (SNAT) for outbound connections Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs with PublicIPs directly associated with them Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where isnotnull(properties.ipConfigurations) | mv-expand ipconfig=properties.ipConfigurations | extend publicIp = tostring(ipconfig.properties.publicIPAddress.id) | where publicIp != \u0026#34;\u0026#34; | project name, nicId = tostring(id), publicIp ) on nicId | project recommendationId = \u0026#34;vm-12\u0026#34;, name, id, tags | order by id asc VM-13 - VM network interfaces and associated subnets both have a Network Security Group (NSG) associated Category: Access \u0026amp; Security\nImpact: Low\nGuidance\nUnless you have a specific reason to, we recommend that you associate a network security group to a subnet, or a network interface, but not both. Since rules in a network security group associated to a subnet can conflict with rules in a network security group associated to a network interface, you can have unexpected communication problems that require troubleshooting.\nResources\nHow network security groups filter network traffic Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Provides a list of virtual machines and associated NICs that do have an NSG associated to them and also an NSG associated to the subnet. Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where isnotnull(properties.networkSecurityGroup) | mv-expand ipConfigurations = properties.ipConfigurations, nsg = properties.networkSecurityGroup | project nicId = tostring(id), subnetId = tostring(ipConfigurations.properties.subnet.id), nsgName=split(nsg.id, \u0026#39;/\u0026#39;)[8] | parse kind=regex subnetId with \u0026#39;/virtualNetworks/\u0026#39; virtualNetwork \u0026#39;/subnets/\u0026#39; subnet | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/NetworkSecurityGroups\u0026#39; and isnotnull(properties.subnets) | project name, resourceGroup, subnet=properties.subnets | mv-expand subnet | project subnetId=tostring(subnet.id) ) on subnetId | project nicId | join kind=leftouter ( Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project vmName = name, vmId = id, tags, nicId = nic.id, nicName=split(nic.id, \u0026#39;/\u0026#39;)[8] | extend nicId = tostring(nicId) ) on nicId | project recommendationId = \u0026#34;vm-13\u0026#34;, name=vmName, id = vmId, tags, param1 = strcat(\u0026#34;nic-name=\u0026#34;, nicName) VM-14 - IP Forwarding should only be enabled for Network Virtual Appliances Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nIP forwarding enables the virtual machine network interface to:\nReceive network traffic not destined for one of the IP addresses assigned to any of the IP configurations assigned to the network interface.\nSend network traffic with a different source IP address than the one assigned to one of a network interface\u0026rsquo;s IP configurations.\nThe setting must be enabled for every network interface that is attached to the virtual machine that receives traffic that the virtual machine needs to forward. A virtual machine can forward traffic whether it has multiple network interfaces or a single network interface attached to it. While IP forwarding is an Azure setting, the virtual machine must also run an application able to forward the traffic, such as firewall, WAN optimization, and load balancing applications.\nResources\nEnable or disable IP forwarding Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VM NICs that have IPForwarding enabled. This feature is usually only required for Network Virtual Appliances Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | where properties.enableIPForwarding == true | project nicId = tostring(id) ) on nicId | project recommendationId = \u0026#34;vm-14\u0026#34;, name, id, tags | order by id asc VM-15 - Customer DNS Servers should be configured in the Virtual Network level Category: Storage\nImpact: Low\nGuidance\nConfigure the DNS Server in the Virtual Network to avoid inconsistency across the environment.\nResources\nName resolution for resources in Azure virtual networks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VM NICs that have DNS Server settings configured in any of the NICs Resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | where isnotnull(properties.networkProfile.networkInterfaces) | mv-expand nic=properties.networkProfile.networkInterfaces | project name, id, tags, nicId = nic.id | extend nicId = tostring(nicId) | join kind=inner ( Resources | where type =~ \u0026#39;Microsoft.Network/networkInterfaces\u0026#39; | project name, id, dnsServers = properties.dnsSettings.dnsServers | extend hasDns = array_length(dnsServers) \u0026gt;= 1 | where hasDns != 0 | project name, nicId = tostring(id) ) on nicId | project recommendationId = \u0026#34;vm-15\u0026#34;, name, id, tags | order by id asc VM-16 - Shared disks should only be enabled in clustered servers Category: Storage\nImpact: Medium\nGuidance\nAzure shared disks is a feature for Azure managed disks that enables you to attach a managed disk to multiple virtual machines (VMs) simultaneously. Attaching a managed disk to multiple VMs allows you to either deploy new or migrate existing clustered applications to Azure, and should only be used in those situations where the disk will be assigned to more than one Virtual Machine member of a Cluster.\nResources\nAzure Shared Disks Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Disks configured to be Shared. This is not an indication of an issue, but if a disk with this configuration is assigned to two or more VMs without a proper disk control mechanism (like a WSFC) it can lead to data loss resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where isnotnull(properties.maxShares) | project id, name, tags, lowerCaseDiskId = tolower(id), diskState = tostring(properties.diskState) | join kind = leftouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id) | join kind = fullouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand dataDisks = properties.storageProfile.dataDisks | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id) ) on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName) ) on lowerCaseDiskId | summarize vmNames = make_set(vmName) by name, id, tostring(tags), diskState | extend param1 = strcat(\u0026#34;DiskState: \u0026#34;, diskState), param2 = iif(isempty(vmNames[0]), \u0026#34;VMName: n/a\u0026#34;, strcat(\u0026#34;VMName: \u0026#34;, strcat_array(vmNames, \u0026#34;, \u0026#34;))) | project recommendationId = \u0026#34;vm-16\u0026#34;, name, id, tags, param1, param2 | order by id asc VM-17 - Network access to the VM disk should be set to Disable public access and enable private access Category: Access \u0026amp; Security\nImpact: Low\nGuidance\nRecommended changing to \u0026ldquo;Disable public access and enable private access\u0026rdquo; and creating a Private Endpoint\nResources\nRestrict import/export access for managed disks using Azure Private Link Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Disks with \u0026#34;Enable public access from all networks\u0026#34; enabled resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where properties.publicNetworkAccess == \u0026#34;Enabled\u0026#34; | project id, name, tags, lowerCaseDiskId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | project osDiskVmName = name, lowerCaseOsDiskId = tolower(properties.storageProfile.osDisk.managedDisk.id) | join kind = fullouter ( resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | mv-expand dataDisks = properties.storageProfile.dataDisks | project dataDiskVmName = name, lowerCaseDataDiskId = tolower(dataDisks.managedDisk.id) ) on $left.lowerCaseOsDiskId == $right.lowerCaseDataDiskId | project lowerCaseDiskId = coalesce(lowerCaseOsDiskId, lowerCaseDataDiskId), vmName = coalesce(osDiskVmName, dataDiskVmName) ) on lowerCaseDiskId | summarize vmNames = make_set(vmName) by name, id, tostring(tags) | extend param1 = iif(isempty(vmNames[0]), \u0026#34;VMName: n/a\u0026#34;, strcat(\u0026#34;VMName: \u0026#34;, strcat_array(vmNames, \u0026#34;, \u0026#34;))) | project recommendationId = \u0026#34;vm-17\u0026#34;, name, id, tags, param1 | order by id asc VM-18 - Ensure that your VMs are compliant with Azure Policies Category: Governance\nImpact: Low\nGuidance\nIt\u0026rsquo;s important to keep your virtual machine (VM) secure for the applications that you run. Securing your VMs can include one or more Azure services and features that cover secure access to your VMs and secure storage of your data. This article provides information that enables you to keep your VM and applications secure.\nResources\nPolicy-driven governance Azure Policy Regulatory Compliance controls for Azure Virtual Machines Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs in \u0026#34;NonCompliant\u0026#34; state with Azure Policies PolicyResources | where type =~ \u0026#34;Microsoft.PolicyInsights/policyStates\u0026#34; and properties.resourceType =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; and properties.complianceState =~ \u0026#34;NonCompliant\u0026#34; | project policyAssignmentName = properties.policyAssignmentName, policyDefinitionName = properties.policyDefinitionName, lowerCasePolicyDefinitionIdOfPolicyState = tolower(properties.policyDefinitionId), lowerCaseVmIdOfPolicyState = tolower(properties.resourceId) | join kind = leftouter ( PolicyResources | where type =~ \u0026#34;Microsoft.Authorization/policyDefinitions\u0026#34; | project lowerCasePolicyDefinitionId = tolower(id), policyDefinitionDisplayName = properties.displayName ) on $left.lowerCasePolicyDefinitionIdOfPolicyState == $right.lowerCasePolicyDefinitionId | project policyAssignmentName, policyDefinitionName, policyDefinitionDisplayName, lowerCaseVmIdOfPolicyState | join kind = leftouter ( Resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines\u0026#34; | project vmName = name, vmId = id, vmTags = tags, lowerCaseVmId = tolower(id) ) on $left.lowerCaseVmIdOfPolicyState == $right.lowerCaseVmId | extend param1 = strcat(\u0026#34;AssignmentName: \u0026#34;, policyAssignmentName), param2 = strcat(\u0026#34;DefinitionName: \u0026#34;, policyDefinitionDisplayName), // Align to Azure portal\u0026#39;s term. param3 = strcat(\u0026#34;DefinitionID: \u0026#34;, policyDefinitionName) // Align to Azure portal\u0026#39;s term. | project recommendationId = \u0026#34;vm-18\u0026#34;, name = vmName, id = vmId, tags = vmTags, param1, param2, param3 VM-19 - Enable disk encryption and data at rest encryption by default Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nThere are several types of encryption available for your managed disks, including Azure Disk Encryption (ADE), Server-Side Encryption (SSE) and encryption at host.\nAzure Disk Encryption helps protect and safeguard your data to meet your organizational security and compliance commitments. Azure Disk Storage Server-Side Encryption (also referred to as encryption-at-rest or Azure Storage encryption) automatically encrypts data stored on Azure managed disks (OS and data disks) when persisting on the Storage Clusters. Encryption at host ensures that data stored on the VM host hosting your VM is encrypted at rest and flows encrypted to the Storage clusters. Confidential disk encryption binds disk encryption keys to the virtual machine\u0026rsquo;s TPM and makes the protected disk content accessible only to the VM. Resources\nOverview of managed disk encryption options Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all disks that are not encrypted resources | where type == \u0026#34;microsoft.compute/disks\u0026#34; | extend encryptionType = properties.encryption.type | extend diskState = properties.diskState | where encryptionType !in (\u0026#34;EncryptionAtRestWithCustomerKey\u0026#34;, \u0026#34;EncryptionAtRestWithPlatformAndCustomerKeys\u0026#34;, \u0026#34;EncryptionAtRestWithPlatformKey\u0026#34;) | project recommendationId=\u0026#34;vm-19\u0026#34;, name, id, tags, param1=strcat(\u0026#34;encryptionType: \u0026#34; , properties.encryption.type), param2= strcat (\u0026#34;diskstate: \u0026#34;, properties.diskState) VM-20 - Enable VM Insights Category: Monitoring\nImpact: Low\nGuidance\nVM insights monitors the performance and health of your virtual machines and virtual machine scale sets. It monitors their running processes and dependencies on other resources. VM insights can help deliver predictable performance and availability of vital applications by identifying performance bottlenecks and network issues. It can also help you understand whether an issue is related to other dependencies.\nResources\nOverview of VM insights Did the extension install properly? Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VM-21 - Configure diagnostic settings for all Azure Virtual Machines Category: Monitoring\nImpact: Low\nGuidance\nPlatform metrics are sent automatically to Azure Monitor Metrics by default and without configuration. Platform logs provide detailed diagnostic and auditing information for Azure resources and the Azure platform they depend on:\nResource logs aren\u0026rsquo;t collected until they\u0026rsquo;re routed to a destination. Activity logs exist on their own but can be routed to other locations. Each Azure resource requires its own diagnostic setting, which defines the following criteria:\nSources: The type of metric and log data to send to the destinations defined in the setting. The available types vary by resource type. Destinations: One or more destinations to send to. A single diagnostic setting can define no more than one of each of the destinations. If you want to send data to more than one of a particular destination type (for example, two different Log Analytics workspaces), create multiple settings. Each resource can have up to five diagnostic settings.\nResources\nDiagnostic settings in Azure Monitor Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all Virtual Machines without diagnostic settings enabled/with diagnostic settings enabled but not configured both performance counters and event logs/syslogs. resources | where type =~ \u0026#34;microsoft.compute/virtualmachines\u0026#34; | project name, id, tags, lowerCaseVmId = tolower(id) | join kind = leftouter ( resources | where type =~ \u0026#34;Microsoft.Compute/virtualMachines/extensions\u0026#34; and properties.publisher =~ \u0026#34;Microsoft.Azure.Diagnostics\u0026#34; | project lowerCaseVmIdOfExtension = tolower(substring(id, 0, indexof(id, \u0026#34;/extensions/\u0026#34;))), extensionType = properties.type, provisioningState = properties.provisioningState, storageAccount = properties.settings.StorageAccount, // Windows wadPerfCounters = properties.settings.WadCfg.DiagnosticMonitorConfiguration.PerformanceCounters.PerformanceCounterConfiguration, wadEventLogs = properties.settings.WadCfg.DiagnosticMonitorConfiguration.WindowsEventLog, // Linux ladPerfCounters = properties.settings.ladCfg.diagnosticMonitorConfiguration.performanceCounters.performanceCounterConfiguration, ladSyslog = properties.settings.ladCfg.diagnosticMonitorConfiguration.syslogEvents | extend // Windows isWadPerfCountersConfigured = iif(array_length(wadPerfCounters) \u0026gt; 0, true, false), isWadEventLogsConfigured = iif(isnotnull(wadEventLogs) and array_length(wadEventLogs.DataSource) \u0026gt; 0, true, false), // Linux isLadPerfCountersConfigured = iif(array_length(ladPerfCounters) \u0026gt; 0, true, false), isLadSyslogConfigured = isnotnull(ladSyslog) | project lowerCaseVmIdOfExtension, extensionType, provisioningState, storageAccount, isPerfCountersConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadPerfCountersConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadPerfCountersConfigured, false), isEventLogsConfigured = case(extensionType =~ \u0026#34;IaaSDiagnostics\u0026#34;, isWadEventLogsConfigured, extensionType =~ \u0026#34;LinuxDiagnostic\u0026#34;, isLadSyslogConfigured, false) ) on $left.lowerCaseVmId == $right.lowerCaseVmIdOfExtension | where isempty(lowerCaseVmIdOfExtension) or provisioningState !~ \u0026#34;Succeeded\u0026#34; or not(isPerfCountersConfigured and isEventLogsConfigured) | extend param1 = strcat(\u0026#34;DiagnosticSetting: \u0026#34;, iif(isnotnull(extensionType), strcat(\u0026#34;Enabled, partially configured (\u0026#34;, extensionType, \u0026#34;)\u0026#34;), \u0026#34;Not enabled\u0026#34;)), param2 = strcat(\u0026#34;ProvisioningState: \u0026#34;, iif(isnotnull(provisioningState), provisioningState, \u0026#34;n/a\u0026#34;)), param3 = strcat(\u0026#34;storageAccount: \u0026#34;, iif(isnotnull(storageAccount), storageAccount, \u0026#34;n/a\u0026#34;)), param4 = strcat(\u0026#34;PerformanceCounters: \u0026#34;, case(isnull(isPerfCountersConfigured), \u0026#34;n/a\u0026#34;, isPerfCountersConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)), param5 = strcat(\u0026#34;EventLogs/Syslogs: \u0026#34;, case(isnull(isEventLogsConfigured), \u0026#34;n/a\u0026#34;, isEventLogsConfigured, \u0026#34;Configured\u0026#34;, \u0026#34;Not configured\u0026#34;)) | project recommendationId = \u0026#34;vm-21\u0026#34;, name, id, tags, param1, param2, param3, param4, param5 VM-22 - Use maintenance configurations for the VMs Category: Governance\nImpact: High\nGuidance\nThe maintenance configuration settings allows user to schedule and manage updates, ensuring the VM updates/interruptions are done in planned timeframe.\nResources\nUse maintenance configurations to control and manage the VM updates Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find VMS that do not have maintenance configuration assigned Resources | extend resourceId = tolower(id) | project name, location, type, id, tags, resourceId, properties | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | join kind=leftouter ( maintenanceresources | where type =~ \u0026#34;microsoft.maintenance/configurationassignments\u0026#34; | project planName = name, type, maintenanceProps = properties | extend resourceId = tostring(maintenanceProps.resourceId) ) on resourceId | where isnull(maintenanceProps) | project recommendationId = \u0026#34;vm-22\u0026#34;,name, id, tags | order by id asc VM-23 - Avoid using A or B-Series VM Sku for production VMs that need the full performance of the CPU continuously Category: System Efficiency\nImpact: Medium\nGuidance\nA-series VMs have CPU performance and memory configurations best suited for entry level workloads like development and test. Some example use cases include development and test servers, low traffic web servers, small to medium databases, proof-of-concepts, and code repositories.\nB-series VMs are ideal for workloads that do not need the full performance of the CPU continuously, like web servers, proof of concepts, small databases and development build environments. These workloads typically have burstable performance requirements. To determine the physical hardware on which this size is deployed, query the virtual hardware from within the virtual machine. The B-series provides you with the ability to purchase a VM size with baseline performance that can build up credits when it is using less than its baseline. When the VM has accumulated credits, the VM can burst above the baseline using up to 100% of the vCPU when your application requires higher CPU performance. Upon consuming all the CPU credits, a B-series virtual machine is throttled back to its base CPU performance until it accumulates the credits to CPU burst again.\nResources\nB-series burstable virtual machine sizes Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs using A or B series families resources | where type == \u0026#39;microsoft.compute/virtualmachines\u0026#39; | where properties.hardwareProfile.vmSize contains \u0026#34;Standard_B\u0026#34; or properties.hardwareProfile.vmSize contains \u0026#34;Standard_A\u0026#34; | project recommendationId = \u0026#34;vm-23\u0026#34;, name, id, tags, param1=strcat(\u0026#34;vmSku: \u0026#34; , properties.hardwareProfile.vmSize) VM-24 - Mission Critical Workloads should be using Premium or Ultra Disks Category: System Efficiency\nImpact: High\nGuidance\nAzure Premium SSDs deliver high-performance and low-latency disk support for virtual machines (VMs) with input/output (IO)-intensive workloads.\nPremium SSD v2 offers higher performance than Premium SSDs while also generally being less costly. You can individually tweak the performance (capacity, throughput, and IOPS) of Premium SSD v2 disks at any time, allowing workloads to be cost efficient while meeting shifting performance needs. You should use Premium solid-state drives (SSDs) as operating system (OS) disks as the V2 is not supported as OS Disk.\nAzure ultra disks are the highest-performing storage option for Azure virtual machines (VMs). You can change the performance parameters of an ultra disk without having to restart your VMs. Ultra disks are suited for data-intensive workloads such as SAP HANA, top-tier databases, and transaction-heavy workloads. Ultra disks must be used as data disks and can only be created as empty disks. You should use Premium solid-state drives (SSDs) as operating system (OS) disks.\nResources\nDisk type comparison and decision tree Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find all VMs that have an attached disk that is not in the Premium or Ultra sku tier. resources | where type =~ \u0026#39;Microsoft.Compute/virtualMachines\u0026#39; | extend lname = tolower(name) | join kind=leftouter(resources | where type =~ \u0026#39;Microsoft.Compute/disks\u0026#39; | where not(sku.tier =~ \u0026#39;Premium\u0026#39;) and not(sku.tier =~ \u0026#39;Ultra\u0026#39;) | extend lname = tolower(tostring(split(managedBy, \u0026#39;/\u0026#39;)[8])) | project lname, name | summarize disks = make_list(name) by lname) on lname | where isnotnull(disks) | project recommendationId = \u0026#34;vm-24\u0026#34;, name, id, tags, param1=strcat(\u0026#34;AffectedDisks: \u0026#34;, disks) VM-25 - Do not create more than 2500 Citrix VDA servers per subscription Category: Application Resilience\nImpact: High\nGuidance\nA Citrix Managed Azure subscription supports the number of machines indicated in Limits. (In this context, machines refers to VMs that have a Citrix VDA installed. These machines deliver apps and desktops to users. It does not include other machines in a resource location, such as Cloud Connectors.)\nIf your Citrix Managed Azure subscription is likely to reach its limit soon, and you have enough Citrix licenses, you can request another Citrix Managed Azure subscription. The dashboard contains a notification when you‚Äôre close to the limit.\nYou can‚Äôt create a catalog (or add machines to a catalog) if the total number of machines for all catalogs that use that Citrix Managed Azure subscription would exceed the value indicated in Limits.\nResources\nCitrix Limits Citrix Managed Azure subscriptions Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VM-26 - Ensure all VMs part of a SQL Always-on cluster have the same specifications and configurations Category: Availability\nImpact: High\nGuidance\nAll VMs that are members or a SQL Always-on cluster must use the same VM Sku, same number of data disks, same disks Skus, same number of Network Interfaces, same VM Extensions, etc.\nResources\nPrerequisites, restrictions, and recommendations for Always On availability groups Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VM-27 - Use Azure Boost VMs for Maintenance sensitive workload Category: Availability\nImpact: Medium\nGuidance\nIf the workload is Maintenance sensitive, please consider using Azure Boost compatible VMs. Azure Boost is designed to lessen the impact on customers when Azure maintenance activities occur.\nResources\nMicrosoft Azure Boost Announcing the general availability of Azure Boost Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VM-28 - Enable Scheduled Events for Maintenance sensitive workload VMs Category: Availability\nImpact: Medium\nGuidance\nIf the workload is Maintenance sensitive, please enable Scheduled Events. Scheduled Events is an Azure Metadata Service that gives your application time to prepare for virtual machine maintenance. It provides information about upcoming maintenance events (for example, reboot) so that your application can prepare for them and limit disruption. It\u0026rsquo;s available for all Azure Virtual Machines types, including PaaS and IaaS on both Windows and Linux.\nResources\nMonitor scheduled events for your Azure VMs Azure Metadata Service: Scheduled Events for Linux VMs Azure Metadata Service: Scheduled Events for Windows VMs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/virtual-networks/",
	"title": "Virtual Networks",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Virtual Networks and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Virtual Networks and associated Virtual Networks settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for Virtual Networks and associated resources.\nRecommendation Category Impact State ARG Query Available VNET-1 - All Subnets should have a Network Security Group associated Access \u0026amp; Security High Preview Yes VNET-2 - Use Azure DDoS Standard Protection Plans to protect all public endpoints hosted within customer Virtual Networks Access \u0026amp; Security High Preview Yes VNET-3 - Use Private Link, when available, for shared Azure PaaS services Access \u0026amp; Security Medium Preview No Definitions of states can be found here Recommendations Details VNET-1 - All Subnets should have a Network Security Group associated Category: Access \u0026amp; Security\nImpact: High\nGuidance\nNetwork security groups: Network security groups and application security groups can contain multiple inbound and outbound security rules that enable you to filter traffic to and from resources by source and destination IP address, port, and protocol. NSG\u0026rsquo;s provide a security layer on Subnet level. Note that the following subnets are excluded(ignored) because applying NSG on these subnets is not supported: GatewaySubnet, AzureFirewallSubnet, AzureFirewallManagementSubnet, RouteServerSubnet.\nResources\nAzure Virtual Network - Concepts and best practices | Microsoft Learn GatewaySUbnet Can I associate a network security group (NSG) to the RouteServerSubnet? Are Network Security Groups (NSGs) supported on the AzureFirewallSubnet? Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Subnets without NSG associated resources | where type =~ \u0026#39;Microsoft.Network/virtualnetworks\u0026#39; | mv-expand subnets = properties.subnets | extend sn = string_size(subnets.properties.networkSecurityGroup) | where sn == 0 and subnets.name !in (\u0026#34;GatewaySubnet\u0026#34;, \u0026#34;AzureFirewallSubnet\u0026#34;, \u0026#34;AzureFirewallManagementSubnet\u0026#34;, \u0026#34;RouteServerSubnet\u0026#34;) | project recommendationId = \u0026#34;vnet-1\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;SubnetName: \u0026#34;, subnets.name), param2 = \u0026#34;NSG: False\u0026#34; VNET-2 - Use Azure DDoS Standard Protection Plans to protect all public endpoints hosted within customer Virtual Networks Category: Access \u0026amp; Security\nImpact: High\nGuidance\nAzure DDoS Protection, combined with application design best practices, provides enhanced DDoS mitigation features to defend against DDoS attacks. It\u0026rsquo;s automatically tuned to help protect your specific Azure resources in a virtual network.\nResources\nReliability and Azure Virtual Network - Microsoft Azure Well-Architected Framework | Microsoft Learn Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find virtual networks without DDoS Protection resources | where type =~ \u0026#39;Microsoft.Network/virtualNetworks\u0026#39; | where isnull(properties.enableDdosProtection) or properties.enableDdosProtection contains \u0026#34;false\u0026#34; | project recommendationId = \u0026#34;vnet-2\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;EnableDdosProtection: \u0026#34;, properties.enableDdosProtection) VNET-3 - When available, use Private Endpoints instead of Service Endpoints for PaaS Services Category: Access \u0026amp; Security\nImpact: Medium\nGuidance\nUse virtual network service endpoints only when Private Link isn\u0026rsquo;t available and there are no concerns with unauthorized movement of data. The VNet service endpoint feature (turning on VNet service endpoint on the network side and setting up appropriate VNet ACLs on the Azure service side) limits the Azure service access to the allowed VNet and subnet, thus providing a network level security and isolation of the Azure service traffic. All traffic using VNet service endpoints flows over Microsoft backbone, thus providing another layer of isolation from the public internet\nResources\nAzure Virtual Network FAQ | Microsoft Learn Reliability and Network connectivity - Microsoft Azure Well-Architected Framework | Microsoft LearnNetworking Reliability Azure Private Link availability Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Find Subnets with Service Endpoint enabled for services that offer Private Link resources | where type =~ \u0026#39;Microsoft.Network/virtualnetworks\u0026#39; | mv-expand subnets = properties.subnets | extend se = array_length(subnets.properties.serviceEndpoints) | where se \u0026gt;= 1 | project name, id, tags, subnets, serviceEndpoints=todynamic(subnets.properties.serviceEndpoints) | mv-expand serviceEndpoints | project name, id, tags, subnetName=subnets.name, serviceName=tostring(serviceEndpoints.service) | where serviceName in (parse_json(\u0026#39;[\u0026#34;Microsoft.CognitiveServices\u0026#34;,\u0026#34;Microsoft.AzureCosmosDB\u0026#34;,\u0026#34;Microsoft.DBforMariaDB\u0026#34;,\u0026#34;Microsoft.DBforMySQL\u0026#34;,\u0026#34;Microsoft.DBforPostgreSQL\u0026#34;,\u0026#34;Microsoft.EventHub\u0026#34;,\u0026#34;Microsoft.KeyVault\u0026#34;,\u0026#34;Microsoft.ServiceBus\u0026#34;,\u0026#34;Microsoft.Sql\u0026#34;, \u0026#34;Microsoft.Storage\u0026#34;,\u0026#34;Microsoft.StorageSync\u0026#34;,\u0026#34;Microsoft.Synapse\u0026#34;,\u0026#34;Microsoft.Web\u0026#34;]\u0026#39;)) | project recommendationId = \u0026#34;vnet-3\u0026#34;, name, id, tags, param1 = strcat(\u0026#34;subnet=\u0026#34;, subnetName), param2=strcat(\u0026#34;serviceName=\u0026#34;,serviceName), param3=\u0026#34;ServiceEndpoints=true\u0026#34; "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/vpn-gateway/",
	"title": "VPN Gateway",
	"tags": null,
	"description": "Best practices and resiliency recommendations for VPN Gateway and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include VPN Gateway and associated VPN Gateway settings.\nSummary of Recommendations The below table shows the list of resiliency recommendations for VPN Gateway and associated resources.\nRecommendation Category Impact State ARG Query Available VPNG-1 - Choose a Zone-redundant gateway Availability High Preview Yes VPNG-2 - Plan for Active-Active mode Availability High Preview Yes VPNG-3 - Plan for Site-to-Site VPN and Azure ExpressRoute coexisting connection Disaster Recovery High Preview No VPNG-4 - Plan for geo-redundant VPN Connections Disaster Recovery High Preview No VPNG-5 - Monitor connections and gateway health Monitoring Medium Preview No VPNG-6 - Enable service health Monitoring Medium Preview No Definitions of states can be found here Recommendations Details VPNG-1 - Choose a Zone-redundant gateway Category: Availability\nImpact: High\nGuidance\nAzure VPN gateway provides different SLAs when it\u0026rsquo;s deployed in a single availability zone and when it\u0026rsquo;s deployed in two or more availability zones. For information about all Azure SLAs, see SLA summary for Azure services. To automatically deploy your virtual network gateways across availability zones, you can use zone-redundant virtual network gateways. With zone-redundant gateways, you can benefit from zone-resiliency to access your mission-critical, scalable services on Azure.\nResources\nZone redundant Virtual network gateway in availability zone Gateway SKU Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // For all VNGs of type Vpn, show any that do not have AZ in the SKU tier resources | where type =~ \u0026#34;Microsoft.Network/virtualNetworkGateways\u0026#34; | where properties.gatewayType == \u0026#34;Vpn\u0026#34; | where properties.sku.tier !contains \u0026#39;AZ\u0026#39; | project recommendationId = \u0026#34;vpng-1\u0026#34;, name, id, tags, param1= strcat(\u0026#34;sku-tier: \u0026#34; , properties.sku.tier), param2=location | order by id asc VPNG-2 - Plan for Active-Active mode Category: Availability\nImpact: High\nGuidance\nThe active-active mode is available for all SKUs except Basic or Standard. Active-active gateways have two Gateway IP configurations and two public IP addresses.\nResources\nActive-active VPN gateway Gateway SKU Resource Graph Query/Scripts\nShow/Hide Query/Script Copy resources | where type =~ \u0026#39;Microsoft.Network/virtualNetworkGateways\u0026#39; | where properties.gatewayType =~ \u0026#34;vpn\u0026#34; | extend gatewayType = properties.gatewayType, vpnType = properties.vpnType, connections = properties.connections, activeactive=properties.activeActive | where activeactive == false | project recommendationId = \u0026#34;vpng-2\u0026#34;, name, id, tags VPNG-3 - Plan for Site-to-Site VPN and Azure ExpressRoute coexisting connection Category: Disaster Recovery\nImpact: High\nGuidance\nDuring the initial planning phase, you want to decide whether you want to configure an ExpressRoute connection. An Azure ExpressRoute circuit provide a private dedicated connection into Azure.You also need to identify the bandwidth and the SKU type requirement for your business needs. Configure a Site-to-Site VPN as a failover path for ExpressRoute\nResources\nConfigure a Site-to-Site VPN as a failover path for ExpressRoute Limit and limitations Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VPNG-4 - Plan for geo-redundant VPN connections Category: Disaster Recovery\nImpact: High\nGuidance\nTo plan for disaster recovery, set up Site-to-Site VPN in more than one location. You can create IP Sec connectivity in the same metro or different metro and choose to work with different service providers for diverse paths\nResources\nHighly available cross-premises About VPN gateway redundancy Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VPNG-5 - Monitor connections and gateway health Category: Monitoring\nImpact: Medium\nGuidance\nSet up monitoring and alerts for Virtual Network Gateway health based on various metrics available.\nResources\nVPN gateway data reference Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development VPNG-6 - Enable service health Category: Monitoring\nImpact: Medium\nGuidance\nVPN Gateway uses service health to notify about planned and unplanned maintenance. Configuring service health will notify you about changes made to your VPN connectivity.\nResources\nGetting started with Azure Metrics Explorer Monitor VPN gateway Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/web/web-app/",
	"title": "Web App",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Web App and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Web App and associated settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available APP-1 - Enable diagnostics logging Monitoring Low Preview Yes APP-2 - Monitor performance Monitoring Medium Preview Yes APP-3 - Separate web apps from web APIs System Efficiency Low Preview No APP-4 - Create a separate storage account for logs System Efficiency Medium Preview No APP-5 - Deploy to a staging slot Governance Medium Preview Yes APP-6 - Store configuration as app settings Application Resilience Medium Preview Yes Definitions of states can be found here Recommendations Details App-1 - Enable diagnostics logging Category: Monitoring\nImpact: Low\nGuidance\nEnabling diagnostics logging for your Azure App Service is important for monitoring and diagnostics purposes. It includes application logging and web server logging.\nResources\nEnable diagnostics logging for apps in Azure App Service Show/Hide Query/Script Copy // under development App-2 - Monitor Performance Category: Monitoring\nImpact: Medium\nGuidance\nUse a performance monitoring service such Application Insights to monitor application performance and behavior under load. Performance monitoring gives you real-time insight into the application. It enables you to diagnose issues and perform root-cause analysis of failures.\nEnable monitoring on your web applications based on ASP.NET, ASP.NET Core, Java, and Node.js running on Azure App Service. Previously, you needed to manually instrument your app, but the latest extension/agent is now built into the App Service image by default.\nResources\nApplication Insights Application monitoring for Azure App Service Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // under-development App-3 - Separate web apps from web APIs Category: System Efficiency\nImpact: Low\nGuidance\nIf your solution has both a web front end and a web API, consider decomposing them into separate App Service apps. This design makes it easier to decompose the solution by workload. You can run the web app and the API in separate App Service plans, so they can be scaled independently. If you don\u0026rsquo;t need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.\nResources\nResiliency checklist for specific Azure services Show/Hide Query/Script Copy // cannot-be-validated-with-arg App-4 - Create a separate storage account for logs Category: System Efficiency\nImpact: Medium\nGuidance\nCreate a separate storage account for logs. Don\u0026rsquo;t use the same storage account for logs and application data. This helps to prevent logging from reducing application performance.\nResources\nResiliency checklist Show/Hide Query/Script Copy // cannot-be-validated-with-arg App-5 - Deploy to a staging slot Category: Governance\nImpact: Medium\nGuidance\nCreate a deployment slot for staging. Deploy application updates to the staging slot, and verify the deployment before swapping it into production. This reduces the chance of a bad update in production. It also ensures that all instances are warmed up before being swapped into production. Many applications have a significant warmup and cold-start time. For more information\nConsider creating a deployment slot to hold the last-known-good (LKG) deployment. When you deploy an update to production, move the previous production deployment into the LKG slot. This makes it easier to roll back a bad deployment. If you discover a problem later, you can quickly revert to the LKG version. Resources\nSet up staging environments in Azure App Service Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // Azure Resource Graph Query // Display App Service with the count of deployment slots for Apps under eligible App service plans and it shows if deployment slot is enabled or not resources | where type =~ \u0026#39;microsoft.web/sites\u0026#39; or type =~ \u0026#39;microsoft.web/sites/slots\u0026#39; | extend isSlot = iff(type =~ \u0026#39;microsoft.web/sites/slots\u0026#39;, 1, 0) | extend AspName = iff(isSlot == 1, split(name, \u0026#39;/\u0026#39;)[0], name) | extend Sku = tostring(properties.sku) | where tolower(Sku) contains \u0026#34;standard\u0026#34; or tolower(Sku) contains \u0026#34;premium\u0026#34; or tolower(Sku) contains \u0026#34;isolatedv2\u0026#34; | project id, name, AspName, isSlot, Sku | summarize Slots = countif(isSlot == 1) by id, name, AspName, Sku | extend DeploymentSlotEnabled = iff(Slots \u0026gt; 1, true, false) | where DeploymentSlotEnabled = false | project recommendationId=\u0026#34;app-5\u0026#34;, name, id, tags=\u0026#34;\u0026#34;, param1=Sku, param2=Slots, param3=\u0026#34;DeploymentSlotEnabled=false\u0026#34; App-6 - Store configuration as app settings Category: Application Resilience\nImpact: Medium\nGuidance\nUse app settings to hold configuration settings as app settings. Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.\nResources\nConfigure web apps in Azure App Service Show/Hide Query/Script Copy // Azure Resource Graph Query //Provides a list of Azure App Service resources that don\u0026#39;t have App Settings configured appserviceresources | where type == \u0026#34;microsoft.web/sites/config\u0026#34; | extend AppSettings = iif(isempty(properties.AppSettings), true, false) | where AppSettings == false | project recommendationId=\u0026#34;app-6\u0026#34;, id, name, tags=\u0026#34;\u0026#34;, param1=\u0026#34;AppSettings is not configured\u0026#34; "
},
{
	"uri": "http://localhost:1313/Azure-Proactive-Resiliency-Library/services/networking/web-application-firewall/",
	"title": "Web Application Firewall",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Web Application Firewall and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Web Application Firewall and dependent resources and settings.\nSummary of Recommendations Recommendation Category Impact State ARG Query Available WAF-1 - Review logs for Web Application Firewall on Azure Front Door for legitimate requests that are blocked Monitoring Medium Preview No WAF-2 - Review logs for Web Application Firewall on Azure Application Gateway for legitimate requests that are blocked Monitoring Medium Preview No WAF-3 - Monitor Web Application Firewall Monitoring Medium Preview No Definitions of states can be found here Recommendations Details WAF-1 - Review logs for Web Application Firewall on Azure Front Door for legitimate requests that are blocked Category: Monitoring\nImpact: Medium\nGuidance\nWAF could block a legitimate request that it shouldn\u0026rsquo;t (a false positive). You can identify requests that have been blocked within the last 24 hours through Log Analytics.\nResources\nAzure Web Application Firewall monitoring and logging - Access Log Understanding WAF logs Web Application Firewall exclusion lists Fixing a false positive Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg WAF-2 - Review logs for Web Application Firewall on Azure Application Gateway for legitimate requests that are blocked Category: Monitoring\nImpact: Medium\nGuidance\nWAF could block a legitimate request that it shouldn\u0026rsquo;t (a false positive). You can identify requests that have been blocked within the last 24 hours through Log Analytics.\nResources\nAzure Web Application Firewall Monitoring and Logging Diagnostic logs Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg WAF-3 - Monitor Web Application Firewall Category: Monitoring\nImpact: Medium\nGuidance\nMonitoring the health of your WAF and the applications that it protects is important. Health monitoring is supported by integration with Microsoft Defender for Cloud, Azure Monitor, and Azure Monitor logs.\nResources\nWAF monitoring Azure Monitor Workbook for WAF Resource Graph Query/Scripts\nShow/Hide Query/Script Copy // cannot-be-validated-with-arg "
}]
