[
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/",
	"title": "Azure Services",
	"tags": null,
	"description": "The landing page for all Azure Services covered as part of APRL",
	"content": "This page lists all of the Azure Services for which the APRL has guidance, recommendations and queries for. All of the services are grouped by the same categorization as the Azure Portal uses.\nCategories List\rAI and ML Compute Containers Databases General Hybrid Integration IoT Networking Security Specialized Workloads Storage Web "
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/",
	"title": "Home",
	"tags": null,
	"description": "Welcome to the home of the Azure Proactive Resiliency Library (APRL)",
	"content": "Welcome to the home of the Azure Proactive Resiliency Library (APRL).\nThis library is built with the intention of being a staging area for guidance and recommendations that can be used by customers, partners and the field in Well-Architected Framework reliability engagements/assessments; with the intent of the guidance and recommendations being promoted, once tested and validated with customers and partners, into the official Well-Architected Framework documentation.\nThe library also contains supporting Azure Resource Graph (ARG) queries, and sometimes Azure PowerShell or Azure CLI scripts, that can help customers, partners and the field identify resources that may or may not be compliant with the guidance and recommendations. The intent for these queries, in the long-term, is to make them part of the Azure Advisor service.\nGet Started\rTo get started head over to the Azure Services section and then navigate via the appropriate category to find guidance, recommendations alongside supporting Azure Resource Graph queries, Azure PowerShell or Azure CLI scripts to help you discover compliant/non-compliant resources in your environment.\nYou can also use the basic search functionality provided by this site to locate the Azure service you are looking for guidance, recommendations and supporting queries and scripts for.\rContributing\rPlease see the contribution guide here.\nPlease note that this site is built upon GithHub Pages using Hugo which is using the Ace Documentation theme\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/contributing/",
	"title": "Contributing",
	"tags": null,
	"description": "Contribution Guide for the Azure Proactive Resiliency Library (APRL)",
	"content": "\rContributions Notice\rCurrently we can only accept contributions from Microsoft FTEs. In the future we will look to change this.\rLooking to contribute to the Azure Proactive Resiliency Library (APRL), well you have made it to the right place/page üëç\nFollow the below instructions, especially the pre-requisites, to get started contributing to the library.\nContext/Background\rBefore jumping into the pre-requisites and specific section contribution guidance, please familiarize yourself with this context/background on how this library is built to help you contribute going forward.\nThis site is built using Hugo, a static site generator, that\u0026rsquo;s source code is stored in the APRL GitHub repo (link in header of this site too) and is hosted on GitHub Pages, via the repo.\nThe reason for the combination of Hugo \u0026amp; GitHub pages is to allow us to present an easy to navigate and consume library, rather than using a native GitHub repo, which is not easy to consume when there are lots of pages and folders. Also Hugo generates the site in such a way that it is also friendly for mobile consumers.\nBut I don\u0026rsquo;t have any skills in Hugo?\rThat\u0026rsquo;s okay and you really don\u0026rsquo;t need them. Hugo just needs you to be able to author markdown (.md) files and it does the rest when it generates the site üëç\nPre-Requisites\rRead and follow the below sections to leave you in a \u0026ldquo;ready state\u0026rdquo; to contribute to APRL.\nA \u0026ldquo;ready state\u0026rdquo; means you have a forked copy of the Azure/Azure-Proactive-Resiliency-Library repo cloned to your local machine and open in VS Code.\nRun and Access a Local Copy of APRL During Development\rWhen in VS Code you should be able to open a terminal and run the below commands to access a copy of the APRL website from a local web server, provided by Hugo, using the following address http://localhost:1313/Azure-Proactive-Resiliency-Library/:\nCopy\rcd docs hugo server -D Software/Applications\rTo contribute to this project/repo/library you will need the following installed:\nYou can use winget to install all the pre-requisites easily for you. See the below section\rGit Visual Studio Code (VS Code) Extensions: editorconfig.editorconfig, streetsidesoftware.code-spell-checker, ms-vsliveshare.vsliveshare, medo64.render-crlf, vscode-icons-team.vscode-icons VS Code will recommend automatically to install these when you open this repo, or a fork of it, in VS Code. Hugo Extended winget Install Commands\rTo install winget follow the install instructions here.\nCopy\rwinget install --id \u0026#39;Git.Git\u0026#39; winget install --id \u0026#39;Microsoft.VisualStudioCode\u0026#39; winget install --id \u0026#39;Hugo.Hugo.Extended\u0026#39; Other requirements\rA GitHub profile/account A fork of the Azure/Azure-Proactive-Resiliency-Library repo into your GitHub org/account and cloned locally to your machine Instructions on forking a repo and then cloning it can be found here Useful Resources\rBelow are links to a number of useful resources to have when contributing to APRL:\nAce Documentation Theme (that we use) - Docs Shortcodes - e.g. Code Ace Documentation Theme (that we use) - Repo The Example Site, which is the first link above, source code Hugo Quick Start Hugo Docs Markdown Cheat Sheet Steps to do before contributing anything (after pre-requisites)\rRun the following commands in your terminal of choice from the directory where you fork of the repo is located:\nCopy\rgit checkout main git pull git fetch -p git fetch -p upstream git pull upstream main git push Doing this will ensure you have the latest changes from the upstream repo and you are ready to now create a new branch from main by running the below commands:\nCopy\rgit checkout main git checkout -b \u0026lt;YOUR-DESIRED-BRANCH-NAME-HERE\u0026gt; Creating a Service\u0026rsquo;s Recommendation Page\rImportant\rMake sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section.\rThe is a common task that is likely to be done is adding a new service to which you want to provide recommendations and supporting queries etc. for example Virtual Machines.\nFor this task we use Hugo\u0026rsquo;s archetype features which enables you to create a whole directory for a new service with a lot of templated content ready for you to change and use. This can be called by using the following command hugo new --kind service-bundle services/\u0026lt;category\u0026gt;/\u0026lt;service-name\nYou can see source code of the directory archetype called service-bundle here in the repo.\nFor the steps below we will use the Virtual Machine service as an example. Please change this to the service you are wanting to create.\rSteps to follow:\nIn your terminal of choice run the following: Copy\rcd docs/ hugo new --kind service-bundle services/compute/virtual-machines You will now see a new folder in content/services/compute called virtual-machines Copy\r‚îú‚îÄ‚îÄ‚îÄcontent ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcontributing ‚îÇ ‚îî‚îÄ‚îÄ‚îÄservices ‚îÇ ‚îú‚îÄ‚îÄ‚îÄai-ml ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcompute ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄvirtual-machines ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcode ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcm-1 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcm-2 Inside the virtual-machines folder you will see the following files pre-staged Copy\r‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄvirtual-machines ‚îÇ ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcode ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcm-1 ‚îÇ ‚îÇ ‚îÇ cm-1.azcli ‚îÇ ‚îÇ ‚îÇ cm-1.kql ‚îÇ ‚îÇ ‚îÇ cm-1.ps1 ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄcm-2 ‚îÇ ‚îÇ cm-2.azcli ‚îÇ ‚îÇ cm-2.kql ‚îÇ ‚îÇ cm-2.ps1 Open _index.md in VS Code and make relevant changes You can copy the recommendations labelled CM-1 or CM-2 multiple times to create more recommendations Update the ARG, PowerShell, AZCLI scripts in the code folder within virtual-machines You will see there is a folder, e.g. cm-1, cm-2, per recommendation to help with file structure organization Save, commit and push your changes to your branch and repo Create a create a Pull Request into the main branch of the upstream repo Get it merged Don\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here.\rUpdating a Service\u0026rsquo;s Recommendation Page\rImportant\rMake sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section.\rThis is likely the most common task that will be performed.\nAll you need to do is just make edits directly to the existing markdown (.md) files, save your changes, commit, stage and push them to your branch and repo. Then create a Pull Request into the main branch of the upstream repo and you are done üëç\nDon\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here.\rCreating a Service Category\rImportant\rMake sure you have followed the the Steps to do before contributing anything (after pre-requisites) before following this section.\rFor this task we use Hugo\u0026rsquo;s archetype features which enables you to create a whole directory for a new service with a lot of templated content ready for you to change and use. This can be called by using the following command hugo new --kind category-bundle services/\u0026lt;category\u0026gt;\nYou can see source code of the directory archetype called category-bundle here in the repo.\nFor the steps below we will use the AAA category as an example. Please change this to the category you are wanting to create.\rSteps to follow:\nIn your terminal of choice run the following: Copy\rcd docs/ hugo new --kind category-bundle services/aaa You will now see a new folder in content/services called aaa Copy\r‚îú‚îÄ‚îÄ‚îÄcontent ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄcontributing ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄservices ‚îÇ ‚îÇ _index.md ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄaaa ‚îÇ ‚îÇ _index.md Inside the aaa folder you will see the following file _index.md pre-staged Copy\r‚îú‚îÄ‚îÄ‚îÄaaa ‚îÇ ‚îÇ _index.md Open _index.md in VS Code and make relevant changes Save, commit and push your changes to your branch and repo Create a create a Pull Request into the main branch of the upstream repo Get it merged Don\u0026rsquo;t forget you can see your changes live by running a local copy of the APRL website by following the guidance here.\rTop Tips\rSometimes the local version of the website may show some inconsistencies that don\u0026rsquo;t reflect the content you have created. If this happens, simply kill the Hugo local web server by pressing CTRL+C and then restart the Hugo web server by running hugo server -D from the docs/ directory "
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/ai-ml/",
	"title": "AI and ML",
	"tags": null,
	"description": "Artificial Intelligence (AI) and Machine Learning (ML) Services",
	"content": "This page lists all of the Azure Services under the AI and ML category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/compute/",
	"title": "Compute",
	"tags": null,
	"description": "Compute Services",
	"content": "This page lists all of the Azure Services under the Compute category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\rVirtual Machines "
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/container/",
	"title": "Containers",
	"tags": null,
	"description": "Container Services",
	"content": "This page lists all of the Azure Services under the Containers category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/database/",
	"title": "Databases",
	"tags": null,
	"description": "Database Services",
	"content": "This page lists all of the Azure Services under the Databases category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/general/",
	"title": "General",
	"tags": null,
	"description": "General Services",
	"content": "This page lists all of the Azure Services under the General category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/hybrid/",
	"title": "Hybrid",
	"tags": null,
	"description": "Hybrid Services",
	"content": "This page lists all of the Azure Services under the Hybrid category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/integration/",
	"title": "Integration",
	"tags": null,
	"description": "Integration Services",
	"content": "This page lists all of the Azure Services under the Integration category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/iot/",
	"title": "IoT",
	"tags": null,
	"description": "Internet of Things (IoT) Services",
	"content": "This page lists all of the Azure Services under the IoT category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/networking/",
	"title": "Networking",
	"tags": null,
	"description": "Networking Services",
	"content": "This page lists all of the Azure Services under the Networking category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/security/",
	"title": "Security",
	"tags": null,
	"description": "Security Services",
	"content": "This page lists all of the Azure Services under the Security category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/specialized-workloads/",
	"title": "Specialized Workloads",
	"tags": null,
	"description": "Specialized Workloads Services",
	"content": "This page lists all of the Azure Services under the Specialized Workloads category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/storage/",
	"title": "Storage",
	"tags": null,
	"description": "Storage Services",
	"content": "This page lists all of the Azure Services under the Storage category for which the APRL has guidance, recommendations and queries for.\nServices List\rThe below list of services is automatically populated based on the child folders and files in this directory within the source code in the repo.\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/web/",
	"title": "Web",
	"tags": null,
	"description": "Web Services",
	"content": "This page lists all of the Azure Services under the Web category for which the APRL has guidance, recommendations and queries for.\nServices List\r"
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/categories/",
	"title": "Categories",
	"tags": null,
	"description": "",
	"content": ""
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/tags/",
	"title": "Tags",
	"tags": null,
	"description": "",
	"content": ""
},
{
	"uri": "https://azure.github.io/Azure-Proactive-Resiliency-Library/services/compute/virtual-machines/",
	"title": "Virtual Machines",
	"tags": null,
	"description": "Best practices and resiliency recommendations for Virtual Machines and associated resources.",
	"content": "The presented resiliency recommendations in this guidance include Virtual Machines, Virtual Machine Scale Sets, and dependent resources and settings.\nSummary of Recommendations\rRecommendation Verified by Microsoft Product Group VM-1 - Avoid running a production workload on a single VM No VM-2 - Deploy Virtual Machines across Availability Zones No VM-3 - If Availability Zones are not available, then put each application tier into a separate Availability Set No VM-4 - Replicate Virtual Machines using Azure Site Recovery No VM-5 - Use Managed Disks for Virtual Machine hard disks No VM-6 - Host application or database data on a data disk No VM-7 - Enable Backups on your Virtual Machines No VM-8 - Production VMs should be using Premium disks No VM-9 - There are Virtual Machines in Stopped state No VM-10 - Accelerated Networking is not enabled No VM-11 - Accelerated Networking is enabled, make sure you update the GuestOS NIC driver every 6 months No VM-12 - Virtual Machines should not have a Public IP directly associated No VM-13 - Virtual Network Interfaces have an NSG associated No VM-14 - IP Forwarding should only be enabled for Network Virtual Appliances No VM-15 - Customer DNS Servers should be configured in the Virtual Network level No VM-16 - Private IP Address should be configured as Static No VM-17 - Shared disks should only be enabled in Clustered servers No VM-18 - The Network access to the VM disk is set to \u0026ldquo;Enable Public access from all networks\u0026rdquo; No VM-19 - Virtual Machine is not compliant with Azure Policies No VM-20 - Enable disk encryption, Enable data at rest encryption by default No VM-21 - Enable Insights to get more visibility into the health and performance of your virtual machine No VM-22 - Diagnostic Settings should be configured for all Azure Resources No VM-23 - Tags are inconsistent across Virtual Machines No VM-24 - Tag shows incorrect value for the Availability Zone number for a Virtual Machine No Recommendations Details\rVM-1 - Avoid running a production workload on a single VM\rImportance: Critical\rRecommendation/Guidance\rA single VM deployment is not resilient to planned or unplanned Azure maintenances. Instead, deploy multiple VMs in different Availability Zones, or put them into an Availability Set or Virtual Machine Scale Set, with a Load Balancer in front of them.\nResources\rhttps://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-2 - Deploy Virtual Machines across Availability Zones\rImportance: High\rRecommendation/Guidance\rAzure availability zones are physically separate locations within each Azure region that are tolerant to local failures. Use availability zones to protect your applications and data against unlikely datacenter failures.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/create-portal-availability-zone Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\rresources | where type =~ \u0026#34;microsoft.compute/virtualmachines\u0026#34; | extend zonesString = tostring(zones) | where zonesString =~ \u0026#34;\u0026#34; | distinct name, resourceGroup, zonesString | project name, resourceGroup, zonesString VM-3 - If Availability Zones are not available, then put each application tier into a separate Availability Set\rImportance: High\rRecommendation/Guidance\rIf the region where you are running your application doesn\u0026rsquo;t support Availablity Zones, then put your VMs into an Availability Set. In an N-tier application, don\u0026rsquo;t put VMs from different tiers into the same availability set. VMs in an availability set are placed across fault domains (FDs) and update domains (UD). However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.\nResources\rhttps://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-4 - Replicate Virtual Machines using Azure Site Recovery\rImportance: Low\rRecommendation/Guidance\rWhen you replicate Azure VMs using Site Recovery, all the VM disks are continuously replicated to the target region asynchronously. The recovery points are created every few minutes. This gives you a Recovery Point Objective (RPO) in the order of minutes. You can conduct disaster recovery drills as many times as you want, without affecting the production application or the ongoing replication.\nResources\r[\u0026quot;https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines https://learn.microsoft.com/en-us/azure/site-recovery/site-recovery-test-failover-to-azure\u0026quot;](\u0026quot;https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines https://learn.microsoft.com/en-us/azure/site-recovery/site-recovery-test-failover-to-azure\u0026quot;) Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\rVM-5 - Use Managed Disks for Virtual Machine hard disks\rImportance: High\rRecommendation/Guidance\rManaged disks provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure. Also, managed disks aren\u0026rsquo;t subject to the IOPS limits of VHDs created in a storage account.\nResources\r[\u0026quot;https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines https://learn.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set\u0026quot;](\u0026quot;https://learn.microsoft.com/en-us/azure/architecture/checklist/resiliency-per-service#virtual-machines https://learn.microsoft.com/en-us/azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set\u0026quot;) Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-6 - Host application or database data on a data disk\rImportance: Informational\rRecommendation/Guidance\rA data disk is a managed disk that\u0026rsquo;s attached to a virtual machine to store application data, or other data you need to keep. Data disks are registered as SCSI drives and are labeled with a letter that you choose. Hosting you data on a data disk also helps with flexibility when backuping or restoring data, as well as migrating the disk without having to migrate the entire Virtual Machine and Operating System. You will be able to also select a different disk sku, with different type, size, and performance that meet your requirements.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/managed-disks-overview#data-disk Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-7 - Enable Backups on your Virtual Machines\rImportance: Medium\rRecommendation/Guidance\rEnable backups for your virtual machines and secure your data\nResources\rhttps://learn.microsoft.com/en-us/azure/backup/backup-overview Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-8 - Production VMs should be using Premium disks\rImportance: Critical\rRecommendation/Guidance\rWe have identified that you are using standard disks with your premium-capable Virtual Machines and we recommend you consider upgrading the standard disks to premium disks. For any Single Instance Virtual Machine using premium storage for all Operating System Disks and Data Disks, we guarantee you will have Virtual Machine Connectivity of at least 99.9%. Consider these factors when making your upgrade decision. The first is that upgrading requires a VM reboot and this process takes 3-5 minutes to complete. The second is if the VMs in the list are mission-critical production VMs, evaluate the improved availability against the cost of premium disks.\nPremium SSD disks offer high-performance, low-latency disk support for I/O-intensive applications and production workloads. Standard SSD Disks are a cost effective storage option optimized for workloads that need consistent performance at lower IOPS levels. Use Standard HDD disks for Dev/Test scenarios and less critical workloads at lowest cost.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/disks-types#premium-ssd Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-9 - There are Virtual Machines in Stopped state\rImportance: Informational\rRecommendation/Guidance\rAzure Virtual Machines (VM) instances go through different states. There are provisioning and power states. If a Virtual Machine is not running that indicates the Virtual Machine might facing an issue or is no longer necessary and could be removed helping to reduce costs.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/ Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\rresources | extend PowerState= tostring(properties.extended.instanceView.powerState.displayStatus) | where type =~ \u0026#39;microsoft.compute/virtualmachines\u0026#39; and PowerState == \u0026#39;VM Stopped\u0026#39; | project name,PowerState,resourceGroup,subscriptionId VM-10 - Accelerated Networking is not enabled\rImportance: Medium\rRecommendation/Guidance\rAccelerated networking enables single root I/O virtualization (SR-IOV) to a VM, greatly improving its networking performance. This high-performance path bypasses the host from the data path, which reduces latency, jitter, and CPU utilization for the most demanding network workloads on supported VM types.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/accelerated-networking-overview Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-11 - Accelerated Networking is enabled, make sure you update the GuestOS NIC driver every 6 months\rImportance: Low\rRecommendation/Guidance\rWhen Accelerated Networking is enabled the default Azure Virtual Network interface in the GuestOS is replaced for a Mellanox and consecutively its driver is provided from a 3rd party vendor. Marketplace images maintained by Microsoft are offered with the latest version of Mellanox drivers, however, once the Virtual Machine is deployed, the customer is responsible for maintaining the driver up to date.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/accelerated-networking-overview Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-12 - Virtual Machines should not have a Public IP directly associated\rImportance: Medium\rRecommendation/Guidance\rIf a Virtual Machine requires outbound internet connectivity we recommend the use of NAT Gateway or Azure Firewall, this will help to increase security and resiliency of the service as both services have much higher availability and SNAT ports. For inbound internet connectivity we recommend using a load balancing solution such as Azure Load Balancer and Application Gateway.\nResources\rhttps://learn.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\rResources | where type =~ \u0026#39;microsoft.compute/virtualmachines\u0026#39; | extend nics=array_length(properties.networkProfile.networkInterfaces) | mvexpand nic=properties.networkProfile.networkInterfaces | extend hostName = properties.osProfile.computerName | where nics == 1 or nic.properties.primary =~ \u0026#39;true\u0026#39; or isempty(nic) | project vmId = id, vmName = name, nicId = tostring(nic.id), hostName | join kind=leftouter ( Resources | where type =~ \u0026#39;microsoft.network/networkinterfaces\u0026#39; | extend ipConfigsCount=array_length(properties.ipConfigurations) | mvexpand ipconfig=properties.ipConfigurations | extend privateIp = ipconfig.properties.privateIPAddress, publicIpId = tostring(ipconfig.properties.publicIPAddress.id) | where ipConfigsCount == 1 or ipconfig.properties.primary =~ \u0026#39;true\u0026#39; | project nicId = id, privateIp, publicIpId ) on nicId | project-away nicId1 | summarize by vmId, vmName, tostring(hostName), nicId, publicIpId, tostring(privateIp) | join kind=leftouter ( Resources | where type =~ \u0026#39;microsoft.network/publicipaddresses\u0026#39; | project publicIpId = id, publicIpAddress = properties.ipAddress) on publicIpId | where publicIpAddress != \u0026#34;\u0026#34; | project-away publicIpId1 VM-13 - Virtual Network Interfaces have an NSG associated\rImportance: Informational\rRecommendation/Guidance\rUnless you have a specific reason to, we recommend that you associate a network security group to a subnet, or a network interface, but not both. Since rules in a network security group associated to a subnet can conflict with rules in a network security group associated to a network interface, you can have unexpected communication problems that require troubleshooting.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/network-security-group-how-it-works#intra-subnet-traffic Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-14 - IP Forwarding should only be enabled for Network Virtual Appliances\rImportance:Medium\rRecommendation/Guidance\rIP forwarding enables the virtual machine network interface to:\nReceive network traffic not destined for one of the IP addresses assigned to any of the IP configurations assigned to the network interface.\nSend network traffic with a different source IP address than the one assigned to one of a network interface\u0026rsquo;s IP configurations.\nThe setting must be enabled for every network interface that is attached to the virtual machine that receives traffic that the virtual machine needs to forward. A virtual machine can forward traffic whether it has multiple network interfaces or a single network interface attached to it. While IP forwarding is an Azure setting, the virtual machine must also run an application able to forward the traffic, such as firewall, WAN optimization, and load balancing applications.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-network-interface?tabs=network-interface-portal#enable-or-disable-ip-forwarding Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-15 - Customer DNS Servers should be configured in the Virtual Network level\rImportance: Informational\rRecommendation/Guidance\rConfigure the DNS Server in the Virtual Network to avoid inconsistency across the environment.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-16 - Private IP Address should be configured as Static\rImportance: Low\rRecommendation/Guidance\rBy default, the Azure DHCP servers assign the private IPv4 address for the primary IP configuration of the Azure network interface to the network interface within the virtual machine operating system. Dynamic is the default allocation method. Once assigned, dynamic IP addresses are only released if a network interface is deleted, assigned to a different subnet within the same virtual network, or the allocation method is changed to static, and a different IP address is specified. In order to increase consistency and guaranteed IP reservation, we highly recommend configuring Static IPs.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-network/ip-services/virtual-network-network-interface-addresses?tabs=nic-address-portal#static Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-17 - Shared disks should only be enabled in Clustered servers\rImportance: High\rRecommendation/Guidance\rAzure shared disks is a feature for Azure managed disks that enables you to attach a managed disk to multiple virtual machines (VMs) simultaneously. Attaching a managed disk to multiple VMs allows you to either deploy new or migrate existing clustered applications to Azure, and should only be used in those situations where the disk will be assigned to more than one Virtual Machine member of a Cluster.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/disks-shared-enable?tabs=azure-portal Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-18 - The Network access to the VM disk is set to \u0026ldquo;Enable Public access from all networks\rImportance: Informational\rRecommendation/Guidance\rRecommended changing to \u0026ldquo;Disable public access and enable private access\u0026rdquo; and creating a Private Endpoint\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/disks-enable-private-links-for-import-export-portal Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-19 - Virtual Machine is not compliant with Azure Policies\rImportance: Medium\rRecommendation/Guidance\rIt\u0026rsquo;s important to keep your virtual machine (VM) secure for the applications that you run. Securing your VMs can include one or more Azure services and features that cover secure access to your VMs and secure storage of your data. This article provides information that enables you to keep your VM and applications secure.\nResources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/security-controls-policy Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-20 - Enable disk encryption, Enable data at rest encryption by default\rImportance: Medium\rRecommendation/Guidance\rThere are several types of encryption available for your managed disks, including Azure Disk Encryption (ADE), Server-Side Encryption (SSE) and encryption at host.\nAzure Disk Encryption helps protect and safeguard your data to meet your organizational security and compliance commitments. Azure Disk Storage Server-Side Encryption (also referred to as encryption-at-rest or Azure Storage encryption) automatically encrypts data stored on Azure managed disks (OS and data disks) when persisting on the Storage Clusters. Encryption at host ensures that data stored on the VM host hosting your VM is encrypted at rest and flows encrypted to the Storage clusters. Confidential disk encryption binds disk encryption keys to the virtual machine\u0026rsquo;s TPM and makes the protected disk content accessible only to the VM. Resources\rhttps://learn.microsoft.com/en-us/azure/virtual-machines/disk-encryption-overview Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-21 - Enable Insights to get more visibility into the health and performance of your virtual machine\rImportance: Informational\rRecommendation/Guidance\rVM insights monitors the performance and health of your virtual machines and virtual machine scale sets. It monitors their running processes and dependencies on other resources. VM insights can help deliver predictable performance and availability of vital applications by identifying performance bottlenecks and network issues. It can also help you understand whether an issue is related to other dependencies.\nResources\rhttps://learn.microsoft.com/en-us/azure/azure-monitor/vm/vminsights-overview Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-22 - Diagnostic Settings should be configured for all Azure Resources\rImportance: Low\rRecommendation/Guidance\rPlatform metrics are sent automatically to Azure Monitor Metrics by default and without configuration. Platform logs provide detailed diagnostic and auditing information for Azure resources and the Azure platform they depend on:\nResource logs aren\u0026rsquo;t collected until they\u0026rsquo;re routed to a destination. Activity logs exist on their own but can be routed to other locations. Each Azure resource requires its own diagnostic setting, which defines the following criteria:\nSources: The type of metric and log data to send to the destinations defined in the setting. The available types vary by resource type. Destinations: One or more destinations to send to. A single diagnostic setting can define no more than one of each of the destinations. If you want to send data to more than one of a particular destination type (for example, two different Log Analytics workspaces), create multiple settings. Each resource can have up to five diagnostic settings.\nResources\rhttps://learn.microsoft.com/en-us/azure/azure-monitor/essentials/diagnostic-settings?tabs=portal Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-23 - Tags are inconsistent across Virtual Machines\rImportance: Informational\rRecommendation/Guidance\rThe Tags assigned to the Virtual Machines are different and if used for automation, or billing, or support purposes it could led to incorrect actions.\nResources\rhttps://learn.microsoft.com/en-us/azure/azure-resource-manager/management/tag-resources?tabs=json Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development VM-24 - Tag shows incorrect value for the Availability Zone number for a Virtual Machine\rImportance: Medium\rRecommendation/Guidance\rThe Tags assigned to the Virtual Machines are different and if used for automation, or billing, or support purposes it could led to incorrect actions.\nResources\rhttps://learn.microsoft.com/en-us/azure/azure-resource-manager/management/tag-resources?tabs=json Queries/Scripts\rAzure Resource Graph\rShow/Hide Query/Script\rCopy\runder development "
}]
