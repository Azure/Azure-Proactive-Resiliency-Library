<!DOCTYPE html>
<html><head><script src="/Azure-Proactive-Resiliency-Library/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=Azure-Proactive-Resiliency-Library/livereload" data-no-instant defer></script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <meta name="description" content="Best practices and resiliency recommendations for Virtual Machine Scale Sets and associated resources.">
    
    <link rel="alternate" type="application/rss+xml" href="http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/virtual-machine-scale-sets/index.xml" title="Azure Proactive Resiliency Library (APRL)" />
    <link rel="canonical" href="http://localhost:1313/Azure-Proactive-Resiliency-Library/services/compute/virtual-machine-scale-sets/">

    <title>
        
        Virtual Machine Scale Sets | Azure Proactive Resiliency Library (APRL)
        
    </title>

    
    <link href="http://localhost:1313/Azure-Proactive-Resiliency-Library/css/fontawesome.min.css" rel="stylesheet">

    
    <link rel="stylesheet" href="http://localhost:1313/Azure-Proactive-Resiliency-Library/css/ace.min.css">

    

    
    

  
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "kxpusfirv0");
  </script>

  
</head>
<body>

  <script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
  <script>addBackToTop({
      diameter: 75,
      backgroundColor: 'rgb(0, 123, 255)',
      textColor: '#ffffff',
      cornerOffset: 25,
      scrollDuration: 300
    })</script><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id="navbarMain">
    <div class="container">
        <div>
            <a class="navbar-brand" href="/Azure-Proactive-Resiliency-Library">
                
                    <img src="/Azure-Proactive-Resiliency-Library/media/img/aprl-white.png" />
                
                Azure Proactive Resiliency Library (APRL)
            </a>
        </div>
        
            <button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#navbarMainCollapse" aria-controls="navbarMainCollapse" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarMainCollapse">
              <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="https://aka.ms/waf" target="_blank">
                                  Well-Architected Framework
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="https://aka.ms/aprl/repo" target="_blank">
                                  Source Code <i class='fab fa-github'></i>
                                </a>
                            </li>
              </ul>
            </div>
    </div>
    
    
</nav>
<div class="container-fluid">
    <div class="row">

      <div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0">
    <button class="navbar-toggler navbar-toggler-right collapsed" type="button" data-toggle="collapse" data-target="#sidenav-left-collapse" aria-controls="sidenav-left-collapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

     <div class="collapse navbar-collapse align-items-start flex-column" id="sidenav-left-collapse">
            <form class="form-inline my-2 my-lg-0 searchbox">
                <input class="form-control mr-sm-2 w-100" data-search-input id="search-by" type="text" placeholder="Search">
            </form>

        

         <ul class="navbar-nav flex-column pt-3">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/" class="nav-item my-1 parent haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/"><h6>Azure Services</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/ai-ml/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/ai-ml/"><h6>AI and ML</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/ai-ml/databricks/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/ai-ml/databricks/"><h6>Azure Databricks</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/batch/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/batch/"><h6>Batch</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/batch/batch-accounts/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/batch/batch-accounts/"><h6>Batch Accounts</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/" class="nav-item my-1 parent haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/"><h6>Compute</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/site-recovery/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/site-recovery/"><h6>Azure Site Recovery</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/compute-gallery/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/compute-gallery/"><h6>Compute Gallery</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/image-templates/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/image-templates/"><h6>Image Templates</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/virtual-machine-scale-sets/" class="nav-item my-1 active
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/virtual-machine-scale-sets/"><h6>Virtual Machine Scale Sets</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/compute/virtual-machines/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/compute/virtual-machines/"><h6>Virtual Machines</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/container/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/container/"><h6>Containers</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/container/aks/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/container/aks/"><h6>AKS</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/container/container-registry/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/container/container-registry/"><h6>Container Registry</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/"><h6>Databases</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/sqldb/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/sqldb/"><h6>SQL DB</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/cosmosdb/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/cosmosdb/"><h6>Cosmos DB</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/db-for-mysql/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/db-for-mysql/"><h6>DB for MySQL</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/db-for-postgresql/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/db-for-postgresql/"><h6>DB for PostgreSQL</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/database/redis-cache/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/database/redis-cache/"><h6>Redis Cache</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/general/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/general/"><h6>General</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/hybrid/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/hybrid/"><h6>Hybrid</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/integration/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/integration/"><h6>Integration</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/integration/api-management/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/integration/api-management/"><h6>Api Management</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/integration/event-grid/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/integration/event-grid/"><h6>Event Grid</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/integration/event-hub/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/integration/event-hub/"><h6>Event Hub</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/integration/service-bus/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/integration/service-bus/"><h6>Service Bus</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/iot/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/iot/"><h6>Internet of Things</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/iot/iot-hub/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/iot/iot-hub/"><h6>IoT Hub</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/management/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/management/"><h6>Management</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/management/automation-account/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/management/automation-account/"><h6>Automation Account</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/management/management-group/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/management/management-group/"><h6>Management Groups</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/management/resource-group/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/management/resource-group/"><h6>Resource Groups</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/management/subscription/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/management/subscription/"><h6>Subscription</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/migration/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/migration/"><h6>Migration</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/migration/azure-backup/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/migration/azure-backup/"><h6>Azure Backup</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/monitoring/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/monitoring/"><h6>Monitoring</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/monitoring/application-insights/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/monitoring/application-insights/"><h6>Application Insights</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/monitoring/log-analytics/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/monitoring/log-analytics/"><h6>Log Analytics</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/monitoring/resource-health-alerts/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/monitoring/resource-health-alerts/"><h6>Resource Health Alerts</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/monitoring/service-health-alerts/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/monitoring/service-health-alerts/"><h6>Service Health Alerts</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/"><h6>Networking</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/application-gateway/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/application-gateway/"><h6>Application Gateway</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/ddos-protection-plans/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/ddos-protection-plans/"><h6>DDoS Protection Plans</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-circuits/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-circuits/"><h6>ExpressRoute Circuits</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-connection/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-connection/"><h6>ExpressRoute Connection</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-direct/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-direct/"><h6>ExpressRoute Direct</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-gateway/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-gateway/"><h6>ExpressRoute Gateway</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-traffic-collector/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/expressroute-traffic-collector/"><h6>ExpressRoute Traffic Collector</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/firewall/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/firewall/"><h6>Firewall</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/front-door/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/front-door/"><h6>Front Door</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/load-balancer/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/load-balancer/"><h6>Load Balancer</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/network-security-group/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/network-security-group/"><h6>Network Security Group</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/network-watcher/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/network-watcher/"><h6>Network Watcher</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/private-dns-zones/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/private-dns-zones/"><h6>Private DNS Zones</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/private-endpoints/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/private-endpoints/"><h6>Private Endpoints</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/public-ip/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/public-ip/"><h6>Public Ip</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/route-table/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/route-table/"><h6>Route Table</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/traffic-manager/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/traffic-manager/"><h6>Traffic Manager</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/virtual-networks/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/virtual-networks/"><h6>Virtual Networks</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/vpn-gateway/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/vpn-gateway/"><h6>VPN Gateway</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/networking/web-application-firewall/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/networking/web-application-firewall/"><h6>Web Application Firewall</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/security/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/security/"><h6>Security</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/security/key-vault/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/security/key-vault/"><h6>Key Vault</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/"><h6>Specialized Workloads</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-hpc/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-hpc/"><h6>Azure High Performance Computing</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-virtual-desktop/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-virtual-desktop/"><h6>Azure Virtual Desktop</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-vmware-solution/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/azure-vmware-solution/"><h6>Azure VMware Solution</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/sap-on-azure/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/specialized-workloads/sap-on-azure/"><h6>SAP on Azure</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/storage/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/storage/"><h6>Storage</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/storage/azure-netapp-files/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/storage/azure-netapp-files/"><h6>Azure NetApp Files</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/storage/storage-account/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/storage/storage-account/"><h6>Storage Accounts (Blob/Azure Data Lake Storage Gen2)</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/web/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/web/"><h6>Web</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/web/app-service-plan/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/web/app-service-plan/"><h6>App Service Plan</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/web/signalr/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/web/signalr/"><h6>SignalR</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/services/web/web-app/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/services/web/web-app/"><h6>Web App</h6></a>
        
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/" class="nav-item my-1 haschildren
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/"><h6>Well Architected Framework</h6></a>
        
        <ul class="list-unstyled ml-2">
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/1-define/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/1-define/"><h6>1 - Define</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/2-design/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/2-design/"><h6>2 - Design</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/3-test/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/3-test/"><h6>3 - Test</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/4-deploy/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/4-deploy/"><h6>4 - Deploy</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/5-monitor/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/5-monitor/"><h6>5 - Monitor</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/well-architected/6-respond/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/well-architected/6-respond/"><h6>6 - Respond</h6></a>
        
    </li>
        </ul>
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/contributing/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/contributing/"><h6>Contributing</h6></a>
        
    </li>
    <li data-nav-id="/Azure-Proactive-Resiliency-Library/privacy/" class="nav-item my-1
        ">
        
        
          <a class="nav-link p-0" href="/Azure-Proactive-Resiliency-Library/privacy/"><h6>Privacy</h6></a>
        
    </li>
        </ul>
    </div>
</nav>


</div>
        <div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-10 py-3">
          

<div class="d-flex flex-column">
    <h1 class="js-title">Virtual Machine Scale Sets</h1>
    <div class="d-flex align-items-center">
        
    </div>
</div>

<hr>


<p>The presented resiliency recommendations in this guidance include Virtual Machine Scale Sets, and dependent resources and settings.</p>
<h2 id="summary-of-recommendations">Summary of Recommendations
  <a href="#summary-of-recommendations">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h2>

<div class="table table-striped" role="alert">
    <table>
<thead>
<tr>
<th style="text-align:left">Recommendation</th>
<th style="text-align:center">Category</th>
<th style="text-align:center">Impact</th>
<th style="text-align:center">State</th>
<th style="text-align:center">ARG Query Available</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="#vmss-1---deploy-vmss-with-flex-orchestration-mode-instead-of-uniform">VMSS-1 - Deploy VMSS with Flex orchestration mode instead of Uniform</a></td>
<td style="text-align:center">System Efficiency</td>
<td style="text-align:center">Medium</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-2---enable-vmss-application-health-monitoring">VMSS-2 - Enable VMSS application health monitoring</a></td>
<td style="text-align:center">Monitoring</td>
<td style="text-align:center">Medium</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-3---enable-automatic-repair-policy">VMSS-3 - Enable Automatic Repair policy</a></td>
<td style="text-align:center">Automation</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-4---configure-vmss-autoscale-to-custom-and-configure-the-scaling-metrics">VMSS-4 - Configure VMSS autoscale to custom and configure the scaling metrics</a></td>
<td style="text-align:center">System Efficiency</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-5---enable-predictive-autoscale-and-configure-at-least-for-forecast-only">VMSS-5 - Enable Predictive Autoscale and configure at least for Forecast Only</a></td>
<td style="text-align:center">System Efficiency</td>
<td style="text-align:center">Low</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-6---disable-force-strictly-even-balance-across-zones-to-avoid-scale-in-and-out-fail-attempts">VMSS-6 - Disable Force strictly even balance across zones to avoid scale in and out fail attempts</a></td>
<td style="text-align:center">Availability</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-7---configure-allocation-policy-spreading-algorithm-to-max-spreading">VMSS-7 - Configure Allocation Policy Spreading algorithm to Max Spreading</a></td>
<td style="text-align:center">System Efficiency</td>
<td style="text-align:center">Medium</td>
<td style="text-align:center">Preview</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-8---deploy-vmss-across-availability-zones-with-vmss-flex">VMSS-8 - Deploy VMSS across availability zones with VMSS Flex</a></td>
<td style="text-align:center">Availability</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-9---set-patch-orchestration-options-to-azure-orchestrated">VMSS-9 - Set Patch orchestration options to Azure-orchestrated</a></td>
<td style="text-align:center">Automation</td>
<td style="text-align:center">Low</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-10---upgrade-vmss-image-versions-scheduled-to-be-deprecated-or-already-retired">VMSS-10 - Upgrade VMSS Image versions scheduled to be deprecated or already retired</a></td>
<td style="text-align:center">Governance</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Preview</td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:left"><a href="#vmss-11---production-vmss-instances-should-be-using-ssd-disks">VMSS-11 - Production VMSS instances should be using SSD disks</a></td>
<td style="text-align:center">System Efficiency</td>
<td style="text-align:center">High</td>
<td style="text-align:center">Verified</td>
<td style="text-align:center">Yes</td>
</tr>
</tbody>
</table>

</div>


<div class="alert alert-info" role="alert">
    Definitions of states can be found <a href="http://localhost:1313/Azure-Proactive-Resiliency-Library/#definitions-of-terms-used-in-aprl">here</a>
</div>

<h2 id="recommendations-details">Recommendations Details
  <a href="#recommendations-details">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h2>
<h3 id="vmss-1---deploy-vmss-with-flex-orchestration-mode-instead-of-uniform">VMSS-1 - Deploy VMSS with Flex orchestration mode instead of Uniform
  <a href="#vmss-1---deploy-vmss-with-flex-orchestration-mode-instead-of-uniform">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: System Efficiency</strong></p>
<p><strong>Impact: Medium</strong></p>
<p><strong>Guidance</strong></p>
<p>Even single instance VMs should be deployed into a scale set using the Flexible orchestration mode to future-proof your application for scaling and availability. Flexible orchestration offers high availability guarantees (up to 1000 VMs) by spreading VMs across fault domains in a region or within an Availability Zone.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-design-overview#when-to-use-scale-sets-instead-of-virtual-machines">When to use VMSS instead of VMs</a></li>
<li><a href="https://learn.microsoft.com/azure/well-architected/services/compute/virtual-machines/virtual-machines-review">Azure Well-Architected Framework review - Virtual Machines and Scale Sets</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_006a1f1bda" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_006a1f1bda">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_e999ce2f98">
        Copy
        </button>
    </div>
    <div id="clipboard_e999ce2f98">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find <span style="color:#66d9ef">all</span> zonal VMs that <span style="color:#66d9ef">are</span> <span style="color:#66d9ef">NOT</span> deployed <span style="color:#66d9ef">with</span> Flex orchestration <span style="color:#66d9ef">mode</span>
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.orchestrationMode <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Flexible&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-1&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> strcat(<span style="color:#e6db74">&#34;orchestrationMode: &#34;</span>, tostring(properties.orchestrationMode))
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-2---enable-vmss-application-health-monitoring">VMSS-2 - Enable VMSS application health monitoring
  <a href="#vmss-2---enable-vmss-application-health-monitoring">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Monitoring</strong></p>
<p><strong>Impact: Medium</strong></p>
<p><strong>Guidance</strong></p>
<p>Monitoring your application health is an important signal for managing and upgrading your deployment. Azure Virtual Machine Scale Sets provide support for Rolling Upgrades including Automatic OS-Image Upgrades and Automatic VM Guest Patching, which rely on health monitoring of the individual instances to upgrade your deployment. You can also use Application Health Extension to monitor the application health of each instance in your scale set and perform instance repairs using Automatic Instance Repairs.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-health-extension?tabs=rest-api">Using Application Health extension with Virtual Machine Scale Sets</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_a0083799fa" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_a0083799fa">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_1c0b7dd677">
        Copy
        </button>
    </div>
    <div id="clipboard_1c0b7dd677">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find <span style="color:#66d9ef">all</span> VMs that <span style="color:#66d9ef">do</span> <span style="color:#66d9ef">NOT</span> have health monitoring enabled
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">join</span> kind<span style="color:#f92672">=</span>leftouter  (
</span></span><span style="display:flex;"><span>    resources
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> mv<span style="color:#f92672">-</span>expand extension<span style="color:#f92672">=</span>properties.virtualMachineProfile.extensionProfile.extensions
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> extension.properties.<span style="color:#66d9ef">type</span> <span style="color:#66d9ef">in</span> ( <span style="color:#e6db74">&#34;ApplicationHealthWindows&#34;</span>, <span style="color:#e6db74">&#34;ApplicationHealthLinux&#34;</span> )
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> project id
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">on</span> id
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> id1 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-2&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;extension: null&#34;</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-3---enable-automatic-repair-policy">VMSS-3 - Enable Automatic Repair policy
  <a href="#vmss-3---enable-automatic-repair-policy">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Automation</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Guidance</strong></p>
<p>Enabling automatic instance repairs for Azure Virtual Machine Scale Sets helps achieve high availability for applications by maintaining a set of healthy instances. The Application Health extension or Load balancer health probes may find that an instance is unhealthy. Automatic instance repairs will automatically perform instance repairs by deleting the unhealthy instance and creating a new one to replace it.</p>
<p>Grace period is specified in minutes in ISO 8601 format and can be set using the property automaticRepairsPolicy.gracePeriod. Grace period can range between 10 minutes and 90 minutes, and has a default value of 30 minutes.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-automatic-instance-repairs#requirements-for-using-automatic-instance-repairs">Automatic instance repairs for Azure Virtual Machine Scale Sets</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_2df9979499" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_2df9979499">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_ea3677c161">
        Copy
        </button>
    </div>
    <div id="clipboard_ea3677c161">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find <span style="color:#66d9ef">all</span> VMs that <span style="color:#66d9ef">do</span> <span style="color:#66d9ef">NOT</span> have automatic repair policy enabled
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.automaticRepairsPolicy.enabled <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-3&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;automaticRepairsPolicy: Disabled&#34;</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-4---configure-vmss-autoscale-to-custom-and-configure-the-scaling-metrics">VMSS-4 - Configure VMSS Autoscale to custom and configure the scaling metrics
  <a href="#vmss-4---configure-vmss-autoscale-to-custom-and-configure-the-scaling-metrics">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: System Efficiency</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Recommendation</strong></p>
<p>Use Custom autoscale based on metrics and schedules.</p>
<p>Autoscale is a built-in feature that helps applications perform their best when demand changes. You can choose to scale your resource manually to a specific instance count, or via a custom Autoscale policy that scales based on metric(s) thresholds, or schedule instance count which scales during designated time windows. Autoscale enables your resource to be performant and cost effective by adding and removing instances based on demand.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-get-started?WT.mc_id=Portal-Microsoft_Azure_Monitoring">Get started with autoscale in Azure</a></li>
<li><a href="https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-overview">Overview of autoscale in Azure</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_94198a5953" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_94198a5953">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_b3f8bcae41">
        Copy
        </button>
    </div>
    <div id="clipboard_b3f8bcae41">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find VMSS instances associated <span style="color:#66d9ef">with</span> autoscale settings <span style="color:#66d9ef">when</span> autoscale <span style="color:#66d9ef">is</span> disabled
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project name, id, tags
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">join</span> kind<span style="color:#f92672">=</span>leftouter  (
</span></span><span style="display:flex;"><span>    resources
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.insights/autoscalesettings&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> tostring(properties.targetResourceUri) <span style="color:#66d9ef">contains</span> <span style="color:#e6db74">&#34;Microsoft.Compute/virtualMachineScaleSets&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> project id <span style="color:#f92672">=</span> tostring(properties.targetResourceUri), autoscalesettings <span style="color:#f92672">=</span> properties
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">on</span> id
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">isnull</span>(autoscalesettings) <span style="color:#66d9ef">or</span> autoscalesettings.enabled <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-4&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;autoscalesettings: Disabled&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> id <span style="color:#66d9ef">asc</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-5---enable-predictive-autoscale-and-configure-at-least-for-forecast-only">VMSS-5 - Enable Predictive autoscale and configure at least for Forecast Only
  <a href="#vmss-5---enable-predictive-autoscale-and-configure-at-least-for-forecast-only">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: System Efficiency</strong></p>
<p><strong>Impact: Low</strong></p>
<p><strong>Guidance</strong></p>
<p>Predictive autoscale uses machine learning to help manage and scale Azure Virtual Machine Scale Sets with cyclical workload patterns. It forecasts the overall CPU load to your virtual machine scale set, based on your historical CPU usage patterns. It predicts the overall CPU load by observing and learning from historical usage. This process ensures that scale-out occurs in time to meet the demand.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-predictive">Use predictive autoscale to scale out before load demands in virtual machine scale sets</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_a9c6623446" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_a9c6623446">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_83de46226c">
        Copy
        </button>
    </div>
    <div id="clipboard_83de46226c">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find VMSS instances associated <span style="color:#66d9ef">with</span> autoscale settings <span style="color:#66d9ef">when</span> predictiveAutoscalePolicy_scaleMode <span style="color:#66d9ef">is</span> disabled
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project name, id, tags
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">join</span> kind<span style="color:#f92672">=</span>leftouter  (
</span></span><span style="display:flex;"><span>    resources
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.insights/autoscalesettings&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> tostring(properties.targetResourceUri) <span style="color:#66d9ef">contains</span> <span style="color:#e6db74">&#34;Microsoft.Compute/virtualMachineScaleSets&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> project id <span style="color:#f92672">=</span> tostring(properties.targetResourceUri), autoscalesettings <span style="color:#f92672">=</span> properties
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">on</span> id
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> autoscalesettings.enabled <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#66d9ef">and</span> autoscalesettings.predictiveAutoscalePolicy.scaleMode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Disabled&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-5&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictiveAutoscalePolicy_scaleMode: Disabled&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> id <span style="color:#66d9ef">asc</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-6---disable-force-strictly-even-balance-across-zones-to-avoid-scale-in-and-out-fail-attempts">VMSS-6 - Disable Force strictly even balance across zones to avoid scale in and out fail attempts
  <a href="#vmss-6---disable-force-strictly-even-balance-across-zones-to-avoid-scale-in-and-out-fail-attempts">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Availability</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Guidance</strong></p>
<p>Microsoft recommends disabling the setting that enforces strictly even distribution of VM instances across Availability Zones within a region in your VMSS configuration. In other words, you should allow Azure to distribute VM instances unevenly across Availability Zones.</p>
<p>Force strictly even balance across zones: Azure provides the option to distribute VM instances in a VMSS evenly across Availability Zones within a region. An Availability Zone is a physically separate data center within an Azure region with independent power, cooling, and networking. This configuration enhances the availability and fault tolerance of your applications.</p>
<p>Scale in and out fail attempts: In the context of VMSS, &ldquo;scaling in&rdquo; refers to reducing the number of VM instances when demand decreases, while &ldquo;scaling out&rdquo; refers to increasing the number of instances when demand increases. Scaling is an important feature of VMSS, and it can be automatic based on various scaling rules and metrics.</p>
<p>While Azure VMSS provides the option to enforce even distribution of VM instances across Availability Zones for increased resilience, there may be scenarios where disabling this option makes sense to better align with your application&rsquo;s load distribution and scaling requirements.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-scale-in-policy">Use scale-in policies with Azure Virtual Machine Scale Sets</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_05439a1e15" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_05439a1e15">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_e039ab5262">
        Copy
        </button>
    </div>
    <div id="clipboard_e039ab5262">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find VMSS instances <span style="color:#66d9ef">where</span> strictly zoneBalance <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.orchestrationMode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Uniform&#34;</span> <span style="color:#66d9ef">and</span> properties.zoneBalance <span style="color:#f92672">==</span> <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-6&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;strictly zoneBalance: Enabled&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> id <span style="color:#66d9ef">asc</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-7---configure-allocation-policy-spreading-algorithm-to-max-spreading">VMSS-7 - Configure Allocation Policy Spreading algorithm to Max Spreading
  <a href="#vmss-7---configure-allocation-policy-spreading-algorithm-to-max-spreading">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: System Efficiency</strong></p>
<p><strong>Impact: Medium</strong></p>
<p><strong>Guidance</strong></p>
<p>With max spreading, the scale set spreads your VMs across as many fault domains as possible within each zone. This spreading could be across greater or fewer than five fault domains per zone. With static fixed spreading, the scale set spreads your VMs across exactly five fault domains per zone. If the scale set cannot find five distinct fault domains per zone to satisfy the allocation request, the request fails.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones#availability-considerations">Availability Considerations</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_03f9891c94" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_03f9891c94">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_a09ee5f60b">
        Copy
        </button>
    </div>
    <div id="clipboard_a09ee5f60b">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find VMSS instances <span style="color:#66d9ef">where</span> Spreading algorithm <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">Static</span>
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.platformFaultDomainCount <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-7&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;platformFaultDomainCount: Static&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> id <span style="color:#66d9ef">asc</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-8---deploy-vmss-across-availability-zones-with-vmss-flex">VMSS-8 - Deploy VMSS across availability zones with VMSS Flex
  <a href="#vmss-8---deploy-vmss-across-availability-zones-with-vmss-flex">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Availability</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Guidance</strong></p>
<p>When you create your VMSS, use availability zones to protect your applications and data against unlikely datacenter failure.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones">Create a Virtual Machine Scale Set that uses Availability Zones</a></li>
<li><a href="https://learn.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-use-availability-zones?tabs=cli-1%2Cportal-2#update-scale-set-to-add-availability-zones">Update scale set to add availability zones</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_eeda4a01b4" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_eeda4a01b4">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_17d8f8324e">
        Copy
        </button>
    </div>
    <div id="clipboard_17d8f8324e">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find VMSS instances <span style="color:#66d9ef">with</span> one <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">no</span> Zones selected
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> array_length(zones) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">isnull</span>(zones)
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-8&#34;</span>, name, id, tags, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AvailabilityZones: Single Zone&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> id <span style="color:#66d9ef">asc</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-9---set-patch-orchestration-options-to-azure-orchestrated">VMSS-9 - Set Patch orchestration options to Azure-orchestrated
  <a href="#vmss-9---set-patch-orchestration-options-to-azure-orchestrated">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Automation</strong></p>
<p><strong>Impact: Low</strong></p>
<p><strong>Guidance</strong></p>
<p>Enabling automatic VM guest patching for your Azure VMs helps ease update management by safely and automatically patching virtual machines to maintain security compliance, while limiting the blast radius of VMs. Note that the KQL below will not return Virtual Machine Scale Sets using Uniform orchestration.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/azure/virtual-machines/automatic-vm-guest-patching">Automatic VM Guest Patching for Azure VMs</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-automatic-upgrade">Auto OS Image Upgrades</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_50828573e2" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_50828573e2">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_ce0d57f055">
        Copy
        </button>
    </div>
    <div id="clipboard_ce0d57f055">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">join</span> kind<span style="color:#f92672">=</span><span style="color:#66d9ef">inner</span> (
</span></span><span style="display:flex;"><span>    resources
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachines&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> project id <span style="color:#f92672">=</span> tostring(properties.virtualMachineScaleSet.id), vmproperties <span style="color:#f92672">=</span> properties
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">on</span> id
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> extend recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-9&#34;</span>, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;patchMode: Manual&#34;</span>, vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> isnotnull(vmproperties.osProfile.linuxConfiguration) <span style="color:#66d9ef">and</span> vmproperties.osProfile.linuxConfiguration.patchSettings.patchMode <span style="color:#f92672">!</span><span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#34;AutomaticByPlatform&#34;</span>, <span style="color:#e6db74">&#34;AutomaticByOS&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">distinct</span> recommendationId, name, id, param1
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">union</span> (resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">join</span> kind<span style="color:#f92672">=</span><span style="color:#66d9ef">inner</span> (
</span></span><span style="display:flex;"><span>    resources
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachines&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">|</span> project id <span style="color:#f92672">=</span> tostring(properties.virtualMachineScaleSet.id), vmproperties <span style="color:#f92672">=</span> properties
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">on</span> id
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> extend recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-9&#34;</span>, param1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;patchMode: Manual&#34;</span>, vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> isnotnull(vmproperties.osProfile.windowsConfiguration) <span style="color:#66d9ef">and</span> vmproperties.osProfile.windowsConfiguration.patchSettings.patchMode <span style="color:#f92672">!</span><span style="color:#66d9ef">in</span> (<span style="color:#e6db74">&#34;AutomaticByPlatform&#34;</span>, <span style="color:#e6db74">&#34;AutomaticByOS&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">distinct</span> recommendationId, name, id, param1)
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-10---upgrade-vmss-image-versions-scheduled-to-be-deprecated-or-already-retired">VMSS-10 - Upgrade VMSS Image versions scheduled to be deprecated or already retired
  <a href="#vmss-10---upgrade-vmss-image-versions-scheduled-to-be-deprecated-or-already-retired">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: Governance</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Guidance</strong></p>
<p>Ensure current versions of images are in use to avoid disruption after image deprecation. This ensures that if these images are deprecated that you will not be impacted as you will no longer be able to deploy any additional VMs or VMSS once the image has been deprecated.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/deprecated-images">Deprecated Azure Marketplace images</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_729057d9d1" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_729057d9d1">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_c14366bdad">
        Copy
        </button>
    </div>
    <div id="clipboard_c14366bdad">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> This query will <span style="color:#66d9ef">check</span> <span style="color:#66d9ef">if</span> the VMSS <span style="color:#66d9ef">are</span> currently <span style="color:#66d9ef">using</span> the latest image.  <span style="color:#66d9ef">If</span> <span style="color:#66d9ef">not</span> the Image reference will be empty
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> extend VMSSName <span style="color:#f92672">=</span> name
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> extend ImageReference <span style="color:#f92672">=</span> tostring(properties.virtualMachineProfile.storageProfile.imageReference.<span style="color:#66d9ef">version</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;vmss-10&#34;</span>,name,id, tags, param1<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ImageReference&#34;</span>
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>
<h3 id="vmss-11---production-vmss-instances-should-be-using-ssd-disks">VMSS-11 - Production VMSS instances should be using SSD disks
  <a href="#vmss-11---production-vmss-instances-should-be-using-ssd-disks">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16">
      <path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/>
      <path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/>
    </svg>
  </a>
</h3>
<p><strong>Category: System Efficiency</strong></p>
<p><strong>Impact: High</strong></p>
<p><strong>Guidance</strong></p>
<p>It is advised that you use SSD disks for Production workloads. Using HDD could impact your resources as it should only be used for non-critical resources and for resources that require infrequent access.</p>
<p><strong>Resources</strong></p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/virtual-machines/disks-types#disk-type-comparison">Disk Comparison</a></li>
</ul>
<p><strong>Resource Graph Query</strong></p>


<button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapse_a14ddb87ad" aria-expanded="false">
    Show/Hide Query/Script
</button>

<div class="collapse" id="collapse_a14ddb87ad">
  <div class="card card-body">
    







    
    




<div class="position-relative">
    <div class="position-absolute" style="right:0;">
        <button class="btn btn-light" data-clipboard-target="#clipboard_cbc13c58bd">
        Copy
        </button>
    </div>
    <div id="clipboard_cbc13c58bd">
    <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#f92672">//</span> Azure Resource Graph Query
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Find <span style="color:#66d9ef">all</span> VMSSs Uniform <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">using</span> SSD <span style="color:#66d9ef">storage</span>
</span></span><span style="display:flex;"><span>resources
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">type</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;microsoft.compute/virtualmachinescalesets&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.orchestrationMode <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Flexible&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> <span style="color:#66d9ef">where</span> properties.virtualMachineProfile.storageProfile.osDisk.managedDisk.storageAccountType <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Standard_LRS&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">|</span> project recommendationId <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;vmss-11&#34;</span>, name, id, tags
</span></span></code></pre></div>
    </div>
</div>






  </div>
</div>
<p><br><br></p>


    



          <div class="row"></div> 

        </div>

      </div> 

    </div> 
<script src="http://localhost:1313/Azure-Proactive-Resiliency-Library/lib/jquery.min.js"></script> 
<script src="http://localhost:1313/Azure-Proactive-Resiliency-Library/lib/popper.min.js"></script> 

<script src="http://localhost:1313/Azure-Proactive-Resiliency-Library/js/bootstrap.min.js"></script> 


<script type="text/javascript" src="/Azure-Proactive-Resiliency-Library/plugins/lunr.min.js"></script>
<script type="text/javascript" src="/Azure-Proactive-Resiliency-Library/plugins/auto-complete.js"></script>
<link href="/Azure-Proactive-Resiliency-Library/plugins/auto-complete.css" rel="stylesheet">
<script type="text/javascript">
  
      var baseurl = "http:\/\/localhost:1313\/Azure-Proactive-Resiliency-Library\/";
  
</script>
<script type="text/javascript" src="/Azure-Proactive-Resiliency-Library/plugins/search.js"></script>

<script type="text/javascript" src="/Azure-Proactive-Resiliency-Library/plugins/favorites.js"></script>


<script type="text/javascript" src="/Azure-Proactive-Resiliency-Library/plugins/clipboard.js"></script>
<script>
  new ClipboardJS('.btn');
</script>
</body>

</html>
